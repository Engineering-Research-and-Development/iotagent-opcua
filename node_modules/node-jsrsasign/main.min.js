var navigator={};var window={};if(typeof YAHOO=="undefined"||!YAHOO){var YAHOO={}}YAHOO.namespace=function(){var b=arguments,g=null,e,c,f;for(e=0;e<b.length;e=e+1){f=(""+b[e]).split(".");g=YAHOO;for(c=f[0]=="YAHOO"?1:0;c<f.length;c=c+1){g[f[c]]=g[f[c]]||{};g=g[f[c]]}}return g};YAHOO.log=function(d,a,c){var b=YAHOO.widget.Logger;if(b&&b.log){return b.log(d,a,c)}else{return false}};YAHOO.register=function(a,f,e){var k=YAHOO.env.modules,c,j,h,g,d;if(!k[a]){k[a]={versions:[],builds:[]}}c=k[a];j=e.version;h=e.build;g=YAHOO.env.listeners;c.name=a;c.version=j;c.build=h;c.versions.push(j);c.builds.push(h);c.mainClass=f;for(d=0;d<g.length;d=d+1){g[d](c)}if(f){f.VERSION=j;f.BUILD=h}else{YAHOO.log("mainClass is undefined for module "+a,"warn")}};YAHOO.env=YAHOO.env||{modules:[],listeners:[]};YAHOO.env.getVersion=function(a){return YAHOO.env.modules[a]||null};YAHOO.env.parseUA=function(d){var e=function(i){var j=0;return parseFloat(i.replace(/\./g,function(){return j++==1?"":"."}))},h=navigator,g={ie:0,opera:0,gecko:0,webkit:0,chrome:0,mobile:null,air:0,ipad:0,iphone:0,ipod:0,ios:null,android:0,webos:0,caja:h&&h.cajaVersion,secure:false,os:null},c=d||navigator&&navigator.userAgent,f=window&&window.location,b=f&&f.href,a;g.secure=b&&b.toLowerCase().indexOf("https")===0;if(c){if(/windows|win32/i.test(c)){g.os="windows"}else{if(/macintosh/i.test(c)){g.os="macintosh"}else{if(/rhino/i.test(c)){g.os="rhino"}}}if(/KHTML/.test(c)){g.webkit=1}a=c.match(/AppleWebKit\/([^\s]*)/);if(a&&a[1]){g.webkit=e(a[1]);if(/ Mobile\//.test(c)){g.mobile="Apple";a=c.match(/OS ([^\s]*)/);if(a&&a[1]){a=e(a[1].replace("_","."))}g.ios=a;g.ipad=g.ipod=g.iphone=0;a=c.match(/iPad|iPod|iPhone/);if(a&&a[0]){g[a[0].toLowerCase()]=g.ios}}else{a=c.match(/NokiaN[^\/]*|Android \d\.\d|webOS\/\d\.\d/);if(a){g.mobile=a[0]}if(/webOS/.test(c)){g.mobile="WebOS";a=c.match(/webOS\/([^\s]*);/);if(a&&a[1]){g.webos=e(a[1])}}if(/ Android/.test(c)){g.mobile="Android";a=c.match(/Android ([^\s]*);/);if(a&&a[1]){g.android=e(a[1])}}}a=c.match(/Chrome\/([^\s]*)/);if(a&&a[1]){g.chrome=e(a[1])}else{a=c.match(/AdobeAIR\/([^\s]*)/);if(a){g.air=a[0]}}}if(!g.webkit){a=c.match(/Opera[\s\/]([^\s]*)/);if(a&&a[1]){g.opera=e(a[1]);a=c.match(/Version\/([^\s]*)/);if(a&&a[1]){g.opera=e(a[1])}a=c.match(/Opera Mini[^;]*/);if(a){g.mobile=a[0]}}else{a=c.match(/MSIE\s([^;]*)/);if(a&&a[1]){g.ie=e(a[1])}else{a=c.match(/Gecko\/([^\s]*)/);if(a){g.gecko=1;a=c.match(/rv:([^\s\)]*)/);if(a&&a[1]){g.gecko=e(a[1])}}}}}}return g};YAHOO.env.ua=YAHOO.env.parseUA();(function(){YAHOO.namespace("util","widget","example");if("undefined"!==typeof YAHOO_config){var b=YAHOO_config.listener,a=YAHOO.env.listeners,d=true,c;if(b){for(c=0;c<a.length;c++){if(a[c]==b){d=false;break}}if(d){a.push(b)}}}})();YAHOO.lang=YAHOO.lang||{};(function(){var f=YAHOO.lang,a=Object.prototype,c="[object Array]",h="[object Function]",i="[object Object]",b=[],g={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;","`":"&#x60;"},d=["toString","valueOf"],e={isArray:function(j){return a.toString.apply(j)===c},isBoolean:function(j){return typeof j==="boolean"},isFunction:function(j){return typeof j==="function"||a.toString.apply(j)===h},isNull:function(j){return j===null},isNumber:function(j){return typeof j==="number"&&isFinite(j)},isObject:function(j){return j&&(typeof j==="object"||f.isFunction(j))||false},isString:function(j){return typeof j==="string"},isUndefined:function(j){return typeof j==="undefined"},_IEEnumFix:YAHOO.env.ua.ie?function(l,k){var j,n,m;for(j=0;j<d.length;j=j+1){n=d[j];m=k[n];if(f.isFunction(m)&&m!=a[n]){l[n]=m}}}:function(){},escapeHTML:function(j){return j.replace(/[&<>"'\/`]/g,function(k){return g[k]})},extend:function(m,n,l){if(!n||!m){throw new Error("extend failed, please check that "+"all dependencies are included.")}var k=function(){},j;k.prototype=n.prototype;m.prototype=new k;m.prototype.constructor=m;m.superclass=n.prototype;if(n.prototype.constructor==a.constructor){n.prototype.constructor=n}if(l){for(j in l){if(f.hasOwnProperty(l,j)){m.prototype[j]=l[j]}}f._IEEnumFix(m.prototype,l)}},augmentObject:function(n,m){if(!m||!n){throw new Error("Absorb failed, verify dependencies.")}var j=arguments,l,o,k=j[2];if(k&&k!==true){for(l=2;l<j.length;l=l+1){n[j[l]]=m[j[l]]}}else{for(o in m){if(k||!(o in n)){n[o]=m[o]}}f._IEEnumFix(n,m)}return n},augmentProto:function(m,l){if(!l||!m){throw new Error("Augment failed, verify dependencies.")}var j=[m.prototype,l.prototype],k;for(k=2;k<arguments.length;k=k+1){j.push(arguments[k])}f.augmentObject.apply(this,j);return m},dump:function(j,p){var l,n,r=[],t="{...}",k="f(){...}",q=", ",m=" => ";if(!f.isObject(j)){return j+""}else{if(j instanceof Date||"nodeType"in j&&"tagName"in j){return j}else{if(f.isFunction(j)){return k}}}p=f.isNumber(p)?p:3;if(f.isArray(j)){r.push("[");for(l=0,n=j.length;l<n;l=l+1){if(f.isObject(j[l])){r.push(p>0?f.dump(j[l],p-1):t)}else{r.push(j[l])}r.push(q)}if(r.length>1){r.pop()}r.push("]")}else{r.push("{");for(l in j){if(f.hasOwnProperty(j,l)){r.push(l+m);if(f.isObject(j[l])){r.push(p>0?f.dump(j[l],p-1):t)}else{r.push(j[l])}r.push(q)}}if(r.length>1){r.pop()}r.push("}")}return r.join("")},substitute:function(x,y,E,l){var D,C,B,G,t,u,F=[],p,z=x.length,A="dump",r=" ",q="{",m="}",n,w;for(;;){D=x.lastIndexOf(q,z);if(D<0){break}C=x.indexOf(m,D);if(D+1>C){break}p=x.substring(D+1,C);G=p;u=null;B=G.indexOf(r);if(B>-1){u=G.substring(B+1);G=G.substring(0,B)}t=y[G];if(E){t=E(G,t,u)}if(f.isObject(t)){if(f.isArray(t)){t=f.dump(t,parseInt(u,10))}else{u=u||"";n=u.indexOf(A);if(n>-1){u=u.substring(4)}w=t.toString();if(w===i||n>-1){t=f.dump(t,parseInt(u,10))}else{t=w}}}else{if(!f.isString(t)&&!f.isNumber(t)){t="~-"+F.length+"-~";F[F.length]=p}}x=x.substring(0,D)+t+x.substring(C+1);if(l===false){z=D-1}}for(D=F.length-1;D>=0;D=D-1){x=x.replace(new RegExp("~-"+D+"-~"),"{"+F[D]+"}","g")}return x},trim:function(j){try{return j.replace(/^\s+|\s+$/g,"")}catch(k){return j}},merge:function(){var n={},k=arguments,j=k.length,m;for(m=0;m<j;m=m+1){f.augmentObject(n,k[m],true)}return n},later:function(t,k,u,n,p){t=t||0;k=k||{};var l=u,s=n,q,j;if(f.isString(u)){l=k[u]}if(!l){throw new TypeError("method undefined")}if(!f.isUndefined(n)&&!f.isArray(s)){s=[n]}q=function(){l.apply(k,s||b)};j=p?setInterval(q,t):setTimeout(q,t);return{interval:p,cancel:function(){if(this.interval){clearInterval(j)}else{clearTimeout(j)}}}},isValue:function(j){return f.isObject(j)||f.isString(j)||f.isNumber(j)||f.isBoolean(j)}};f.hasOwnProperty=a.hasOwnProperty?function(j,k){return j&&j.hasOwnProperty&&j.hasOwnProperty(k)}:function(j,k){return!f.isUndefined(j[k])&&j.constructor.prototype[k]!==j[k]};e.augmentObject(f,e,true);YAHOO.util.Lang=f;f.augment=f.augmentProto;YAHOO.augment=f.augmentProto;YAHOO.extend=f.extend})();YAHOO.register("yahoo",YAHOO,{version:"2.9.0",build:"2800"});var b64map="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var b64pad="=";function hex2b64(h){var i;var c;var ret="";for(i=0;i+3<=h.length;i+=3){c=parseInt(h.substring(i,i+3),16);ret+=b64map.charAt(c>>6)+b64map.charAt(c&63)}if(i+1==h.length){c=parseInt(h.substring(i,i+1),16);ret+=b64map.charAt(c<<2)}else if(i+2==h.length){c=parseInt(h.substring(i,i+2),16);ret+=b64map.charAt(c>>2)+b64map.charAt((c&3)<<4)}if(b64pad)while((ret.length&3)>0)ret+=b64pad;return ret}function b64tohex(s){var ret="";var i;var k=0;var slop;var v;for(i=0;i<s.length;++i){if(s.charAt(i)==b64pad)break;v=b64map.indexOf(s.charAt(i));if(v<0)continue;if(k==0){ret+=int2char(v>>2);slop=v&3;k=1}else if(k==1){ret+=int2char(slop<<2|v>>4);slop=v&15;k=2}else if(k==2){ret+=int2char(slop);ret+=int2char(v>>2);slop=v&3;k=3}else{ret+=int2char(slop<<2|v>>4);ret+=int2char(v&15);k=0}}if(k==1)ret+=int2char(slop<<2);return ret}function b64toBA(s){var h=b64tohex(s);var i;var a=new Array;for(i=0;2*i<h.length;++i){a[i]=parseInt(h.substring(2*i,2*i+2),16)}return a}if(typeof KJUR=="undefined"||!KJUR)KJUR={};if(typeof KJUR.crypto=="undefined"||!KJUR.crypto)KJUR.crypto={};KJUR.crypto.Util=new function(){this.DIGESTINFOHEAD={sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",ripemd160:"3021300906052b2403020105000414"};this.DEFAULTPROVIDER={md5:"cryptojs",sha1:"cryptojs",sha224:"cryptojs",sha256:"cryptojs",sha384:"cryptojs",sha512:"cryptojs",ripemd160:"cryptojs",hmacmd5:"cryptojs",hmacsha1:"cryptojs",hmacsha224:"cryptojs",hmacsha256:"cryptojs",hmacsha384:"cryptojs",hmacsha512:"cryptojs",hmacripemd160:"cryptojs",MD5withRSA:"cryptojs/jsrsa",SHA1withRSA:"cryptojs/jsrsa",SHA224withRSA:"cryptojs/jsrsa",SHA256withRSA:"cryptojs/jsrsa",SHA384withRSA:"cryptojs/jsrsa",SHA512withRSA:"cryptojs/jsrsa",RIPEMD160withRSA:"cryptojs/jsrsa",MD5withECDSA:"cryptojs/jsrsa",SHA1withECDSA:"cryptojs/jsrsa",SHA224withECDSA:"cryptojs/jsrsa",SHA256withECDSA:"cryptojs/jsrsa",SHA384withECDSA:"cryptojs/jsrsa",SHA512withECDSA:"cryptojs/jsrsa",RIPEMD160withECDSA:"cryptojs/jsrsa",SHA1withDSA:"cryptojs/jsrsa",SHA224withDSA:"cryptojs/jsrsa",SHA256withDSA:"cryptojs/jsrsa",MD5withRSAandMGF1:"cryptojs/jsrsa",SHA1withRSAandMGF1:"cryptojs/jsrsa",SHA224withRSAandMGF1:"cryptojs/jsrsa",SHA256withRSAandMGF1:"cryptojs/jsrsa",SHA384withRSAandMGF1:"cryptojs/jsrsa",SHA512withRSAandMGF1:"cryptojs/jsrsa",RIPEMD160withRSAandMGF1:"cryptojs/jsrsa"};this.CRYPTOJSMESSAGEDIGESTNAME={md5:"CryptoJS.algo.MD5",sha1:"CryptoJS.algo.SHA1",sha224:"CryptoJS.algo.SHA224",sha256:"CryptoJS.algo.SHA256",sha384:"CryptoJS.algo.SHA384",sha512:"CryptoJS.algo.SHA512",ripemd160:"CryptoJS.algo.RIPEMD160"};this.getDigestInfoHex=function(hHash,alg){if(typeof this.DIGESTINFOHEAD[alg]=="undefined")throw"alg not supported in Util.DIGESTINFOHEAD: "+alg;return this.DIGESTINFOHEAD[alg]+hHash};this.getPaddedDigestInfoHex=function(hHash,alg,keySize){var hDigestInfo=this.getDigestInfoHex(hHash,alg);var pmStrLen=keySize/4;if(hDigestInfo.length+22>pmStrLen)throw"key is too short for SigAlg: keylen="+keySize+","+alg;var hHead="0001";var hTail="00"+hDigestInfo;var hMid="";var fLen=pmStrLen-hHead.length-hTail.length;for(var i=0;i<fLen;i+=2){hMid+="ff"}var hPaddedMessage=hHead+hMid+hTail;return hPaddedMessage};this.hashString=function(s,alg){var md=new KJUR.crypto.MessageDigest({alg:alg});return md.digestString(s)};this.hashHex=function(sHex,alg){var md=new KJUR.crypto.MessageDigest({alg:alg});return md.digestHex(sHex)};this.sha1=function(s){var md=new KJUR.crypto.MessageDigest({alg:"sha1",prov:"cryptojs"});return md.digestString(s)};this.sha256=function(s){var md=new KJUR.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"});return md.digestString(s)};this.sha256Hex=function(s){var md=new KJUR.crypto.MessageDigest({alg:"sha256",prov:"cryptojs"});return md.digestHex(s)};this.sha512=function(s){var md=new KJUR.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"});return md.digestString(s)};this.sha512Hex=function(s){var md=new KJUR.crypto.MessageDigest({alg:"sha512",prov:"cryptojs"});return md.digestHex(s)};this.md5=function(s){var md=new KJUR.crypto.MessageDigest({alg:"md5",prov:"cryptojs"});return md.digestString(s)};this.ripemd160=function(s){var md=new KJUR.crypto.MessageDigest({alg:"ripemd160",prov:"cryptojs"});return md.digestString(s)};this.getCryptoJSMDByName=function(s){}};KJUR.crypto.MessageDigest=function(params){var md=null;var algName=null;var provName=null;this.setAlgAndProvider=function(alg,prov){if(alg!=null&&prov===undefined)prov=KJUR.crypto.Util.DEFAULTPROVIDER[alg];if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(alg)!=-1&&prov=="cryptojs"){try{this.md=eval(KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[alg]).create()}catch(ex){throw"setAlgAndProvider hash alg set fail alg="+alg+"/"+ex}this.updateString=function(str){this.md.update(str)};this.updateHex=function(hex){var wHex=CryptoJS.enc.Hex.parse(hex);this.md.update(wHex)};this.digest=function(){var hash=this.md.finalize();return hash.toString(CryptoJS.enc.Hex)};this.digestString=function(str){this.updateString(str);return this.digest()};this.digestHex=function(hex){this.updateHex(hex);return this.digest()}}if(":sha256:".indexOf(alg)!=-1&&prov=="sjcl"){try{this.md=new sjcl.hash.sha256}catch(ex){throw"setAlgAndProvider hash alg set fail alg="+alg+"/"+ex}this.updateString=function(str){this.md.update(str)};this.updateHex=function(hex){var baHex=sjcl.codec.hex.toBits(hex);this.md.update(baHex)};this.digest=function(){var hash=this.md.finalize();return sjcl.codec.hex.fromBits(hash)};this.digestString=function(str){this.updateString(str);return this.digest()};this.digestHex=function(hex){this.updateHex(hex);return this.digest()}}};this.updateString=function(str){throw"updateString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName};this.updateHex=function(hex){throw"updateHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName};this.digest=function(){throw"digest() not supported for this alg/prov: "+this.algName+"/"+this.provName};this.digestString=function(str){throw"digestString(str) not supported for this alg/prov: "+this.algName+"/"+this.provName};this.digestHex=function(hex){throw"digestHex(hex) not supported for this alg/prov: "+this.algName+"/"+this.provName};if(params!==undefined){if(params["alg"]!==undefined){this.algName=params["alg"];if(params["prov"]===undefined)this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName];this.setAlgAndProvider(this.algName,this.provName)}}};KJUR.crypto.Mac=function(params){var mac=null;var pass=null;var algName=null;var provName=null;var algProv=null;this.setAlgAndProvider=function(alg,prov){if(alg==null)alg="hmacsha1";alg=alg.toLowerCase();if(alg.substr(0,4)!="hmac"){throw"setAlgAndProvider unsupported HMAC alg: "+alg}if(prov===undefined)prov=KJUR.crypto.Util.DEFAULTPROVIDER[alg];this.algProv=alg+"/"+prov;var hashAlg=alg.substr(4);if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(hashAlg)!=-1&&prov=="cryptojs"){try{var mdObj=eval(KJUR.crypto.Util.CRYPTOJSMESSAGEDIGESTNAME[hashAlg]);this.mac=CryptoJS.algo.HMAC.create(mdObj,this.pass)}catch(ex){throw"setAlgAndProvider hash alg set fail hashAlg="+hashAlg+"/"+ex}this.updateString=function(str){this.mac.update(str)};this.updateHex=function(hex){var wHex=CryptoJS.enc.Hex.parse(hex);this.mac.update(wHex)};this.doFinal=function(){var hash=this.mac.finalize();return hash.toString(CryptoJS.enc.Hex)};this.doFinalString=function(str){this.updateString(str);return this.doFinal()};this.doFinalHex=function(hex){this.updateHex(hex);return this.doFinal()}}};this.updateString=function(str){throw"updateString(str) not supported for this alg/prov: "+this.algProv};this.updateHex=function(hex){throw"updateHex(hex) not supported for this alg/prov: "+this.algProv};this.doFinal=function(){throw"digest() not supported for this alg/prov: "+this.algProv};this.doFinalString=function(str){throw"digestString(str) not supported for this alg/prov: "+this.algProv};this.doFinalHex=function(hex){throw"digestHex(hex) not supported for this alg/prov: "+this.algProv};if(params!==undefined){if(params["pass"]!==undefined){this.pass=params["pass"]}if(params["alg"]!==undefined){this.algName=params["alg"];if(params["prov"]===undefined)this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName];this.setAlgAndProvider(this.algName,this.provName)}}};KJUR.crypto.Signature=function(params){var prvKey=null;var pubKey=null;var md=null;var sig=null;var algName=null;var provName=null;var algProvName=null;var mdAlgName=null;var pubkeyAlgName=null;var state=null;var pssSaltLen=-1;var initParams=null;var sHashHex=null;var hDigestInfo=null;var hPaddedDigestInfo=null;var hSign=null;this._setAlgNames=function(){if(this.algName.match(/^(.+)with(.+)$/)){this.mdAlgName=RegExp.$1.toLowerCase();this.pubkeyAlgName=RegExp.$2.toLowerCase()}};this._zeroPaddingOfSignature=function(hex,bitLength){var s="";var nZero=bitLength/4-hex.length;for(var i=0;i<nZero;i++){s=s+"0"}return s+hex};this.setAlgAndProvider=function(alg,prov){this._setAlgNames();if(prov!="cryptojs/jsrsa")throw"provider not supported: "+prov;if(":md5:sha1:sha224:sha256:sha384:sha512:ripemd160:".indexOf(this.mdAlgName)!=-1){try{this.md=new KJUR.crypto.MessageDigest({alg:this.mdAlgName})}catch(ex){throw"setAlgAndProvider hash alg set fail alg="+this.mdAlgName+"/"+ex}this.init=function(keyparam,pass){var keyObj=null;try{if(pass===undefined){keyObj=KEYUTIL.getKey(keyparam)}else{keyObj=KEYUTIL.getKey(keyparam,pass)}}catch(ex){throw"init failed:"+ex}if(keyObj.isPrivate===true){this.prvKey=keyObj;this.state="SIGN"}else if(keyObj.isPublic===true){this.pubKey=keyObj;this.state="VERIFY"}else{throw"init failed.:"+keyObj}};this.initSign=function(params){if(typeof params["ecprvhex"]=="string"&&typeof params["eccurvename"]=="string"){this.ecprvhex=params["ecprvhex"];this.eccurvename=params["eccurvename"]}else{this.prvKey=params}this.state="SIGN"};this.initVerifyByPublicKey=function(params){if(typeof params["ecpubhex"]=="string"&&typeof params["eccurvename"]=="string"){this.ecpubhex=params["ecpubhex"];this.eccurvename=params["eccurvename"]}else if(params instanceof KJUR.crypto.ECDSA){this.pubKey=params}else if(params instanceof RSAKey){this.pubKey=params}this.state="VERIFY"};this.initVerifyByCertificatePEM=function(certPEM){var x509=new X509;x509.readCertPEM(certPEM);this.pubKey=x509.subjectPublicKeyRSA;this.state="VERIFY"};this.updateString=function(str){this.md.updateString(str)};this.updateHex=function(hex){this.md.updateHex(hex)};this.sign=function(){this.sHashHex=this.md.digest();if(typeof this.ecprvhex!="undefined"&&typeof this.eccurvename!="undefined"){var ec=new KJUR.crypto.ECDSA({curve:this.eccurvename});this.hSign=ec.signHex(this.sHashHex,this.ecprvhex)}else if(this.pubkeyAlgName=="rsaandmgf1"){this.hSign=this.prvKey.signWithMessageHashPSS(this.sHashHex,this.mdAlgName,this.pssSaltLen)}else if(this.pubkeyAlgName=="rsa"){this.hSign=this.prvKey.signWithMessageHash(this.sHashHex,this.mdAlgName)}else if(this.prvKey instanceof KJUR.crypto.ECDSA){this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}else if(this.prvKey instanceof KJUR.crypto.DSA){this.hSign=this.prvKey.signWithMessageHash(this.sHashHex)}else{throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}return this.hSign};this.signString=function(str){this.updateString(str);return this.sign()};this.signHex=function(hex){this.updateHex(hex);return this.sign()};this.verify=function(hSigVal){this.sHashHex=this.md.digest();if(typeof this.ecpubhex!="undefined"&&typeof this.eccurvename!="undefined"){var ec=new KJUR.crypto.ECDSA({curve:this.eccurvename});return ec.verifyHex(this.sHashHex,hSigVal,this.ecpubhex)}else if(this.pubkeyAlgName=="rsaandmgf1"){return this.pubKey.verifyWithMessageHashPSS(this.sHashHex,hSigVal,this.mdAlgName,this.pssSaltLen)}else if(this.pubkeyAlgName=="rsa"){return this.pubKey.verifyWithMessageHash(this.sHashHex,hSigVal)}else if(this.pubKey instanceof KJUR.crypto.ECDSA){return this.pubKey.verifyWithMessageHash(this.sHashHex,hSigVal)}else if(this.pubKey instanceof KJUR.crypto.DSA){return this.pubKey.verifyWithMessageHash(this.sHashHex,hSigVal)}else{throw"Signature: unsupported public key alg: "+this.pubkeyAlgName}}}};this.init=function(key,pass){throw"init(key, pass) not supported for this alg:prov="+this.algProvName};this.initVerifyByPublicKey=function(rsaPubKey){throw"initVerifyByPublicKey(rsaPubKeyy) not supported for this alg:prov="+this.algProvName};this.initVerifyByCertificatePEM=function(certPEM){throw"initVerifyByCertificatePEM(certPEM) not supported for this alg:prov="+this.algProvName};this.initSign=function(prvKey){throw"initSign(prvKey) not supported for this alg:prov="+this.algProvName};this.updateString=function(str){throw"updateString(str) not supported for this alg:prov="+this.algProvName};this.updateHex=function(hex){throw"updateHex(hex) not supported for this alg:prov="+this.algProvName};this.sign=function(){throw"sign() not supported for this alg:prov="+this.algProvName};this.signString=function(str){throw"digestString(str) not supported for this alg:prov="+this.algProvName};this.signHex=function(hex){throw"digestHex(hex) not supported for this alg:prov="+this.algProvName};this.verify=function(hSigVal){throw"verify(hSigVal) not supported for this alg:prov="+this.algProvName};this.initParams=params;if(params!==undefined){if(params["alg"]!==undefined){this.algName=params["alg"];if(params["prov"]===undefined){this.provName=KJUR.crypto.Util.DEFAULTPROVIDER[this.algName]}else{this.provName=params["prov"]}this.algProvName=this.algName+":"+this.provName;this.setAlgAndProvider(this.algName,this.provName);this._setAlgNames()}if(params["psssaltlen"]!==undefined)this.pssSaltLen=params["psssaltlen"];if(params["prvkeypem"]!==undefined){if(params["prvkeypas"]!==undefined){throw"both prvkeypem and prvkeypas parameters not supported"}else{try{var prvKey=new RSAKey;prvKey.readPrivateKeyFromPEMString(params["prvkeypem"]);this.initSign(prvKey)}catch(ex){throw"fatal error to load pem private key: "+ex}}}}};KJUR.crypto.OID=new function(){this.oidhex2name={"2a864886f70d010101":"rsaEncryption","2a8648ce3d0201":"ecPublicKey","2a8648ce380401":"dsa","2a8648ce3d030107":"secp256r1","2b8104001f":"secp192k1","2b81040021":"secp224r1","2b8104000a":"secp256k1","2b81040023":"secp521r1","2b81040022":"secp384r1","2a8648ce380403":"SHA1withDSA","608648016503040301":"SHA224withDSA","608648016503040302":"SHA256withDSA"}};var CryptoJS=CryptoJS||function(Math,undefined){var C={};var C_lib=C.lib={};var Base=C_lib.Base=function(){function F(){}return{extend:function(overrides){F.prototype=this;var subtype=new F;if(overrides){subtype.mixIn(overrides)}if(!subtype.hasOwnProperty("init")){subtype.init=function(){subtype.$super.init.apply(this,arguments)}}subtype.init.prototype=subtype;subtype.$super=this;return subtype},create:function(){var instance=this.extend();instance.init.apply(instance,arguments);return instance},init:function(){},mixIn:function(properties){for(var propertyName in properties){if(properties.hasOwnProperty(propertyName)){this[propertyName]=properties[propertyName]}}if(properties.hasOwnProperty("toString")){this.toString=properties.toString}},clone:function(){return this.init.prototype.extend(this)}}}();var WordArray=C_lib.WordArray=Base.extend({init:function(words,sigBytes){words=this.words=words||[];if(sigBytes!=undefined){this.sigBytes=sigBytes}else{this.sigBytes=words.length*4}},toString:function(encoder){return(encoder||Hex).stringify(this)},concat:function(wordArray){var thisWords=this.words;var thatWords=wordArray.words;var thisSigBytes=this.sigBytes;var thatSigBytes=wordArray.sigBytes;this.clamp();if(thisSigBytes%4){for(var i=0;i<thatSigBytes;i++){var thatByte=thatWords[i>>>2]>>>24-i%4*8&255;thisWords[thisSigBytes+i>>>2]|=thatByte<<24-(thisSigBytes+i)%4*8}}else{for(var i=0;i<thatSigBytes;i+=4){thisWords[thisSigBytes+i>>>2]=thatWords[i>>>2]}}this.sigBytes+=thatSigBytes;return this},clamp:function(){var words=this.words;var sigBytes=this.sigBytes;words[sigBytes>>>2]&=4294967295<<32-sigBytes%4*8;words.length=Math.ceil(sigBytes/4)},clone:function(){var clone=Base.clone.call(this);clone.words=this.words.slice(0);return clone},random:function(nBytes){var words=[];for(var i=0;i<nBytes;i+=4){words.push(Math.random()*4294967296|0)}return new WordArray.init(words,nBytes)}});var C_enc=C.enc={};var Hex=C_enc.Hex={stringify:function(wordArray){var words=wordArray.words;var sigBytes=wordArray.sigBytes;var hexChars=[];for(var i=0;i<sigBytes;i++){var bite=words[i>>>2]>>>24-i%4*8&255;hexChars.push((bite>>>4).toString(16));hexChars.push((bite&15).toString(16))}return hexChars.join("")},parse:function(hexStr){var hexStrLength=hexStr.length;var words=[];for(var i=0;i<hexStrLength;i+=2){words[i>>>3]|=parseInt(hexStr.substr(i,2),16)<<24-i%8*4}return new WordArray.init(words,hexStrLength/2)}};var Latin1=C_enc.Latin1={stringify:function(wordArray){var words=wordArray.words;var sigBytes=wordArray.sigBytes;var latin1Chars=[];for(var i=0;i<sigBytes;i++){var bite=words[i>>>2]>>>24-i%4*8&255;latin1Chars.push(String.fromCharCode(bite))}return latin1Chars.join("")},parse:function(latin1Str){var latin1StrLength=latin1Str.length;var words=[];for(var i=0;i<latin1StrLength;i++){words[i>>>2]|=(latin1Str.charCodeAt(i)&255)<<24-i%4*8}return new WordArray.init(words,latin1StrLength)}};var Utf8=C_enc.Utf8={stringify:function(wordArray){try{return decodeURIComponent(escape(Latin1.stringify(wordArray)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(utf8Str){return Latin1.parse(unescape(encodeURIComponent(utf8Str)))}};var BufferedBlockAlgorithm=C_lib.BufferedBlockAlgorithm=Base.extend({reset:function(){this._data=new WordArray.init;this._nDataBytes=0},_append:function(data){if(typeof data=="string"){data=Utf8.parse(data)}this._data.concat(data);this._nDataBytes+=data.sigBytes},_process:function(doFlush){var data=this._data;var dataWords=data.words;var dataSigBytes=data.sigBytes;var blockSize=this.blockSize;var blockSizeBytes=blockSize*4;var nBlocksReady=dataSigBytes/blockSizeBytes;if(doFlush){nBlocksReady=Math.ceil(nBlocksReady)}else{nBlocksReady=Math.max((nBlocksReady|0)-this._minBufferSize,0)}var nWordsReady=nBlocksReady*blockSize;var nBytesReady=Math.min(nWordsReady*4,dataSigBytes);if(nWordsReady){for(var offset=0;offset<nWordsReady;offset+=blockSize){this._doProcessBlock(dataWords,offset)}var processedWords=dataWords.splice(0,nWordsReady);data.sigBytes-=nBytesReady}return new WordArray.init(processedWords,nBytesReady)},clone:function(){var clone=Base.clone.call(this);clone._data=this._data.clone();return clone},_minBufferSize:0});var Hasher=C_lib.Hasher=BufferedBlockAlgorithm.extend({cfg:Base.extend(),init:function(cfg){this.cfg=this.cfg.extend(cfg);this.reset()},reset:function(){BufferedBlockAlgorithm.reset.call(this);this._doReset()},update:function(messageUpdate){this._append(messageUpdate);this._process();return this},finalize:function(messageUpdate){if(messageUpdate){this._append(messageUpdate)}var hash=this._doFinalize();return hash},blockSize:512/32,_createHelper:function(hasher){return function(message,cfg){return new hasher.init(cfg).finalize(message)}},_createHmacHelper:function(hasher){return function(message,key){return new C_algo.HMAC.init(hasher,key).finalize(message)}}});var C_algo=C.algo={};return C}(Math);var dbits;var canary=0xdeadbeefcafe;var j_lm=(canary&16777215)==15715070;function BigInteger(a,b,c){if(a!=null)if("number"==typeof a)this.fromNumber(a,b,c);else if(b==null&&"string"!=typeof a)this.fromString(a,256);else this.fromString(a,b)}function nbi(){return new BigInteger(null)}function am1(i,x,w,j,c,n){while(--n>=0){var v=x*this[i++]+w[j]+c;c=Math.floor(v/67108864);w[j++]=v&67108863}return c}function am2(i,x,w,j,c,n){var xl=x&32767,xh=x>>15;while(--n>=0){var l=this[i]&32767;var h=this[i++]>>15;var m=xh*l+h*xl;l=xl*l+((m&32767)<<15)+w[j]+(c&1073741823);c=(l>>>30)+(m>>>15)+xh*h+(c>>>30);w[j++]=l&1073741823}return c}function am3(i,x,w,j,c,n){var xl=x&16383,xh=x>>14;while(--n>=0){var l=this[i]&16383;var h=this[i++]>>14;var m=xh*l+h*xl;l=xl*l+((m&16383)<<14)+w[j]+c;c=(l>>28)+(m>>14)+xh*h;w[j++]=l&268435455}return c}if(j_lm&&navigator.appName=="Microsoft Internet Explorer"){BigInteger.prototype.am=am2;dbits=30}else if(j_lm&&navigator.appName!="Netscape"){BigInteger.prototype.am=am1;dbits=26}else{BigInteger.prototype.am=am3;dbits=28}BigInteger.prototype.DB=dbits;BigInteger.prototype.DM=(1<<dbits)-1;BigInteger.prototype.DV=1<<dbits;var BI_FP=52;BigInteger.prototype.FV=Math.pow(2,BI_FP);BigInteger.prototype.F1=BI_FP-dbits;BigInteger.prototype.F2=2*dbits-BI_FP;var BI_RM="0123456789abcdefghijklmnopqrstuvwxyz";var BI_RC=new Array;var rr,vv;rr="0".charCodeAt(0);for(vv=0;vv<=9;++vv)BI_RC[rr++]=vv;rr="a".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;rr="A".charCodeAt(0);for(vv=10;vv<36;++vv)BI_RC[rr++]=vv;function int2char(n){return BI_RM.charAt(n)}function intAt(s,i){var c=BI_RC[s.charCodeAt(i)];return c==null?-1:c}function bnpCopyTo(r){for(var i=this.t-1;i>=0;--i)r[i]=this[i];r.t=this.t;r.s=this.s}function bnpFromInt(x){this.t=1;this.s=x<0?-1:0;if(x>0)this[0]=x;else if(x<-1)this[0]=x+this.DV;else this.t=0}function nbv(i){var r=nbi();r.fromInt(i);return r}function bnpFromString(s,b){var k;if(b==16)k=4;else if(b==8)k=3;else if(b==256)k=8;else if(b==2)k=1;else if(b==32)k=5;else if(b==4)k=2;else{this.fromRadix(s,b);return}this.t=0;this.s=0;var i=s.length,mi=false,sh=0;while(--i>=0){var x=k==8?s[i]&255:intAt(s,i);if(x<0){if(s.charAt(i)=="-")mi=true;continue}mi=false;if(sh==0)this[this.t++]=x;else if(sh+k>this.DB){this[this.t-1]|=(x&(1<<this.DB-sh)-1)<<sh;this[this.t++]=x>>this.DB-sh}else this[this.t-1]|=x<<sh;sh+=k;if(sh>=this.DB)sh-=this.DB}if(k==8&&(s[0]&128)!=0){this.s=-1;if(sh>0)this[this.t-1]|=(1<<this.DB-sh)-1<<sh}this.clamp();if(mi)BigInteger.ZERO.subTo(this,this)}function bnpClamp(){var c=this.s&this.DM;while(this.t>0&&this[this.t-1]==c)--this.t}function bnToString(b){if(this.s<0)return"-"+this.negate().toString(b);var k;if(b==16)k=4;else if(b==8)k=3;else if(b==2)k=1;else if(b==32)k=5;else if(b==4)k=2;else return this.toRadix(b);var km=(1<<k)-1,d,m=false,r="",i=this.t;var p=this.DB-i*this.DB%k;if(i-->0){if(p<this.DB&&(d=this[i]>>p)>0){m=true;r=int2char(d)}while(i>=0){if(p<k){d=(this[i]&(1<<p)-1)<<k-p;d|=this[--i]>>(p+=this.DB-k)}else{d=this[i]>>(p-=k)&km;if(p<=0){p+=this.DB;--i}}if(d>0)m=true;if(m)r+=int2char(d)}}return m?r:"0"}function bnNegate(){var r=nbi();BigInteger.ZERO.subTo(this,r);return r}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(a){var r=this.s-a.s;if(r!=0)return r;var i=this.t;r=i-a.t;if(r!=0)return this.s<0?-r:r;while(--i>=0)if((r=this[i]-a[i])!=0)return r;return 0}function nbits(x){var r=1,t;if((t=x>>>16)!=0){x=t;r+=16}if((t=x>>8)!=0){x=t;r+=8}if((t=x>>4)!=0){x=t;r+=4}if((t=x>>2)!=0){x=t;r+=2}if((t=x>>1)!=0){x=t;r+=1}return r}function bnBitLength(){if(this.t<=0)return 0;return this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(n,r){var i;for(i=this.t-1;i>=0;--i)r[i+n]=this[i];for(i=n-1;i>=0;--i)r[i]=0;r.t=this.t+n;r.s=this.s}function bnpDRShiftTo(n,r){for(var i=n;i<this.t;++i)r[i-n]=this[i];r.t=Math.max(this.t-n,0);r.s=this.s}function bnpLShiftTo(n,r){var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<cbs)-1;var ds=Math.floor(n/this.DB),c=this.s<<bs&this.DM,i;for(i=this.t-1;i>=0;--i){r[i+ds+1]=this[i]>>cbs|c;c=(this[i]&bm)<<bs}for(i=ds-1;i>=0;--i)r[i]=0;r[ds]=c;r.t=this.t+ds+1;r.s=this.s;r.clamp()}function bnpRShiftTo(n,r){r.s=this.s;var ds=Math.floor(n/this.DB);if(ds>=this.t){r.t=0;return}var bs=n%this.DB;var cbs=this.DB-bs;var bm=(1<<bs)-1;r[0]=this[ds]>>bs;for(var i=ds+1;i<this.t;++i){r[i-ds-1]|=(this[i]&bm)<<cbs;r[i-ds]=this[i]>>bs}if(bs>0)r[this.t-ds-1]|=(this.s&bm)<<cbs;r.t=this.t-ds;r.clamp()}function bnpSubTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]-a[i];r[i++]=c&this.DM;c>>=this.DB}if(a.t<this.t){c-=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB}c+=this.s}else{c+=this.s;while(i<a.t){c-=a[i];r[i++]=c&this.DM;c>>=this.DB}c-=a.s}r.s=c<0?-1:0;if(c<-1)r[i++]=this.DV+c;else if(c>0)r[i++]=c;r.t=i;r.clamp()}function bnpMultiplyTo(a,r){var x=this.abs(),y=a.abs();var i=x.t;r.t=i+y.t;while(--i>=0)r[i]=0;for(i=0;i<y.t;++i)r[i+x.t]=x.am(0,y[i],r,i,0,x.t);r.s=0;r.clamp();if(this.s!=a.s)BigInteger.ZERO.subTo(r,r)}function bnpSquareTo(r){var x=this.abs();var i=r.t=2*x.t;while(--i>=0)r[i]=0;for(i=0;i<x.t-1;++i){var c=x.am(i,x[i],r,2*i,0,1);if((r[i+x.t]+=x.am(i+1,2*x[i],r,2*i+1,c,x.t-i-1))>=x.DV){r[i+x.t]-=x.DV;r[i+x.t+1]=1}}if(r.t>0)r[r.t-1]+=x.am(i,x[i],r,2*i,0,1);r.s=0;r.clamp()}function bnpDivRemTo(m,q,r){var pm=m.abs();if(pm.t<=0)return;var pt=this.abs();if(pt.t<pm.t){if(q!=null)q.fromInt(0);if(r!=null)this.copyTo(r);return}if(r==null)r=nbi();var y=nbi(),ts=this.s,ms=m.s;var nsh=this.DB-nbits(pm[pm.t-1]);if(nsh>0){pm.lShiftTo(nsh,y);pt.lShiftTo(nsh,r)}else{pm.copyTo(y);pt.copyTo(r)
}var ys=y.t;var y0=y[ys-1];if(y0==0)return;var yt=y0*(1<<this.F1)+(ys>1?y[ys-2]>>this.F2:0);var d1=this.FV/yt,d2=(1<<this.F1)/yt,e=1<<this.F2;var i=r.t,j=i-ys,t=q==null?nbi():q;y.dlShiftTo(j,t);if(r.compareTo(t)>=0){r[r.t++]=1;r.subTo(t,r)}BigInteger.ONE.dlShiftTo(ys,t);t.subTo(y,y);while(y.t<ys)y[y.t++]=0;while(--j>=0){var qd=r[--i]==y0?this.DM:Math.floor(r[i]*d1+(r[i-1]+e)*d2);if((r[i]+=y.am(0,qd,r,j,0,ys))<qd){y.dlShiftTo(j,t);r.subTo(t,r);while(r[i]<--qd)r.subTo(t,r)}}if(q!=null){r.drShiftTo(ys,q);if(ts!=ms)BigInteger.ZERO.subTo(q,q)}r.t=ys;r.clamp();if(nsh>0)r.rShiftTo(nsh,r);if(ts<0)BigInteger.ZERO.subTo(r,r)}function bnMod(a){var r=nbi();this.abs().divRemTo(a,null,r);if(this.s<0&&r.compareTo(BigInteger.ZERO)>0)a.subTo(r,r);return r}function Classic(m){this.m=m}function cConvert(x){if(x.s<0||x.compareTo(this.m)>=0)return x.mod(this.m);else return x}function cRevert(x){return x}function cReduce(x){x.divRemTo(this.m,null,x)}function cMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}function cSqrTo(x,r){x.squareTo(r);this.reduce(r)}Classic.prototype.convert=cConvert;Classic.prototype.revert=cRevert;Classic.prototype.reduce=cReduce;Classic.prototype.mulTo=cMulTo;Classic.prototype.sqrTo=cSqrTo;function bnpInvDigit(){if(this.t<1)return 0;var x=this[0];if((x&1)==0)return 0;var y=x&3;y=y*(2-(x&15)*y)&15;y=y*(2-(x&255)*y)&255;y=y*(2-((x&65535)*y&65535))&65535;y=y*(2-x*y%this.DV)%this.DV;return y>0?this.DV-y:-y}function Montgomery(m){this.m=m;this.mp=m.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<m.DB-15)-1;this.mt2=2*m.t}function montConvert(x){var r=nbi();x.abs().dlShiftTo(this.m.t,r);r.divRemTo(this.m,null,r);if(x.s<0&&r.compareTo(BigInteger.ZERO)>0)this.m.subTo(r,r);return r}function montRevert(x){var r=nbi();x.copyTo(r);this.reduce(r);return r}function montReduce(x){while(x.t<=this.mt2)x[x.t++]=0;for(var i=0;i<this.m.t;++i){var j=x[i]&32767;var u0=j*this.mpl+((j*this.mph+(x[i]>>15)*this.mpl&this.um)<<15)&x.DM;j=i+this.m.t;x[j]+=this.m.am(0,u0,x,i,0,this.m.t);while(x[j]>=x.DV){x[j]-=x.DV;x[++j]++}}x.clamp();x.drShiftTo(this.m.t,x);if(x.compareTo(this.m)>=0)x.subTo(this.m,x)}function montSqrTo(x,r){x.squareTo(r);this.reduce(r)}function montMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}Montgomery.prototype.convert=montConvert;Montgomery.prototype.revert=montRevert;Montgomery.prototype.reduce=montReduce;Montgomery.prototype.mulTo=montMulTo;Montgomery.prototype.sqrTo=montSqrTo;function bnpIsEven(){return(this.t>0?this[0]&1:this.s)==0}function bnpExp(e,z){if(e>4294967295||e<1)return BigInteger.ONE;var r=nbi(),r2=nbi(),g=z.convert(this),i=nbits(e)-1;g.copyTo(r);while(--i>=0){z.sqrTo(r,r2);if((e&1<<i)>0)z.mulTo(r2,g,r);else{var t=r;r=r2;r2=t}}return z.revert(r)}function bnModPowInt(e,m){var z;if(e<256||m.isEven())z=new Classic(m);else z=new Montgomery(m);return this.exp(e,z)}BigInteger.prototype.copyTo=bnpCopyTo;BigInteger.prototype.fromInt=bnpFromInt;BigInteger.prototype.fromString=bnpFromString;BigInteger.prototype.clamp=bnpClamp;BigInteger.prototype.dlShiftTo=bnpDLShiftTo;BigInteger.prototype.drShiftTo=bnpDRShiftTo;BigInteger.prototype.lShiftTo=bnpLShiftTo;BigInteger.prototype.rShiftTo=bnpRShiftTo;BigInteger.prototype.subTo=bnpSubTo;BigInteger.prototype.multiplyTo=bnpMultiplyTo;BigInteger.prototype.squareTo=bnpSquareTo;BigInteger.prototype.divRemTo=bnpDivRemTo;BigInteger.prototype.invDigit=bnpInvDigit;BigInteger.prototype.isEven=bnpIsEven;BigInteger.prototype.exp=bnpExp;BigInteger.prototype.toString=bnToString;BigInteger.prototype.negate=bnNegate;BigInteger.prototype.abs=bnAbs;BigInteger.prototype.compareTo=bnCompareTo;BigInteger.prototype.bitLength=bnBitLength;BigInteger.prototype.mod=bnMod;BigInteger.prototype.modPowInt=bnModPowInt;BigInteger.ZERO=nbv(0);BigInteger.ONE=nbv(1);function bnClone(){var r=nbi();this.copyTo(r);return r}function bnIntValue(){if(this.s<0){if(this.t==1)return this[0]-this.DV;else if(this.t==0)return-1}else if(this.t==1)return this[0];else if(this.t==0)return 0;return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function bnByteValue(){return this.t==0?this.s:this[0]<<24>>24}function bnShortValue(){return this.t==0?this.s:this[0]<<16>>16}function bnpChunkSize(r){return Math.floor(Math.LN2*this.DB/Math.log(r))}function bnSigNum(){if(this.s<0)return-1;else if(this.t<=0||this.t==1&&this[0]<=0)return 0;else return 1}function bnpToRadix(b){if(b==null)b=10;if(this.signum()==0||b<2||b>36)return"0";var cs=this.chunkSize(b);var a=Math.pow(b,cs);var d=nbv(a),y=nbi(),z=nbi(),r="";this.divRemTo(d,y,z);while(y.signum()>0){r=(a+z.intValue()).toString(b).substr(1)+r;y.divRemTo(d,y,z)}return z.intValue().toString(b)+r}function bnpFromRadix(s,b){this.fromInt(0);if(b==null)b=10;var cs=this.chunkSize(b);var d=Math.pow(b,cs),mi=false,j=0,w=0;for(var i=0;i<s.length;++i){var x=intAt(s,i);if(x<0){if(s.charAt(i)=="-"&&this.signum()==0)mi=true;continue}w=b*w+x;if(++j>=cs){this.dMultiply(d);this.dAddOffset(w,0);j=0;w=0}}if(j>0){this.dMultiply(Math.pow(b,j));this.dAddOffset(w,0)}if(mi)BigInteger.ZERO.subTo(this,this)}function bnpFromNumber(a,b,c){if("number"==typeof b){if(a<2)this.fromInt(1);else{this.fromNumber(a,c);if(!this.testBit(a-1))this.bitwiseTo(BigInteger.ONE.shiftLeft(a-1),op_or,this);if(this.isEven())this.dAddOffset(1,0);while(!this.isProbablePrime(b)){this.dAddOffset(2,0);if(this.bitLength()>a)this.subTo(BigInteger.ONE.shiftLeft(a-1),this)}}}else{var x=new Array,t=a&7;x.length=(a>>3)+1;b.nextBytes(x);if(t>0)x[0]&=(1<<t)-1;else x[0]=0;this.fromString(x,256)}}function bnToByteArray(){var i=this.t,r=new Array;r[0]=this.s;var p=this.DB-i*this.DB%8,d,k=0;if(i-->0){if(p<this.DB&&(d=this[i]>>p)!=(this.s&this.DM)>>p)r[k++]=d|this.s<<this.DB-p;while(i>=0){if(p<8){d=(this[i]&(1<<p)-1)<<8-p;d|=this[--i]>>(p+=this.DB-8)}else{d=this[i]>>(p-=8)&255;if(p<=0){p+=this.DB;--i}}if((d&128)!=0)d|=-256;if(k==0&&(this.s&128)!=(d&128))++k;if(k>0||d!=this.s)r[k++]=d}}return r}function bnEquals(a){return this.compareTo(a)==0}function bnMin(a){return this.compareTo(a)<0?this:a}function bnMax(a){return this.compareTo(a)>0?this:a}function bnpBitwiseTo(a,op,r){var i,f,m=Math.min(a.t,this.t);for(i=0;i<m;++i)r[i]=op(this[i],a[i]);if(a.t<this.t){f=a.s&this.DM;for(i=m;i<this.t;++i)r[i]=op(this[i],f);r.t=this.t}else{f=this.s&this.DM;for(i=m;i<a.t;++i)r[i]=op(f,a[i]);r.t=a.t}r.s=op(this.s,a.s);r.clamp()}function op_and(x,y){return x&y}function bnAnd(a){var r=nbi();this.bitwiseTo(a,op_and,r);return r}function op_or(x,y){return x|y}function bnOr(a){var r=nbi();this.bitwiseTo(a,op_or,r);return r}function op_xor(x,y){return x^y}function bnXor(a){var r=nbi();this.bitwiseTo(a,op_xor,r);return r}function op_andnot(x,y){return x&~y}function bnAndNot(a){var r=nbi();this.bitwiseTo(a,op_andnot,r);return r}function bnNot(){var r=nbi();for(var i=0;i<this.t;++i)r[i]=this.DM&~this[i];r.t=this.t;r.s=~this.s;return r}function bnShiftLeft(n){var r=nbi();if(n<0)this.rShiftTo(-n,r);else this.lShiftTo(n,r);return r}function bnShiftRight(n){var r=nbi();if(n<0)this.lShiftTo(-n,r);else this.rShiftTo(n,r);return r}function lbit(x){if(x==0)return-1;var r=0;if((x&65535)==0){x>>=16;r+=16}if((x&255)==0){x>>=8;r+=8}if((x&15)==0){x>>=4;r+=4}if((x&3)==0){x>>=2;r+=2}if((x&1)==0)++r;return r}function bnGetLowestSetBit(){for(var i=0;i<this.t;++i)if(this[i]!=0)return i*this.DB+lbit(this[i]);if(this.s<0)return this.t*this.DB;return-1}function cbit(x){var r=0;while(x!=0){x&=x-1;++r}return r}function bnBitCount(){var r=0,x=this.s&this.DM;for(var i=0;i<this.t;++i)r+=cbit(this[i]^x);return r}function bnTestBit(n){var j=Math.floor(n/this.DB);if(j>=this.t)return this.s!=0;return(this[j]&1<<n%this.DB)!=0}function bnpChangeBit(n,op){var r=BigInteger.ONE.shiftLeft(n);this.bitwiseTo(r,op,r);return r}function bnSetBit(n){return this.changeBit(n,op_or)}function bnClearBit(n){return this.changeBit(n,op_andnot)}function bnFlipBit(n){return this.changeBit(n,op_xor)}function bnpAddTo(a,r){var i=0,c=0,m=Math.min(a.t,this.t);while(i<m){c+=this[i]+a[i];r[i++]=c&this.DM;c>>=this.DB}if(a.t<this.t){c+=a.s;while(i<this.t){c+=this[i];r[i++]=c&this.DM;c>>=this.DB}c+=this.s}else{c+=this.s;while(i<a.t){c+=a[i];r[i++]=c&this.DM;c>>=this.DB}c+=a.s}r.s=c<0?-1:0;if(c>0)r[i++]=c;else if(c<-1)r[i++]=this.DV+c;r.t=i;r.clamp()}function bnAdd(a){var r=nbi();this.addTo(a,r);return r}function bnSubtract(a){var r=nbi();this.subTo(a,r);return r}function bnMultiply(a){var r=nbi();this.multiplyTo(a,r);return r}function bnSquare(){var r=nbi();this.squareTo(r);return r}function bnDivide(a){var r=nbi();this.divRemTo(a,r,null);return r}function bnRemainder(a){var r=nbi();this.divRemTo(a,null,r);return r}function bnDivideAndRemainder(a){var q=nbi(),r=nbi();this.divRemTo(a,q,r);return new Array(q,r)}function bnpDMultiply(n){this[this.t]=this.am(0,n-1,this,0,0,this.t);++this.t;this.clamp()}function bnpDAddOffset(n,w){if(n==0)return;while(this.t<=w)this[this.t++]=0;this[w]+=n;while(this[w]>=this.DV){this[w]-=this.DV;if(++w>=this.t)this[this.t++]=0;++this[w]}}function NullExp(){}function nNop(x){return x}function nMulTo(x,y,r){x.multiplyTo(y,r)}function nSqrTo(x,r){x.squareTo(r)}NullExp.prototype.convert=nNop;NullExp.prototype.revert=nNop;NullExp.prototype.mulTo=nMulTo;NullExp.prototype.sqrTo=nSqrTo;function bnPow(e){return this.exp(e,new NullExp)}function bnpMultiplyLowerTo(a,n,r){var i=Math.min(this.t+a.t,n);r.s=0;r.t=i;while(i>0)r[--i]=0;var j;for(j=r.t-this.t;i<j;++i)r[i+this.t]=this.am(0,a[i],r,i,0,this.t);for(j=Math.min(a.t,n);i<j;++i)this.am(0,a[i],r,i,0,n-i);r.clamp()}function bnpMultiplyUpperTo(a,n,r){--n;var i=r.t=this.t+a.t-n;r.s=0;while(--i>=0)r[i]=0;for(i=Math.max(n-this.t,0);i<a.t;++i)r[this.t+i-n]=this.am(n-i,a[i],r,0,0,this.t+i-n);r.clamp();r.drShiftTo(1,r)}function Barrett(m){this.r2=nbi();this.q3=nbi();BigInteger.ONE.dlShiftTo(2*m.t,this.r2);this.mu=this.r2.divide(m);this.m=m}function barrettConvert(x){if(x.s<0||x.t>2*this.m.t)return x.mod(this.m);else if(x.compareTo(this.m)<0)return x;else{var r=nbi();x.copyTo(r);this.reduce(r);return r}}function barrettRevert(x){return x}function barrettReduce(x){x.drShiftTo(this.m.t-1,this.r2);if(x.t>this.m.t+1){x.t=this.m.t+1;x.clamp()}this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(x.compareTo(this.r2)<0)x.dAddOffset(1,this.m.t+1);x.subTo(this.r2,x);while(x.compareTo(this.m)>=0)x.subTo(this.m,x)}function barrettSqrTo(x,r){x.squareTo(r);this.reduce(r)}function barrettMulTo(x,y,r){x.multiplyTo(y,r);this.reduce(r)}Barrett.prototype.convert=barrettConvert;Barrett.prototype.revert=barrettRevert;Barrett.prototype.reduce=barrettReduce;Barrett.prototype.mulTo=barrettMulTo;Barrett.prototype.sqrTo=barrettSqrTo;function bnModPow(e,m){var i=e.bitLength(),k,r=nbv(1),z;if(i<=0)return r;else if(i<18)k=1;else if(i<48)k=3;else if(i<144)k=4;else if(i<768)k=5;else k=6;if(i<8)z=new Classic(m);else if(m.isEven())z=new Barrett(m);else z=new Montgomery(m);var g=new Array,n=3,k1=k-1,km=(1<<k)-1;g[1]=z.convert(this);if(k>1){var g2=nbi();z.sqrTo(g[1],g2);while(n<=km){g[n]=nbi();z.mulTo(g2,g[n-2],g[n]);n+=2}}var j=e.t-1,w,is1=true,r2=nbi(),t;i=nbits(e[j])-1;while(j>=0){if(i>=k1)w=e[j]>>i-k1&km;else{w=(e[j]&(1<<i+1)-1)<<k1-i;if(j>0)w|=e[j-1]>>this.DB+i-k1}n=k;while((w&1)==0){w>>=1;--n}if((i-=n)<0){i+=this.DB;--j}if(is1){g[w].copyTo(r);is1=false}else{while(n>1){z.sqrTo(r,r2);z.sqrTo(r2,r);n-=2}if(n>0)z.sqrTo(r,r2);else{t=r;r=r2;r2=t}z.mulTo(r2,g[w],r)}while(j>=0&&(e[j]&1<<i)==0){z.sqrTo(r,r2);t=r;r=r2;r2=t;if(--i<0){i=this.DB-1;--j}}}return z.revert(r)}function bnGCD(a){var x=this.s<0?this.negate():this.clone();var y=a.s<0?a.negate():a.clone();if(x.compareTo(y)<0){var t=x;x=y;y=t}var i=x.getLowestSetBit(),g=y.getLowestSetBit();if(g<0)return x;if(i<g)g=i;if(g>0){x.rShiftTo(g,x);y.rShiftTo(g,y)}while(x.signum()>0){if((i=x.getLowestSetBit())>0)x.rShiftTo(i,x);if((i=y.getLowestSetBit())>0)y.rShiftTo(i,y);if(x.compareTo(y)>=0){x.subTo(y,x);x.rShiftTo(1,x)}else{y.subTo(x,y);y.rShiftTo(1,y)}}if(g>0)y.lShiftTo(g,y);return y}function bnpModInt(n){if(n<=0)return 0;var d=this.DV%n,r=this.s<0?n-1:0;if(this.t>0)if(d==0)r=this[0]%n;else for(var i=this.t-1;i>=0;--i)r=(d*r+this[i])%n;return r}function bnModInverse(m){var ac=m.isEven();if(this.isEven()&&ac||m.signum()==0)return BigInteger.ZERO;var u=m.clone(),v=this.clone();var a=nbv(1),b=nbv(0),c=nbv(0),d=nbv(1);while(u.signum()!=0){while(u.isEven()){u.rShiftTo(1,u);if(ac){if(!a.isEven()||!b.isEven()){a.addTo(this,a);b.subTo(m,b)}a.rShiftTo(1,a)}else if(!b.isEven())b.subTo(m,b);b.rShiftTo(1,b)}while(v.isEven()){v.rShiftTo(1,v);if(ac){if(!c.isEven()||!d.isEven()){c.addTo(this,c);d.subTo(m,d)}c.rShiftTo(1,c)}else if(!d.isEven())d.subTo(m,d);d.rShiftTo(1,d)}if(u.compareTo(v)>=0){u.subTo(v,u);if(ac)a.subTo(c,a);b.subTo(d,b)}else{v.subTo(u,v);if(ac)c.subTo(a,c);d.subTo(b,d)}}if(v.compareTo(BigInteger.ONE)!=0)return BigInteger.ZERO;if(d.compareTo(m)>=0)return d.subtract(m);if(d.signum()<0)d.addTo(m,d);else return d;if(d.signum()<0)return d.add(m);else return d}var lowprimes=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997];var lplim=(1<<26)/lowprimes[lowprimes.length-1];function bnIsProbablePrime(t){var i,x=this.abs();if(x.t==1&&x[0]<=lowprimes[lowprimes.length-1]){for(i=0;i<lowprimes.length;++i)if(x[0]==lowprimes[i])return true;return false}if(x.isEven())return false;i=1;while(i<lowprimes.length){var m=lowprimes[i],j=i+1;while(j<lowprimes.length&&m<lplim)m*=lowprimes[j++];m=x.modInt(m);while(i<j)if(m%lowprimes[i++]==0)return false}return x.millerRabin(t)}function bnpMillerRabin(t){var n1=this.subtract(BigInteger.ONE);var k=n1.getLowestSetBit();if(k<=0)return false;var r=n1.shiftRight(k);t=t+1>>1;if(t>lowprimes.length)t=lowprimes.length;var a=nbi();for(var i=0;i<t;++i){a.fromInt(lowprimes[Math.floor(Math.random()*lowprimes.length)]);var y=a.modPow(r,this);if(y.compareTo(BigInteger.ONE)!=0&&y.compareTo(n1)!=0){var j=1;while(j++<k&&y.compareTo(n1)!=0){y=y.modPowInt(2,this);if(y.compareTo(BigInteger.ONE)==0)return false}if(y.compareTo(n1)!=0)return false}}return true}BigInteger.prototype.chunkSize=bnpChunkSize;BigInteger.prototype.toRadix=bnpToRadix;BigInteger.prototype.fromRadix=bnpFromRadix;BigInteger.prototype.fromNumber=bnpFromNumber;BigInteger.prototype.bitwiseTo=bnpBitwiseTo;BigInteger.prototype.changeBit=bnpChangeBit;BigInteger.prototype.addTo=bnpAddTo;BigInteger.prototype.dMultiply=bnpDMultiply;BigInteger.prototype.dAddOffset=bnpDAddOffset;BigInteger.prototype.multiplyLowerTo=bnpMultiplyLowerTo;BigInteger.prototype.multiplyUpperTo=bnpMultiplyUpperTo;BigInteger.prototype.modInt=bnpModInt;BigInteger.prototype.millerRabin=bnpMillerRabin;BigInteger.prototype.clone=bnClone;BigInteger.prototype.intValue=bnIntValue;BigInteger.prototype.byteValue=bnByteValue;BigInteger.prototype.shortValue=bnShortValue;BigInteger.prototype.signum=bnSigNum;BigInteger.prototype.toByteArray=bnToByteArray;BigInteger.prototype.equals=bnEquals;BigInteger.prototype.min=bnMin;BigInteger.prototype.max=bnMax;BigInteger.prototype.and=bnAnd;BigInteger.prototype.or=bnOr;BigInteger.prototype.xor=bnXor;BigInteger.prototype.andNot=bnAndNot;BigInteger.prototype.not=bnNot;BigInteger.prototype.shiftLeft=bnShiftLeft;BigInteger.prototype.shiftRight=bnShiftRight;BigInteger.prototype.getLowestSetBit=bnGetLowestSetBit;BigInteger.prototype.bitCount=bnBitCount;BigInteger.prototype.testBit=bnTestBit;BigInteger.prototype.setBit=bnSetBit;BigInteger.prototype.clearBit=bnClearBit;BigInteger.prototype.flipBit=bnFlipBit;BigInteger.prototype.add=bnAdd;BigInteger.prototype.subtract=bnSubtract;BigInteger.prototype.multiply=bnMultiply;BigInteger.prototype.divide=bnDivide;BigInteger.prototype.remainder=bnRemainder;BigInteger.prototype.divideAndRemainder=bnDivideAndRemainder;BigInteger.prototype.modPow=bnModPow;BigInteger.prototype.modInverse=bnModInverse;BigInteger.prototype.pow=bnPow;BigInteger.prototype.gcd=bnGCD;BigInteger.prototype.isProbablePrime=bnIsProbablePrime;BigInteger.prototype.square=bnSquare;function parseBigInt(str,r){return new BigInteger(str,r)}function linebrk(s,n){var ret="";var i=0;while(i+n<s.length){ret+=s.substring(i,i+n)+"\n";i+=n}return ret+s.substring(i,s.length)}function byte2Hex(b){if(b<16)return"0"+b.toString(16);else return b.toString(16)}function pkcs1pad2(s,n){if(n<s.length+11){alert("Message too long for RSA");return null}var ba=new Array;var i=s.length-1;while(i>=0&&n>0){var c=s.charCodeAt(i--);if(c<128){ba[--n]=c}else if(c>127&&c<2048){ba[--n]=c&63|128;ba[--n]=c>>6|192}else{ba[--n]=c&63|128;ba[--n]=c>>6&63|128;ba[--n]=c>>12|224}}ba[--n]=0;var rng=new SecureRandom;var x=new Array;while(n>2){x[0]=0;while(x[0]==0)rng.nextBytes(x);ba[--n]=x[0]}ba[--n]=2;ba[--n]=0;return new BigInteger(ba)}function oaep_mgf1_arr(seed,len,hash){var mask="",i=0;while(mask.length<len){mask+=hash(String.fromCharCode.apply(String,seed.concat([(i&4278190080)>>24,(i&16711680)>>16,(i&65280)>>8,i&255])));i+=1}return mask}var SHA1_SIZE=20;function oaep_pad(s,n,hash){if(s.length+2*SHA1_SIZE+2>n){throw"Message too long for RSA"}var PS="",i;for(i=0;i<n-s.length-2*SHA1_SIZE-2;i+=1){PS+="\x00"}var DB=rstr_sha1("")+PS+""+s;var seed=new Array(SHA1_SIZE);(new SecureRandom).nextBytes(seed);var dbMask=oaep_mgf1_arr(seed,DB.length,hash||rstr_sha1);var maskedDB=[];for(i=0;i<DB.length;i+=1){maskedDB[i]=DB.charCodeAt(i)^dbMask.charCodeAt(i)}var seedMask=oaep_mgf1_arr(maskedDB,seed.length,rstr_sha1);var maskedSeed=[0];for(i=0;i<seed.length;i+=1){maskedSeed[i+1]=seed[i]^seedMask.charCodeAt(i)}return new BigInteger(maskedSeed.concat(maskedDB))}function RSAKey(){this.n=null;this.e=0;this.d=null;this.p=null;this.q=null;this.dmp1=null;this.dmq1=null;this.coeff=null}function RSASetPublic(N,E){this.isPublic=true;if(typeof N!=="string"){this.n=N;this.e=E}else if(N!=null&&E!=null&&N.length>0&&E.length>0){this.n=parseBigInt(N,16);this.e=parseInt(E,16)}else alert("Invalid RSA public key")}function RSADoPublic(x){return x.modPowInt(this.e,this.n)}function RSAEncrypt(text){var m=pkcs1pad2(text,this.n.bitLength()+7>>3);if(m==null)return null;var c=this.doPublic(m);if(c==null)return null;var h=c.toString(16);if((h.length&1)==0)return h;else return"0"+h}function RSAEncryptOAEP(text,hash){var m=oaep_pad(text,this.n.bitLength()+7>>3,hash);if(m==null)return null;var c=this.doPublic(m);if(c==null)return null;var h=c.toString(16);if((h.length&1)==0)return h;else return"0"+h}RSAKey.prototype.doPublic=RSADoPublic;RSAKey.prototype.setPublic=RSASetPublic;RSAKey.prototype.encrypt=RSAEncrypt;RSAKey.prototype.encryptOAEP=RSAEncryptOAEP;RSAKey.prototype.type="RSA";function pkcs1unpad2(d,n){var b=d.toByteArray();var i=0;while(i<b.length&&b[i]==0)++i;if(b.length-i!=n-1||b[i]!=2)return null;++i;while(b[i]!=0)if(++i>=b.length)return null;var ret="";while(++i<b.length){var c=b[i]&255;if(c<128){ret+=String.fromCharCode(c)}else if(c>191&&c<224){ret+=String.fromCharCode((c&31)<<6|b[i+1]&63);++i}else{ret+=String.fromCharCode((c&15)<<12|(b[i+1]&63)<<6|b[i+2]&63);i+=2}}return ret}function oaep_mgf1_str(seed,len,hash){var mask="",i=0;while(mask.length<len){mask+=hash(seed+String.fromCharCode.apply(String,[(i&4278190080)>>24,(i&16711680)>>16,(i&65280)>>8,i&255]));i+=1}return mask}var SHA1_SIZE=20;function oaep_unpad(d,n,hash){d=d.toByteArray();var i;for(i=0;i<d.length;i+=1){d[i]&=255}while(d.length<n){d.unshift(0)}d=String.fromCharCode.apply(String,d);if(d.length<2*SHA1_SIZE+2){throw"Cipher too short"}var maskedSeed=d.substr(1,SHA1_SIZE);var maskedDB=d.substr(SHA1_SIZE+1);var seedMask=oaep_mgf1_str(maskedDB,SHA1_SIZE,hash||rstr_sha1);var seed=[],i;for(i=0;i<maskedSeed.length;i+=1){seed[i]=maskedSeed.charCodeAt(i)^seedMask.charCodeAt(i)}var dbMask=oaep_mgf1_str(String.fromCharCode.apply(String,seed),d.length-SHA1_SIZE,rstr_sha1);var DB=[];for(i=0;i<maskedDB.length;i+=1){DB[i]=maskedDB.charCodeAt(i)^dbMask.charCodeAt(i)}DB=String.fromCharCode.apply(String,DB);if(DB.substr(0,SHA1_SIZE)!==rstr_sha1("")){throw"Hash mismatch"}DB=DB.substr(SHA1_SIZE);var first_one=DB.indexOf("");var last_zero=first_one!=-1?DB.substr(0,first_one).lastIndexOf("\x00"):-1;if(last_zero+1!=first_one){throw"Malformed data"}return DB.substr(first_one+1)}function RSASetPrivate(N,E,D){this.isPrivate=true;if(typeof N!=="string"){this.n=N;this.e=E;this.d=D}else if(N!=null&&E!=null&&N.length>0&&E.length>0){this.n=parseBigInt(N,16);this.e=parseInt(E,16);this.d=parseBigInt(D,16)}else alert("Invalid RSA private key")}function RSASetPrivateEx(N,E,D,P,Q,DP,DQ,C){this.isPrivate=true;if(N==null)throw"RSASetPrivateEx N == null";if(E==null)throw"RSASetPrivateEx E == null";if(N.length==0)throw"RSASetPrivateEx N.length == 0";if(E.length==0)throw"RSASetPrivateEx E.length == 0";if(N!=null&&E!=null&&N.length>0&&E.length>0){this.n=parseBigInt(N,16);this.e=parseInt(E,16);this.d=parseBigInt(D,16);this.p=parseBigInt(P,16);this.q=parseBigInt(Q,16);this.dmp1=parseBigInt(DP,16);this.dmq1=parseBigInt(DQ,16);this.coeff=parseBigInt(C,16)}else{alert("Invalid RSA private key in RSASetPrivateEx")}}function RSAGenerate(B,E){var rng=new SecureRandom;var qs=B>>1;this.e=parseInt(E,16);var ee=new BigInteger(E,16);for(;;){for(;;){this.p=new BigInteger(B-qs,1,rng);if(this.p.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE)==0&&this.p.isProbablePrime(10))break}for(;;){this.q=new BigInteger(qs,1,rng);if(this.q.subtract(BigInteger.ONE).gcd(ee).compareTo(BigInteger.ONE)==0&&this.q.isProbablePrime(10))break}if(this.p.compareTo(this.q)<=0){var t=this.p;this.p=this.q;this.q=t}var p1=this.p.subtract(BigInteger.ONE);var q1=this.q.subtract(BigInteger.ONE);var phi=p1.multiply(q1);if(phi.gcd(ee).compareTo(BigInteger.ONE)==0){this.n=this.p.multiply(this.q);this.d=ee.modInverse(phi);this.dmp1=this.d.mod(p1);this.dmq1=this.d.mod(q1);this.coeff=this.q.modInverse(this.p);break}}this.isPrivate=true}function RSADoPrivate(x){if(this.p==null||this.q==null)return x.modPow(this.d,this.n);var xp=x.mod(this.p).modPow(this.dmp1,this.p);var xq=x.mod(this.q).modPow(this.dmq1,this.q);while(xp.compareTo(xq)<0)xp=xp.add(this.p);return xp.subtract(xq).multiply(this.coeff).mod(this.p).multiply(this.q).add(xq)}function RSADecrypt(ctext){var c=parseBigInt(ctext,16);var m=this.doPrivate(c);if(m==null)return null;return pkcs1unpad2(m,this.n.bitLength()+7>>3)}function RSADecryptOAEP(ctext,hash){var c=parseBigInt(ctext,16);var m=this.doPrivate(c);if(m==null)return null;return oaep_unpad(m,this.n.bitLength()+7>>3,hash)}RSAKey.prototype.doPrivate=RSADoPrivate;RSAKey.prototype.setPrivate=RSASetPrivate;RSAKey.prototype.setPrivateEx=RSASetPrivateEx;RSAKey.prototype.generate=RSAGenerate;RSAKey.prototype.decrypt=RSADecrypt;RSAKey.prototype.decryptOAEP=RSADecryptOAEP;function Arcfour(){this.i=0;this.j=0;this.S=new Array}function ARC4init(key){var i,j,t;for(i=0;i<256;++i)this.S[i]=i;j=0;for(i=0;i<256;++i){j=j+this.S[i]+key[i%key.length]&255;t=this.S[i];this.S[i]=this.S[j];this.S[j]=t}this.i=0;this.j=0}function ARC4next(){var t;this.i=this.i+1&255;this.j=this.j+this.S[this.i]&255;t=this.S[this.i];this.S[this.i]=this.S[this.j];this.S[this.j]=t;return this.S[t+this.S[this.i]&255]}Arcfour.prototype.init=ARC4init;Arcfour.prototype.next=ARC4next;function prng_newstate(){return new Arcfour}var rng_psize=256;var rng_state;var rng_pool;var rng_pptr;function rng_seed_int(x){rng_pool[rng_pptr++]^=x&255;rng_pool[rng_pptr++]^=x>>8&255;rng_pool[rng_pptr++]^=x>>16&255;rng_pool[rng_pptr++]^=x>>24&255;if(rng_pptr>=rng_psize)rng_pptr-=rng_psize}function rng_seed_time(){rng_seed_int((new Date).getTime())}if(rng_pool==null){rng_pool=new Array;rng_pptr=0;var t;if(navigator.appName=="Netscape"&&navigator.appVersion<"5"&&window.crypto){var z=window.crypto.random(32);for(t=0;t<z.length;++t)rng_pool[rng_pptr++]=z.charCodeAt(t)&255}while(rng_pptr<rng_psize){t=Math.floor(65536*Math.random());rng_pool[rng_pptr++]=t>>>8;rng_pool[rng_pptr++]=t&255}rng_pptr=0;rng_seed_time()}function rng_get_byte(){if(rng_state==null){rng_seed_time();rng_state=prng_newstate();rng_state.init(rng_pool);for(rng_pptr=0;rng_pptr<rng_pool.length;++rng_pptr)rng_pool[rng_pptr]=0;rng_pptr=0}return rng_state.next()}function rng_get_bytes(ba){var i;for(i=0;i<ba.length;++i)ba[i]=rng_get_byte()}function SecureRandom(){}SecureRandom.prototype.nextBytes=rng_get_bytes;var hexcase=0;var b64pad="";function hex_sha1(s){return rstr2hex(rstr_sha1(str2rstr_utf8(s)))}function b64_sha1(s){return rstr2b64(rstr_sha1(str2rstr_utf8(s)))}function any_sha1(s,e){return rstr2any(rstr_sha1(str2rstr_utf8(s)),e)}function hex_hmac_sha1(k,d){return rstr2hex(rstr_hmac_sha1(str2rstr_utf8(k),str2rstr_utf8(d)))}function b64_hmac_sha1(k,d){return rstr2b64(rstr_hmac_sha1(str2rstr_utf8(k),str2rstr_utf8(d)))}function any_hmac_sha1(k,d,e){return rstr2any(rstr_hmac_sha1(str2rstr_utf8(k),str2rstr_utf8(d)),e)}function sha1_vm_test(){return hex_sha1("abc").toLowerCase()=="a9993e364706816aba3e25717850c26c9cd0d89d"}function rstr_sha1(s){return binb2rstr(binb_sha1(rstr2binb(s),s.length*8))}function rstr_hmac_sha1(key,data){var bkey=rstr2binb(key);if(bkey.length>16)bkey=binb_sha1(bkey,key.length*8);var ipad=Array(16),opad=Array(16);for(var i=0;i<16;i++){ipad[i]=bkey[i]^909522486;opad[i]=bkey[i]^1549556828}var hash=binb_sha1(ipad.concat(rstr2binb(data)),512+data.length*8);return binb2rstr(binb_sha1(opad.concat(hash),512+160))}function rstr2hex(input){try{hexcase}catch(e){hexcase=0}var hex_tab=hexcase?"0123456789ABCDEF":"0123456789abcdef";var output="";var x;for(var i=0;i<input.length;i++){x=input.charCodeAt(i);output+=hex_tab.charAt(x>>>4&15)+hex_tab.charAt(x&15)}return output}function rstr2b64(input){try{b64pad}catch(e){b64pad=""}var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var output="";var len=input.length;for(var i=0;i<len;i+=3){var triplet=input.charCodeAt(i)<<16|(i+1<len?input.charCodeAt(i+1)<<8:0)|(i+2<len?input.charCodeAt(i+2):0);for(var j=0;j<4;j++){if(i*8+j*6>input.length*8)output+=b64pad;else output+=tab.charAt(triplet>>>6*(3-j)&63)}}return output}function rstr2any(input,encoding){var divisor=encoding.length;var remainders=Array();var i,q,x,quotient;var dividend=Array(Math.ceil(input.length/2));for(i=0;i<dividend.length;i++){dividend[i]=input.charCodeAt(i*2)<<8|input.charCodeAt(i*2+1)}while(dividend.length>0){quotient=Array();x=0;for(i=0;i<dividend.length;i++){x=(x<<16)+dividend[i];q=Math.floor(x/divisor);x-=q*divisor;if(quotient.length>0||q>0)quotient[quotient.length]=q}remainders[remainders.length]=x;dividend=quotient}var output="";for(i=remainders.length-1;i>=0;i--)output+=encoding.charAt(remainders[i]);var full_length=Math.ceil(input.length*8/(Math.log(encoding.length)/Math.log(2)));for(i=output.length;i<full_length;i++)output=encoding[0]+output;return output}function str2rstr_utf8(input){var output="";var i=-1;var x,y;while(++i<input.length){x=input.charCodeAt(i);y=i+1<input.length?input.charCodeAt(i+1):0;if(55296<=x&&x<=56319&&56320<=y&&y<=57343){x=65536+((x&1023)<<10)+(y&1023);i++}if(x<=127)output+=String.fromCharCode(x);else if(x<=2047)output+=String.fromCharCode(192|x>>>6&31,128|x&63);else if(x<=65535)output+=String.fromCharCode(224|x>>>12&15,128|x>>>6&63,128|x&63);else if(x<=2097151)output+=String.fromCharCode(240|x>>>18&7,128|x>>>12&63,128|x>>>6&63,128|x&63)}return output}function str2rstr_utf16le(input){var output="";for(var i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)&255,input.charCodeAt(i)>>>8&255);return output}function str2rstr_utf16be(input){var output="";for(var i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)>>>8&255,input.charCodeAt(i)&255);return output}function rstr2binb(input){var output=Array(input.length>>2);for(var i=0;i<output.length;i++)output[i]=0;for(var i=0;i<input.length*8;i+=8)output[i>>5]|=(input.charCodeAt(i/8)&255)<<24-i%32;return output}function binb2rstr(input){var output="";for(var i=0;i<input.length*32;i+=8)output+=String.fromCharCode(input[i>>5]>>>24-i%32&255);return output}function binb_sha1(x,len){x[len>>5]|=128<<24-len%32;x[(len+64>>9<<4)+15]=len;var w=Array(80);var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;var e=-1009589776;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;var olde=e;for(var j=0;j<80;j++){if(j<16)w[j]=x[i+j];else w[j]=bit_rol(w[j-3]^w[j-8]^w[j-14]^w[j-16],1);var t=safe_add(safe_add(bit_rol(a,5),sha1_ft(j,b,c,d)),safe_add(safe_add(e,w[j]),sha1_kt(j)));e=d;d=c;c=bit_rol(b,30);b=a;a=t}a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd);e=safe_add(e,olde)}return Array(a,b,c,d,e)}function sha1_ft(t,b,c,d){if(t<20)return b&c|~b&d;if(t<40)return b^c^d;if(t<60)return b&c|b&d|c&d;return b^c^d}function sha1_kt(t){return t<20?1518500249:t<40?1859775393:t<60?-1894007588:-899497514}function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function bit_rol(num,cnt){return num<<cnt|num>>>32-cnt}var hexcase=0;var b64pad="";function hex_sha256(s){return rstr2hex(rstr_sha256(str2rstr_utf8(s)))}function b64_sha256(s){return rstr2b64(rstr_sha256(str2rstr_utf8(s)))}function any_sha256(s,e){return rstr2any(rstr_sha256(str2rstr_utf8(s)),e)}function hex_hmac_sha256(k,d){return rstr2hex(rstr_hmac_sha256(str2rstr_utf8(k),str2rstr_utf8(d)))}function b64_hmac_sha256(k,d){return rstr2b64(rstr_hmac_sha256(str2rstr_utf8(k),str2rstr_utf8(d)))}function any_hmac_sha256(k,d,e){return rstr2any(rstr_hmac_sha256(str2rstr_utf8(k),str2rstr_utf8(d)),e)}function sha256_vm_test(){return hex_sha256("abc").toLowerCase()=="ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad"}function rstr_sha256(s){return binb2rstr(binb_sha256(rstr2binb(s),s.length*8))}function rstr_hmac_sha256(key,data){var bkey=rstr2binb(key);if(bkey.length>16)bkey=binb_sha256(bkey,key.length*8);var ipad=Array(16),opad=Array(16);for(var i=0;i<16;i++){ipad[i]=bkey[i]^909522486;opad[i]=bkey[i]^1549556828}var hash=binb_sha256(ipad.concat(rstr2binb(data)),512+data.length*8);return binb2rstr(binb_sha256(opad.concat(hash),512+256))}function rstr2hex(input){try{hexcase}catch(e){hexcase=0}var hex_tab=hexcase?"0123456789ABCDEF":"0123456789abcdef";var output="";var x;for(var i=0;i<input.length;i++){x=input.charCodeAt(i);output+=hex_tab.charAt(x>>>4&15)+hex_tab.charAt(x&15)}return output}function rstr2b64(input){try{b64pad}catch(e){b64pad=""}var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var output="";var len=input.length;for(var i=0;i<len;i+=3){var triplet=input.charCodeAt(i)<<16|(i+1<len?input.charCodeAt(i+1)<<8:0)|(i+2<len?input.charCodeAt(i+2):0);for(var j=0;j<4;j++){if(i*8+j*6>input.length*8)output+=b64pad;else output+=tab.charAt(triplet>>>6*(3-j)&63)}}return output}function rstr2any(input,encoding){var divisor=encoding.length;var remainders=Array();var i,q,x,quotient;var dividend=Array(Math.ceil(input.length/2));for(i=0;i<dividend.length;i++){dividend[i]=input.charCodeAt(i*2)<<8|input.charCodeAt(i*2+1)}while(dividend.length>0){quotient=Array();x=0;for(i=0;i<dividend.length;i++){x=(x<<16)+dividend[i];q=Math.floor(x/divisor);x-=q*divisor;if(quotient.length>0||q>0)quotient[quotient.length]=q}remainders[remainders.length]=x;dividend=quotient}var output="";for(i=remainders.length-1;i>=0;i--)output+=encoding.charAt(remainders[i]);var full_length=Math.ceil(input.length*8/(Math.log(encoding.length)/Math.log(2)));for(i=output.length;i<full_length;i++)output=encoding[0]+output;return output}function str2rstr_utf8(input){var output="";var i=-1;var x,y;while(++i<input.length){x=input.charCodeAt(i);y=i+1<input.length?input.charCodeAt(i+1):0;if(55296<=x&&x<=56319&&56320<=y&&y<=57343){x=65536+((x&1023)<<10)+(y&1023);
i++}if(x<=127)output+=String.fromCharCode(x);else if(x<=2047)output+=String.fromCharCode(192|x>>>6&31,128|x&63);else if(x<=65535)output+=String.fromCharCode(224|x>>>12&15,128|x>>>6&63,128|x&63);else if(x<=2097151)output+=String.fromCharCode(240|x>>>18&7,128|x>>>12&63,128|x>>>6&63,128|x&63)}return output}function str2rstr_utf16le(input){var output="";for(var i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)&255,input.charCodeAt(i)>>>8&255);return output}function str2rstr_utf16be(input){var output="";for(var i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)>>>8&255,input.charCodeAt(i)&255);return output}function rstr2binb(input){var output=Array(input.length>>2);for(var i=0;i<output.length;i++)output[i]=0;for(var i=0;i<input.length*8;i+=8)output[i>>5]|=(input.charCodeAt(i/8)&255)<<24-i%32;return output}function binb2rstr(input){var output="";for(var i=0;i<input.length*32;i+=8)output+=String.fromCharCode(input[i>>5]>>>24-i%32&255);return output}function sha256_S(X,n){return X>>>n|X<<32-n}function sha256_R(X,n){return X>>>n}function sha256_Ch(x,y,z){return x&y^~x&z}function sha256_Maj(x,y,z){return x&y^x&z^y&z}function sha256_Sigma0256(x){return sha256_S(x,2)^sha256_S(x,13)^sha256_S(x,22)}function sha256_Sigma1256(x){return sha256_S(x,6)^sha256_S(x,11)^sha256_S(x,25)}function sha256_Gamma0256(x){return sha256_S(x,7)^sha256_S(x,18)^sha256_R(x,3)}function sha256_Gamma1256(x){return sha256_S(x,17)^sha256_S(x,19)^sha256_R(x,10)}function sha256_Sigma0512(x){return sha256_S(x,28)^sha256_S(x,34)^sha256_S(x,39)}function sha256_Sigma1512(x){return sha256_S(x,14)^sha256_S(x,18)^sha256_S(x,41)}function sha256_Gamma0512(x){return sha256_S(x,1)^sha256_S(x,8)^sha256_R(x,7)}function sha256_Gamma1512(x){return sha256_S(x,19)^sha256_S(x,61)^sha256_R(x,6)}var sha256_K=new Array(1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998);function binb_sha256(m,l){var HASH=new Array(1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225);var W=new Array(64);var a,b,c,d,e,f,g,h;var i,j,T1,T2;m[l>>5]|=128<<24-l%32;m[(l+64>>9<<4)+15]=l;for(i=0;i<m.length;i+=16){a=HASH[0];b=HASH[1];c=HASH[2];d=HASH[3];e=HASH[4];f=HASH[5];g=HASH[6];h=HASH[7];for(j=0;j<64;j++){if(j<16)W[j]=m[j+i];else W[j]=safe_add(safe_add(safe_add(sha256_Gamma1256(W[j-2]),W[j-7]),sha256_Gamma0256(W[j-15])),W[j-16]);T1=safe_add(safe_add(safe_add(safe_add(h,sha256_Sigma1256(e)),sha256_Ch(e,f,g)),sha256_K[j]),W[j]);T2=safe_add(sha256_Sigma0256(a),sha256_Maj(a,b,c));h=g;g=f;f=e;e=safe_add(d,T1);d=c;c=b;b=a;a=safe_add(T1,T2)}HASH[0]=safe_add(a,HASH[0]);HASH[1]=safe_add(b,HASH[1]);HASH[2]=safe_add(c,HASH[2]);HASH[3]=safe_add(d,HASH[3]);HASH[4]=safe_add(e,HASH[4]);HASH[5]=safe_add(f,HASH[5]);HASH[6]=safe_add(g,HASH[6]);HASH[7]=safe_add(h,HASH[7])}return HASH}function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}var hexcase=0;var b64pad="";function hex_sha512(s){return rstr2hex(rstr_sha512(str2rstr_utf8(s)))}function b64_sha512(s){return rstr2b64(rstr_sha512(str2rstr_utf8(s)))}function any_sha512(s,e){return rstr2any(rstr_sha512(str2rstr_utf8(s)),e)}function hex_hmac_sha512(k,d){return rstr2hex(rstr_hmac_sha512(str2rstr_utf8(k),str2rstr_utf8(d)))}function b64_hmac_sha512(k,d){return rstr2b64(rstr_hmac_sha512(str2rstr_utf8(k),str2rstr_utf8(d)))}function any_hmac_sha512(k,d,e){return rstr2any(rstr_hmac_sha512(str2rstr_utf8(k),str2rstr_utf8(d)),e)}function sha512_vm_test(){return hex_sha512("abc").toLowerCase()=="ddaf35a193617abacc417349ae20413112e6fa4e89a97ea20a9eeee64b55d39a"+"2192992a274fc1a836ba3c23a3feebbd454d4423643ce80e2a9ac94fa54ca49f"}function rstr_sha512(s){return binb2rstr(binb_sha512(rstr2binb(s),s.length*8))}function rstr_hmac_sha512(key,data){var bkey=rstr2binb(key);if(bkey.length>32)bkey=binb_sha512(bkey,key.length*8);var ipad=Array(32),opad=Array(32);for(var i=0;i<32;i++){ipad[i]=bkey[i]^909522486;opad[i]=bkey[i]^1549556828}var hash=binb_sha512(ipad.concat(rstr2binb(data)),1024+data.length*8);return binb2rstr(binb_sha512(opad.concat(hash),1024+512))}function rstr2hex(input){try{hexcase}catch(e){hexcase=0}var hex_tab=hexcase?"0123456789ABCDEF":"0123456789abcdef";var output="";var x;for(var i=0;i<input.length;i++){x=input.charCodeAt(i);output+=hex_tab.charAt(x>>>4&15)+hex_tab.charAt(x&15)}return output}function rstr2b64(input){try{b64pad}catch(e){b64pad=""}var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var output="";var len=input.length;for(var i=0;i<len;i+=3){var triplet=input.charCodeAt(i)<<16|(i+1<len?input.charCodeAt(i+1)<<8:0)|(i+2<len?input.charCodeAt(i+2):0);for(var j=0;j<4;j++){if(i*8+j*6>input.length*8)output+=b64pad;else output+=tab.charAt(triplet>>>6*(3-j)&63)}}return output}function rstr2any(input,encoding){var divisor=encoding.length;var i,j,q,x,quotient;var dividend=Array(Math.ceil(input.length/2));for(i=0;i<dividend.length;i++){dividend[i]=input.charCodeAt(i*2)<<8|input.charCodeAt(i*2+1)}var full_length=Math.ceil(input.length*8/(Math.log(encoding.length)/Math.log(2)));var remainders=Array(full_length);for(j=0;j<full_length;j++){quotient=Array();x=0;for(i=0;i<dividend.length;i++){x=(x<<16)+dividend[i];q=Math.floor(x/divisor);x-=q*divisor;if(quotient.length>0||q>0)quotient[quotient.length]=q}remainders[j]=x;dividend=quotient}var output="";for(i=remainders.length-1;i>=0;i--)output+=encoding.charAt(remainders[i]);return output}function str2rstr_utf8(input){var output="";var i=-1;var x,y;while(++i<input.length){x=input.charCodeAt(i);y=i+1<input.length?input.charCodeAt(i+1):0;if(55296<=x&&x<=56319&&56320<=y&&y<=57343){x=65536+((x&1023)<<10)+(y&1023);i++}if(x<=127)output+=String.fromCharCode(x);else if(x<=2047)output+=String.fromCharCode(192|x>>>6&31,128|x&63);else if(x<=65535)output+=String.fromCharCode(224|x>>>12&15,128|x>>>6&63,128|x&63);else if(x<=2097151)output+=String.fromCharCode(240|x>>>18&7,128|x>>>12&63,128|x>>>6&63,128|x&63)}return output}function str2rstr_utf16le(input){var output="";for(var i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)&255,input.charCodeAt(i)>>>8&255);return output}function str2rstr_utf16be(input){var output="";for(var i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)>>>8&255,input.charCodeAt(i)&255);return output}function rstr2binb(input){var output=Array(input.length>>2);for(var i=0;i<output.length;i++)output[i]=0;for(var i=0;i<input.length*8;i+=8)output[i>>5]|=(input.charCodeAt(i/8)&255)<<24-i%32;return output}function binb2rstr(input){var output="";for(var i=0;i<input.length*32;i+=8)output+=String.fromCharCode(input[i>>5]>>>24-i%32&255);return output}var sha512_k;function binb_sha512(x,len){if(sha512_k==undefined){sha512_k=new Array(new int64(1116352408,-685199838),new int64(1899447441,602891725),new int64(-1245643825,-330482897),new int64(-373957723,-2121671748),new int64(961987163,-213338824),new int64(1508970993,-1241133031),new int64(-1841331548,-1357295717),new int64(-1424204075,-630357736),new int64(-670586216,-1560083902),new int64(310598401,1164996542),new int64(607225278,1323610764),new int64(1426881987,-704662302),new int64(1925078388,-226784913),new int64(-2132889090,991336113),new int64(-1680079193,633803317),new int64(-1046744716,-815192428),new int64(-459576895,-1628353838),new int64(-272742522,944711139),new int64(264347078,-1953704523),new int64(604807628,2007800933),new int64(770255983,1495990901),new int64(1249150122,1856431235),new int64(1555081692,-1119749164),new int64(1996064986,-2096016459),new int64(-1740746414,-295247957),new int64(-1473132947,766784016),new int64(-1341970488,-1728372417),new int64(-1084653625,-1091629340),new int64(-958395405,1034457026),new int64(-710438585,-1828018395),new int64(113926993,-536640913),new int64(338241895,168717936),new int64(666307205,1188179964),new int64(773529912,1546045734),new int64(1294757372,1522805485),new int64(1396182291,-1651133473),new int64(1695183700,-1951439906),new int64(1986661051,1014477480),new int64(-2117940946,1206759142),new int64(-1838011259,344077627),new int64(-1564481375,1290863460),new int64(-1474664885,-1136513023),new int64(-1035236496,-789014639),new int64(-949202525,106217008),new int64(-778901479,-688958952),new int64(-694614492,1432725776),new int64(-200395387,1467031594),new int64(275423344,851169720),new int64(430227734,-1194143544),new int64(506948616,1363258195),new int64(659060556,-544281703),new int64(883997877,-509917016),new int64(958139571,-976659869),new int64(1322822218,-482243893),new int64(1537002063,2003034995),new int64(1747873779,-692930397),new int64(1955562222,1575990012),new int64(2024104815,1125592928),new int64(-2067236844,-1578062990),new int64(-1933114872,442776044),new int64(-1866530822,593698344),new int64(-1538233109,-561857047),new int64(-1090935817,-1295615723),new int64(-965641998,-479046869),new int64(-903397682,-366583396),new int64(-779700025,566280711),new int64(-354779690,-840897762),new int64(-176337025,-294727304),new int64(116418474,1914138554),new int64(174292421,-1563912026),new int64(289380356,-1090974290),new int64(460393269,320620315),new int64(685471733,587496836),new int64(852142971,1086792851),new int64(1017036298,365543100),new int64(1126000580,-1676669620),new int64(1288033470,-885112138),new int64(1501505948,-60457430),new int64(1607167915,987167468),new int64(1816402316,1246189591))}var H=new Array(new int64(1779033703,-205731576),new int64(-1150833019,-2067093701),new int64(1013904242,-23791573),new int64(-1521486534,1595750129),new int64(1359893119,-1377402159),new int64(-1694144372,725511199),new int64(528734635,-79577749),new int64(1541459225,327033209));var T1=new int64(0,0),T2=new int64(0,0),a=new int64(0,0),b=new int64(0,0),c=new int64(0,0),d=new int64(0,0),e=new int64(0,0),f=new int64(0,0),g=new int64(0,0),h=new int64(0,0),s0=new int64(0,0),s1=new int64(0,0),Ch=new int64(0,0),Maj=new int64(0,0),r1=new int64(0,0),r2=new int64(0,0),r3=new int64(0,0);var j,i;var W=new Array(80);for(i=0;i<80;i++)W[i]=new int64(0,0);x[len>>5]|=128<<24-(len&31);x[(len+128>>10<<5)+31]=len;for(i=0;i<x.length;i+=32){int64copy(a,H[0]);int64copy(b,H[1]);int64copy(c,H[2]);int64copy(d,H[3]);int64copy(e,H[4]);int64copy(f,H[5]);int64copy(g,H[6]);int64copy(h,H[7]);for(j=0;j<16;j++){W[j].h=x[i+2*j];W[j].l=x[i+2*j+1]}for(j=16;j<80;j++){int64rrot(r1,W[j-2],19);int64revrrot(r2,W[j-2],29);int64shr(r3,W[j-2],6);s1.l=r1.l^r2.l^r3.l;s1.h=r1.h^r2.h^r3.h;int64rrot(r1,W[j-15],1);int64rrot(r2,W[j-15],8);int64shr(r3,W[j-15],7);s0.l=r1.l^r2.l^r3.l;s0.h=r1.h^r2.h^r3.h;int64add4(W[j],s1,W[j-7],s0,W[j-16])}for(j=0;j<80;j++){Ch.l=e.l&f.l^~e.l&g.l;Ch.h=e.h&f.h^~e.h&g.h;int64rrot(r1,e,14);int64rrot(r2,e,18);int64revrrot(r3,e,9);s1.l=r1.l^r2.l^r3.l;s1.h=r1.h^r2.h^r3.h;int64rrot(r1,a,28);int64revrrot(r2,a,2);int64revrrot(r3,a,7);s0.l=r1.l^r2.l^r3.l;s0.h=r1.h^r2.h^r3.h;Maj.l=a.l&b.l^a.l&c.l^b.l&c.l;Maj.h=a.h&b.h^a.h&c.h^b.h&c.h;int64add5(T1,h,s1,Ch,sha512_k[j],W[j]);int64add(T2,s0,Maj);int64copy(h,g);int64copy(g,f);int64copy(f,e);int64add(e,d,T1);int64copy(d,c);int64copy(c,b);int64copy(b,a);int64add(a,T1,T2)}int64add(H[0],H[0],a);int64add(H[1],H[1],b);int64add(H[2],H[2],c);int64add(H[3],H[3],d);int64add(H[4],H[4],e);int64add(H[5],H[5],f);int64add(H[6],H[6],g);int64add(H[7],H[7],h)}var hash=new Array(16);for(i=0;i<8;i++){hash[2*i]=H[i].h;hash[2*i+1]=H[i].l}return hash}function int64(h,l){this.h=h;this.l=l}function int64copy(dst,src){dst.h=src.h;dst.l=src.l}function int64rrot(dst,x,shift){dst.l=x.l>>>shift|x.h<<32-shift;dst.h=x.h>>>shift|x.l<<32-shift}function int64revrrot(dst,x,shift){dst.l=x.h>>>shift|x.l<<32-shift;dst.h=x.l>>>shift|x.h<<32-shift}function int64shr(dst,x,shift){dst.l=x.l>>>shift|x.h<<32-shift;dst.h=x.h>>>shift}function int64add(dst,x,y){var w0=(x.l&65535)+(y.l&65535);var w1=(x.l>>>16)+(y.l>>>16)+(w0>>>16);var w2=(x.h&65535)+(y.h&65535)+(w1>>>16);var w3=(x.h>>>16)+(y.h>>>16)+(w2>>>16);dst.l=w0&65535|w1<<16;dst.h=w2&65535|w3<<16}function int64add4(dst,a,b,c,d){var w0=(a.l&65535)+(b.l&65535)+(c.l&65535)+(d.l&65535);var w1=(a.l>>>16)+(b.l>>>16)+(c.l>>>16)+(d.l>>>16)+(w0>>>16);var w2=(a.h&65535)+(b.h&65535)+(c.h&65535)+(d.h&65535)+(w1>>>16);var w3=(a.h>>>16)+(b.h>>>16)+(c.h>>>16)+(d.h>>>16)+(w2>>>16);dst.l=w0&65535|w1<<16;dst.h=w2&65535|w3<<16}function int64add5(dst,a,b,c,d,e){var w0=(a.l&65535)+(b.l&65535)+(c.l&65535)+(d.l&65535)+(e.l&65535);var w1=(a.l>>>16)+(b.l>>>16)+(c.l>>>16)+(d.l>>>16)+(e.l>>>16)+(w0>>>16);var w2=(a.h&65535)+(b.h&65535)+(c.h&65535)+(d.h&65535)+(e.h&65535)+(w1>>>16);var w3=(a.h>>>16)+(b.h>>>16)+(c.h>>>16)+(d.h>>>16)+(e.h>>>16)+(w2>>>16);dst.l=w0&65535|w1<<16;dst.h=w2&65535|w3<<16}var hexcase=0;var b64pad="";function hex_md5(s){return rstr2hex(rstr_md5(str2rstr_utf8(s)))}function b64_md5(s){return rstr2b64(rstr_md5(str2rstr_utf8(s)))}function any_md5(s,e){return rstr2any(rstr_md5(str2rstr_utf8(s)),e)}function hex_hmac_md5(k,d){return rstr2hex(rstr_hmac_md5(str2rstr_utf8(k),str2rstr_utf8(d)))}function b64_hmac_md5(k,d){return rstr2b64(rstr_hmac_md5(str2rstr_utf8(k),str2rstr_utf8(d)))}function any_hmac_md5(k,d,e){return rstr2any(rstr_hmac_md5(str2rstr_utf8(k),str2rstr_utf8(d)),e)}function md5_vm_test(){return hex_md5("abc").toLowerCase()=="900150983cd24fb0d6963f7d28e17f72"}function rstr_md5(s){return binl2rstr(binl_md5(rstr2binl(s),s.length*8))}function rstr_hmac_md5(key,data){var bkey=rstr2binl(key);if(bkey.length>16)bkey=binl_md5(bkey,key.length*8);var ipad=Array(16),opad=Array(16);for(var i=0;i<16;i++){ipad[i]=bkey[i]^909522486;opad[i]=bkey[i]^1549556828}var hash=binl_md5(ipad.concat(rstr2binl(data)),512+data.length*8);return binl2rstr(binl_md5(opad.concat(hash),512+128))}function rstr2hex(input){try{hexcase}catch(e){hexcase=0}var hex_tab=hexcase?"0123456789ABCDEF":"0123456789abcdef";var output="";var x;for(var i=0;i<input.length;i++){x=input.charCodeAt(i);output+=hex_tab.charAt(x>>>4&15)+hex_tab.charAt(x&15)}return output}function rstr2b64(input){try{b64pad}catch(e){b64pad=""}var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var output="";var len=input.length;for(var i=0;i<len;i+=3){var triplet=input.charCodeAt(i)<<16|(i+1<len?input.charCodeAt(i+1)<<8:0)|(i+2<len?input.charCodeAt(i+2):0);for(var j=0;j<4;j++){if(i*8+j*6>input.length*8)output+=b64pad;else output+=tab.charAt(triplet>>>6*(3-j)&63)}}return output}function rstr2any(input,encoding){var divisor=encoding.length;var i,j,q,x,quotient;var dividend=Array(Math.ceil(input.length/2));for(i=0;i<dividend.length;i++){dividend[i]=input.charCodeAt(i*2)<<8|input.charCodeAt(i*2+1)}var full_length=Math.ceil(input.length*8/(Math.log(encoding.length)/Math.log(2)));var remainders=Array(full_length);for(j=0;j<full_length;j++){quotient=Array();x=0;for(i=0;i<dividend.length;i++){x=(x<<16)+dividend[i];q=Math.floor(x/divisor);x-=q*divisor;if(quotient.length>0||q>0)quotient[quotient.length]=q}remainders[j]=x;dividend=quotient}var output="";for(i=remainders.length-1;i>=0;i--)output+=encoding.charAt(remainders[i]);return output}function str2rstr_utf8(input){var output="";var i=-1;var x,y;while(++i<input.length){x=input.charCodeAt(i);y=i+1<input.length?input.charCodeAt(i+1):0;if(55296<=x&&x<=56319&&56320<=y&&y<=57343){x=65536+((x&1023)<<10)+(y&1023);i++}if(x<=127)output+=String.fromCharCode(x);else if(x<=2047)output+=String.fromCharCode(192|x>>>6&31,128|x&63);else if(x<=65535)output+=String.fromCharCode(224|x>>>12&15,128|x>>>6&63,128|x&63);else if(x<=2097151)output+=String.fromCharCode(240|x>>>18&7,128|x>>>12&63,128|x>>>6&63,128|x&63)}return output}function str2rstr_utf16le(input){var output="";for(var i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)&255,input.charCodeAt(i)>>>8&255);return output}function str2rstr_utf16be(input){var output="";for(var i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)>>>8&255,input.charCodeAt(i)&255);return output}function rstr2binl(input){var output=Array(input.length>>2);for(var i=0;i<output.length;i++)output[i]=0;for(var i=0;i<input.length*8;i+=8)output[i>>5]|=(input.charCodeAt(i/8)&255)<<i%32;return output}function binl2rstr(input){var output="";for(var i=0;i<input.length*32;i+=8)output+=String.fromCharCode(input[i>>5]>>>i%32&255);return output}function binl_md5(x,len){x[len>>5]|=128<<len%32;x[(len+64>>>9<<4)+14]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=md5_ff(a,b,c,d,x[i+0],7,-680876936);d=md5_ff(d,a,b,c,x[i+1],12,-389564586);c=md5_ff(c,d,a,b,x[i+2],17,606105819);b=md5_ff(b,c,d,a,x[i+3],22,-1044525330);a=md5_ff(a,b,c,d,x[i+4],7,-176418897);d=md5_ff(d,a,b,c,x[i+5],12,1200080426);c=md5_ff(c,d,a,b,x[i+6],17,-1473231341);b=md5_ff(b,c,d,a,x[i+7],22,-45705983);a=md5_ff(a,b,c,d,x[i+8],7,1770035416);d=md5_ff(d,a,b,c,x[i+9],12,-1958414417);c=md5_ff(c,d,a,b,x[i+10],17,-42063);b=md5_ff(b,c,d,a,x[i+11],22,-1990404162);a=md5_ff(a,b,c,d,x[i+12],7,1804603682);d=md5_ff(d,a,b,c,x[i+13],12,-40341101);c=md5_ff(c,d,a,b,x[i+14],17,-1502002290);b=md5_ff(b,c,d,a,x[i+15],22,1236535329);a=md5_gg(a,b,c,d,x[i+1],5,-165796510);d=md5_gg(d,a,b,c,x[i+6],9,-1069501632);c=md5_gg(c,d,a,b,x[i+11],14,643717713);b=md5_gg(b,c,d,a,x[i+0],20,-373897302);a=md5_gg(a,b,c,d,x[i+5],5,-701558691);d=md5_gg(d,a,b,c,x[i+10],9,38016083);c=md5_gg(c,d,a,b,x[i+15],14,-660478335);b=md5_gg(b,c,d,a,x[i+4],20,-405537848);a=md5_gg(a,b,c,d,x[i+9],5,568446438);d=md5_gg(d,a,b,c,x[i+14],9,-1019803690);c=md5_gg(c,d,a,b,x[i+3],14,-187363961);b=md5_gg(b,c,d,a,x[i+8],20,1163531501);a=md5_gg(a,b,c,d,x[i+13],5,-1444681467);d=md5_gg(d,a,b,c,x[i+2],9,-51403784);c=md5_gg(c,d,a,b,x[i+7],14,1735328473);b=md5_gg(b,c,d,a,x[i+12],20,-1926607734);a=md5_hh(a,b,c,d,x[i+5],4,-378558);d=md5_hh(d,a,b,c,x[i+8],11,-2022574463);c=md5_hh(c,d,a,b,x[i+11],16,1839030562);b=md5_hh(b,c,d,a,x[i+14],23,-35309556);a=md5_hh(a,b,c,d,x[i+1],4,-1530992060);d=md5_hh(d,a,b,c,x[i+4],11,1272893353);c=md5_hh(c,d,a,b,x[i+7],16,-155497632);b=md5_hh(b,c,d,a,x[i+10],23,-1094730640);a=md5_hh(a,b,c,d,x[i+13],4,681279174);d=md5_hh(d,a,b,c,x[i+0],11,-358537222);c=md5_hh(c,d,a,b,x[i+3],16,-722521979);b=md5_hh(b,c,d,a,x[i+6],23,76029189);a=md5_hh(a,b,c,d,x[i+9],4,-640364487);d=md5_hh(d,a,b,c,x[i+12],11,-421815835);c=md5_hh(c,d,a,b,x[i+15],16,530742520);b=md5_hh(b,c,d,a,x[i+2],23,-995338651);a=md5_ii(a,b,c,d,x[i+0],6,-198630844);d=md5_ii(d,a,b,c,x[i+7],10,1126891415);c=md5_ii(c,d,a,b,x[i+14],15,-1416354905);b=md5_ii(b,c,d,a,x[i+5],21,-57434055);a=md5_ii(a,b,c,d,x[i+12],6,1700485571);d=md5_ii(d,a,b,c,x[i+3],10,-1894986606);c=md5_ii(c,d,a,b,x[i+10],15,-1051523);b=md5_ii(b,c,d,a,x[i+1],21,-2054922799);a=md5_ii(a,b,c,d,x[i+8],6,1873313359);d=md5_ii(d,a,b,c,x[i+15],10,-30611744);c=md5_ii(c,d,a,b,x[i+6],15,-1560198380);b=md5_ii(b,c,d,a,x[i+13],21,1309151649);a=md5_ii(a,b,c,d,x[i+4],6,-145523070);d=md5_ii(d,a,b,c,x[i+11],10,-1120210379);c=md5_ii(c,d,a,b,x[i+2],15,718787259);b=md5_ii(b,c,d,a,x[i+9],21,-343485551);a=safe_add(a,olda);b=safe_add(b,oldb);c=safe_add(c,oldc);d=safe_add(d,oldd)}return Array(a,b,c,d)}function md5_cmn(q,a,b,x,s,t){return safe_add(bit_rol(safe_add(safe_add(a,q),safe_add(x,t)),s),b)}function md5_ff(a,b,c,d,x,s,t){return md5_cmn(b&c|~b&d,a,b,x,s,t)}function md5_gg(a,b,c,d,x,s,t){return md5_cmn(b&d|c&~d,a,b,x,s,t)}function md5_hh(a,b,c,d,x,s,t){return md5_cmn(b^c^d,a,b,x,s,t)}function md5_ii(a,b,c,d,x,s,t){return md5_cmn(c^(b|~d),a,b,x,s,t)}function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function bit_rol(num,cnt){return num<<cnt|num>>>32-cnt}var hexcase=0;var b64pad="";function hex_rmd160(s){return rstr2hex(rstr_rmd160(str2rstr_utf8(s)))}function b64_rmd160(s){return rstr2b64(rstr_rmd160(str2rstr_utf8(s)))}function any_rmd160(s,e){return rstr2any(rstr_rmd160(str2rstr_utf8(s)),e)}function hex_hmac_rmd160(k,d){return rstr2hex(rstr_hmac_rmd160(str2rstr_utf8(k),str2rstr_utf8(d)))}function b64_hmac_rmd160(k,d){return rstr2b64(rstr_hmac_rmd160(str2rstr_utf8(k),str2rstr_utf8(d)))}function any_hmac_rmd160(k,d,e){return rstr2any(rstr_hmac_rmd160(str2rstr_utf8(k),str2rstr_utf8(d)),e)}function rmd160_vm_test(){return hex_rmd160("abc").toLowerCase()=="8eb208f7e05d987a9b044a8e98c6b087f15a0bfc"}function rstr_rmd160(s){return binl2rstr(binl_rmd160(rstr2binl(s),s.length*8))}function rstr_hmac_rmd160(key,data){var bkey=rstr2binl(key);if(bkey.length>16)bkey=binl_rmd160(bkey,key.length*8);var ipad=Array(16),opad=Array(16);for(var i=0;i<16;i++){ipad[i]=bkey[i]^909522486;opad[i]=bkey[i]^1549556828}var hash=binl_rmd160(ipad.concat(rstr2binl(data)),512+data.length*8);return binl2rstr(binl_rmd160(opad.concat(hash),512+160))}function rstr2hex(input){try{hexcase}catch(e){hexcase=0}var hex_tab=hexcase?"0123456789ABCDEF":"0123456789abcdef";var output="";var x;for(var i=0;i<input.length;i++){x=input.charCodeAt(i);output+=hex_tab.charAt(x>>>4&15)+hex_tab.charAt(x&15)}return output}function rstr2b64(input){try{b64pad}catch(e){b64pad=""}var tab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var output="";var len=input.length;for(var i=0;i<len;i+=3){var triplet=input.charCodeAt(i)<<16|(i+1<len?input.charCodeAt(i+1)<<8:0)|(i+2<len?input.charCodeAt(i+2):0);for(var j=0;j<4;j++){if(i*8+j*6>input.length*8)output+=b64pad;else output+=tab.charAt(triplet>>>6*(3-j)&63)}}return output}function rstr2any(input,encoding){var divisor=encoding.length;var remainders=Array();var i,q,x,quotient;var dividend=Array(Math.ceil(input.length/2));for(i=0;i<dividend.length;i++){dividend[i]=input.charCodeAt(i*2)<<8|input.charCodeAt(i*2+1)}while(dividend.length>0){quotient=Array();x=0;for(i=0;i<dividend.length;i++){x=(x<<16)+dividend[i];q=Math.floor(x/divisor);x-=q*divisor;if(quotient.length>0||q>0)quotient[quotient.length]=q}remainders[remainders.length]=x;dividend=quotient}var output="";for(i=remainders.length-1;i>=0;i--)output+=encoding.charAt(remainders[i]);var full_length=Math.ceil(input.length*8/(Math.log(encoding.length)/Math.log(2)));for(i=output.length;i<full_length;i++)output=encoding[0]+output;return output}function str2rstr_utf8(input){var output="";var i=-1;var x,y;while(++i<input.length){x=input.charCodeAt(i);y=i+1<input.length?input.charCodeAt(i+1):0;if(55296<=x&&x<=56319&&56320<=y&&y<=57343){x=65536+((x&1023)<<10)+(y&1023);i++}if(x<=127)output+=String.fromCharCode(x);else if(x<=2047)output+=String.fromCharCode(192|x>>>6&31,128|x&63);else if(x<=65535)output+=String.fromCharCode(224|x>>>12&15,128|x>>>6&63,128|x&63);else if(x<=2097151)output+=String.fromCharCode(240|x>>>18&7,128|x>>>12&63,128|x>>>6&63,128|x&63)}return output}function str2rstr_utf16le(input){var output="";for(var i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)&255,input.charCodeAt(i)>>>8&255);return output}function str2rstr_utf16be(input){var output="";for(var i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)>>>8&255,input.charCodeAt(i)&255);return output}function rstr2binl(input){var output=Array(input.length>>2);for(var i=0;i<output.length;i++)output[i]=0;for(var i=0;i<input.length*8;i+=8)output[i>>5]|=(input.charCodeAt(i/8)&255)<<i%32;return output}function binl2rstr(input){var output="";for(var i=0;i<input.length*32;i+=8)output+=String.fromCharCode(input[i>>5]>>>i%32&255);return output}function binl_rmd160(x,len){x[len>>5]|=128<<len%32;x[(len+64>>>9<<4)+14]=len;var h0=1732584193;var h1=4023233417;var h2=2562383102;var h3=271733878;var h4=3285377520;for(var i=0;i<x.length;i+=16){var T;var A1=h0,B1=h1,C1=h2,D1=h3,E1=h4;var A2=h0,B2=h1,C2=h2,D2=h3,E2=h4;for(var j=0;j<=79;++j){T=safe_add(A1,rmd160_f(j,B1,C1,D1));T=safe_add(T,x[i+rmd160_r1[j]]);T=safe_add(T,rmd160_K1(j));T=safe_add(bit_rol(T,rmd160_s1[j]),E1);A1=E1;E1=D1;D1=bit_rol(C1,10);C1=B1;B1=T;T=safe_add(A2,rmd160_f(79-j,B2,C2,D2));T=safe_add(T,x[i+rmd160_r2[j]]);T=safe_add(T,rmd160_K2(j));T=safe_add(bit_rol(T,rmd160_s2[j]),E2);A2=E2;E2=D2;D2=bit_rol(C2,10);C2=B2;B2=T}T=safe_add(h1,safe_add(C1,D2));h1=safe_add(h2,safe_add(D1,E2));h2=safe_add(h3,safe_add(E1,A2));h3=safe_add(h4,safe_add(A1,B2));h4=safe_add(h0,safe_add(B1,C2));h0=T}return[h0,h1,h2,h3,h4]}function rmd160_f(j,x,y,z){return 0<=j&&j<=15?x^y^z:16<=j&&j<=31?x&y|~x&z:32<=j&&j<=47?(x|~y)^z:48<=j&&j<=63?x&z|y&~z:64<=j&&j<=79?x^(y|~z):"rmd160_f: j out of range"}function rmd160_K1(j){return 0<=j&&j<=15?0:16<=j&&j<=31?1518500249:32<=j&&j<=47?1859775393:48<=j&&j<=63?2400959708:64<=j&&j<=79?2840853838:"rmd160_K1: j out of range"}function rmd160_K2(j){return 0<=j&&j<=15?1352829926:16<=j&&j<=31?1548603684:32<=j&&j<=47?1836072691:48<=j&&j<=63?2053994217:64<=j&&j<=79?0:"rmd160_K2: j out of range"}var rmd160_r1=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13];var rmd160_r2=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11];var rmd160_s1=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6];var rmd160_s2=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11];function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function bit_rol(num,cnt){return num<<cnt|num>>>32-cnt}function ECFieldElementFp(q,x){this.x=x;this.q=q}function feFpEquals(other){if(other==this)return true;return this.q.equals(other.q)&&this.x.equals(other.x)}function feFpToBigInteger(){return this.x}function feFpNegate(){return new ECFieldElementFp(this.q,this.x.negate().mod(this.q))}function feFpAdd(b){return new ECFieldElementFp(this.q,this.x.add(b.toBigInteger()).mod(this.q))}function feFpSubtract(b){return new ECFieldElementFp(this.q,this.x.subtract(b.toBigInteger()).mod(this.q))}function feFpMultiply(b){return new ECFieldElementFp(this.q,this.x.multiply(b.toBigInteger()).mod(this.q))}function feFpSquare(){return new ECFieldElementFp(this.q,this.x.square().mod(this.q))}function feFpDivide(b){return new ECFieldElementFp(this.q,this.x.multiply(b.toBigInteger().modInverse(this.q)).mod(this.q))}ECFieldElementFp.prototype.equals=feFpEquals;ECFieldElementFp.prototype.toBigInteger=feFpToBigInteger;ECFieldElementFp.prototype.negate=feFpNegate;ECFieldElementFp.prototype.add=feFpAdd;ECFieldElementFp.prototype.subtract=feFpSubtract;ECFieldElementFp.prototype.multiply=feFpMultiply;ECFieldElementFp.prototype.square=feFpSquare;ECFieldElementFp.prototype.divide=feFpDivide;function ECPointFp(curve,x,y,z){this.curve=curve;this.x=x;this.y=y;if(z==null){this.z=BigInteger.ONE}else{this.z=z}this.zinv=null}function pointFpGetX(){if(this.zinv==null){this.zinv=this.z.modInverse(this.curve.q)}return this.curve.fromBigInteger(this.x.toBigInteger().multiply(this.zinv).mod(this.curve.q))}function pointFpGetY(){if(this.zinv==null){this.zinv=this.z.modInverse(this.curve.q)}return this.curve.fromBigInteger(this.y.toBigInteger().multiply(this.zinv).mod(this.curve.q))}function pointFpEquals(other){if(other==this)return true;if(this.isInfinity())return other.isInfinity();if(other.isInfinity())return this.isInfinity();var u,v;u=other.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(other.z)).mod(this.curve.q);if(!u.equals(BigInteger.ZERO))return false;v=other.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(other.z)).mod(this.curve.q);return v.equals(BigInteger.ZERO)}function pointFpIsInfinity(){if(this.x==null&&this.y==null)return true;return this.z.equals(BigInteger.ZERO)&&!this.y.toBigInteger().equals(BigInteger.ZERO)}function pointFpNegate(){return new ECPointFp(this.curve,this.x,this.y.negate(),this.z)}function pointFpAdd(b){if(this.isInfinity())return b;if(b.isInfinity())return this;var u=b.y.toBigInteger().multiply(this.z).subtract(this.y.toBigInteger().multiply(b.z)).mod(this.curve.q);var v=b.x.toBigInteger().multiply(this.z).subtract(this.x.toBigInteger().multiply(b.z)).mod(this.curve.q);if(BigInteger.ZERO.equals(v)){if(BigInteger.ZERO.equals(u)){return this.twice()}return this.curve.getInfinity()}var THREE=new BigInteger("3");var x1=this.x.toBigInteger();var y1=this.y.toBigInteger();var x2=b.x.toBigInteger();var y2=b.y.toBigInteger();var v2=v.square();var v3=v2.multiply(v);var x1v2=x1.multiply(v2);var zu2=u.square().multiply(this.z);var x3=zu2.subtract(x1v2.shiftLeft(1)).multiply(b.z).subtract(v3).multiply(v).mod(this.curve.q);var y3=x1v2.multiply(THREE).multiply(u).subtract(y1.multiply(v3)).subtract(zu2.multiply(u)).multiply(b.z).add(u.multiply(v3)).mod(this.curve.q);var z3=v3.multiply(this.z).multiply(b.z).mod(this.curve.q);return new ECPointFp(this.curve,this.curve.fromBigInteger(x3),this.curve.fromBigInteger(y3),z3)}function pointFpTwice(){if(this.isInfinity())return this;if(this.y.toBigInteger().signum()==0)return this.curve.getInfinity();var THREE=new BigInteger("3");var x1=this.x.toBigInteger();var y1=this.y.toBigInteger();var y1z1=y1.multiply(this.z);var y1sqz1=y1z1.multiply(y1).mod(this.curve.q);var a=this.curve.a.toBigInteger();var w=x1.square().multiply(THREE);if(!BigInteger.ZERO.equals(a)){w=w.add(this.z.square().multiply(a))}w=w.mod(this.curve.q);var x3=w.square().subtract(x1.shiftLeft(3).multiply(y1sqz1)).shiftLeft(1).multiply(y1z1).mod(this.curve.q);var y3=w.multiply(THREE).multiply(x1).subtract(y1sqz1.shiftLeft(1)).shiftLeft(2).multiply(y1sqz1).subtract(w.square().multiply(w)).mod(this.curve.q);var z3=y1z1.square().multiply(y1z1).shiftLeft(3).mod(this.curve.q);return new ECPointFp(this.curve,this.curve.fromBigInteger(x3),this.curve.fromBigInteger(y3),z3)}function pointFpMultiply(k){if(this.isInfinity())return this;if(k.signum()==0)return this.curve.getInfinity();var e=k;var h=e.multiply(new BigInteger("3"));var neg=this.negate();var R=this;var i;for(i=h.bitLength()-2;i>0;--i){R=R.twice();var hBit=h.testBit(i);var eBit=e.testBit(i);if(hBit!=eBit){R=R.add(hBit?this:neg)}}return R}function pointFpMultiplyTwo(j,x,k){var i;if(j.bitLength()>k.bitLength())i=j.bitLength()-1;else i=k.bitLength()-1;var R=this.curve.getInfinity();var both=this.add(x);while(i>=0){R=R.twice();if(j.testBit(i)){if(k.testBit(i)){R=R.add(both)}else{R=R.add(this)}}else{if(k.testBit(i)){R=R.add(x)}}--i}return R}ECPointFp.prototype.getX=pointFpGetX;ECPointFp.prototype.getY=pointFpGetY;ECPointFp.prototype.equals=pointFpEquals;ECPointFp.prototype.isInfinity=pointFpIsInfinity;ECPointFp.prototype.negate=pointFpNegate;ECPointFp.prototype.add=pointFpAdd;ECPointFp.prototype.twice=pointFpTwice;ECPointFp.prototype.multiply=pointFpMultiply;ECPointFp.prototype.multiplyTwo=pointFpMultiplyTwo;function ECCurveFp(q,a,b){this.q=q;this.a=this.fromBigInteger(a);this.b=this.fromBigInteger(b);this.infinity=new ECPointFp(this,null,null)}function curveFpGetQ(){return this.q}function curveFpGetA(){return this.a}function curveFpGetB(){return this.b}function curveFpEquals(other){if(other==this)return true;return this.q.equals(other.q)&&this.a.equals(other.a)&&this.b.equals(other.b)}function curveFpGetInfinity(){return this.infinity}function curveFpFromBigInteger(x){return new ECFieldElementFp(this.q,x)
}function curveFpDecodePointHex(s){switch(parseInt(s.substr(0,2),16)){case 0:return this.infinity;case 2:case 3:return null;case 4:case 6:case 7:var len=(s.length-2)/2;var xHex=s.substr(2,len);var yHex=s.substr(len+2,len);return new ECPointFp(this,this.fromBigInteger(new BigInteger(xHex,16)),this.fromBigInteger(new BigInteger(yHex,16)));default:return null}}ECCurveFp.prototype.getQ=curveFpGetQ;ECCurveFp.prototype.getA=curveFpGetA;ECCurveFp.prototype.getB=curveFpGetB;ECCurveFp.prototype.equals=curveFpEquals;ECCurveFp.prototype.getInfinity=curveFpGetInfinity;ECCurveFp.prototype.fromBigInteger=curveFpFromBigInteger;ECCurveFp.prototype.decodePointHex=curveFpDecodePointHex;(function(){var C=CryptoJS;var C_lib=C.lib;var WordArray=C_lib.WordArray;var C_enc=C.enc;var Base64=C_enc.Base64={stringify:function(wordArray){var words=wordArray.words;var sigBytes=wordArray.sigBytes;var map=this._map;wordArray.clamp();var base64Chars=[];for(var i=0;i<sigBytes;i+=3){var byte1=words[i>>>2]>>>24-i%4*8&255;var byte2=words[i+1>>>2]>>>24-(i+1)%4*8&255;var byte3=words[i+2>>>2]>>>24-(i+2)%4*8&255;var triplet=byte1<<16|byte2<<8|byte3;for(var j=0;j<4&&i+j*.75<sigBytes;j++){base64Chars.push(map.charAt(triplet>>>6*(3-j)&63))}}var paddingChar=map.charAt(64);if(paddingChar){while(base64Chars.length%4){base64Chars.push(paddingChar)}}return base64Chars.join("")},parse:function(base64Str){var base64StrLength=base64Str.length;var map=this._map;var paddingChar=map.charAt(64);if(paddingChar){var paddingIndex=base64Str.indexOf(paddingChar);if(paddingIndex!=-1){base64StrLength=paddingIndex}}var words=[];var nBytes=0;for(var i=0;i<base64StrLength;i++){if(i%4){var bits1=map.indexOf(base64Str.charAt(i-1))<<i%4*2;var bits2=map.indexOf(base64Str.charAt(i))>>>6-i%4*2;words[nBytes>>>2]|=(bits1|bits2)<<24-nBytes%4*8;nBytes++}}return WordArray.create(words,nBytes)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})();function Base64x(){}function stoBA(s){var a=new Array;for(var i=0;i<s.length;i++){a[i]=s.charCodeAt(i)}return a}function BAtos(a){var s="";for(var i=0;i<a.length;i++){s=s+String.fromCharCode(a[i])}return s}function BAtohex(a){var s="";for(var i=0;i<a.length;i++){var hex1=a[i].toString(16);if(hex1.length==1)hex1="0"+hex1;s=s+hex1}return s}function stohex(s){return BAtohex(stoBA(s))}function stob64(s){return hex2b64(stohex(s))}function stob64u(s){return b64tob64u(hex2b64(stohex(s)))}function b64utos(s){return BAtos(b64toBA(b64utob64(s)))}function b64tob64u(s){s=s.replace(/\=/g,"");s=s.replace(/\+/g,"-");s=s.replace(/\//g,"_");return s}function b64utob64(s){if(s.length%4==2)s=s+"==";else if(s.length%4==3)s=s+"=";s=s.replace(/-/g,"+");s=s.replace(/_/g,"/");return s}function hextob64u(s){return b64tob64u(hex2b64(s))}function b64utohex(s){return b64tohex(b64utob64(s))}var utf8tob64u,b64utoutf8;if(typeof Buffer==="function"){utf8tob64u=function(s){return b64tob64u(new Buffer(s,"utf8").toString("base64"))};b64utoutf8=function(s){return new Buffer(b64utob64(s),"base64").toString("utf8")}}else{utf8tob64u=function(s){return hextob64u(uricmptohex(encodeURIComponentAll(s)))};b64utoutf8=function(s){return decodeURIComponent(hextouricmp(b64utohex(s)))}}function utf8tob64(s){return hex2b64(uricmptohex(encodeURIComponentAll(s)))}function b64toutf8(s){return decodeURIComponent(hextouricmp(b64tohex(s)))}function utf8tohex(s){return uricmptohex(encodeURIComponentAll(s))}function hextoutf8(s){return decodeURIComponent(hextouricmp(s))}function hextorstr(sHex){var s="";for(var i=0;i<sHex.length-1;i+=2){s+=String.fromCharCode(parseInt(sHex.substr(i,2),16))}return s}function rstrtohex(s){var result="";for(var i=0;i<s.length;i++){result+=("0"+s.charCodeAt(i).toString(16)).slice(-2)}return result}function hextob64(s){return hex2b64(s)}function hextob64nl(s){var b64=hextob64(s);var b64nl=b64.replace(/(.{64})/g,"$1\r\n");b64nl=b64nl.replace(/\r\n$/,"");return b64nl}function b64nltohex(s){var b64=s.replace(/[^0-9A-Za-z\/+=]*/g,"");var hex=b64tohex(b64);return hex}function uricmptohex(s){return s.replace(/%/g,"")}function hextouricmp(s){return s.replace(/(..)/g,"%$1")}function encodeURIComponentAll(u8){var s=encodeURIComponent(u8);var s2="";for(var i=0;i<s.length;i++){if(s[i]=="%"){s2=s2+s.substr(i,3);i=i+2}else{s2=s2+"%"+stohex(s[i])}}return s2}function newline_toUnix(s){s=s.replace(/\r\n/gm,"\n");return s}function newline_toDos(s){s=s.replace(/\r\n/gm,"\n");s=s.replace(/\n/gm,"\r\n");return s}function X509(){this.subjectPublicKeyRSA=null;this.subjectPublicKeyRSA_hN=null;this.subjectPublicKeyRSA_hE=null;this.hex=null;this.getSerialNumberHex=function(){return ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,1])};this.getIssuerHex=function(){return ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,3])};this.getIssuerString=function(){return X509.hex2dn(ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,3]))};this.getSubjectHex=function(){return ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,5])};this.getSubjectString=function(){return X509.hex2dn(ASN1HEX.getDecendantHexTLVByNthList(this.hex,0,[0,5]))};this.getNotBefore=function(){var s=ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,4,0]);s=s.replace(/(..)/g,"%$1");s=decodeURIComponent(s);return s};this.getNotAfter=function(){var s=ASN1HEX.getDecendantHexVByNthList(this.hex,0,[0,4,1]);s=s.replace(/(..)/g,"%$1");s=decodeURIComponent(s);return s};this.readCertPEM=function(sCertPEM){var hCert=X509.pemToHex(sCertPEM);var a=X509.getPublicKeyHexArrayFromCertHex(hCert);var rsa=new RSAKey;rsa.setPublic(a[0],a[1]);this.subjectPublicKeyRSA=rsa;this.subjectPublicKeyRSA_hN=a[0];this.subjectPublicKeyRSA_hE=a[1];this.hex=hCert};this.readCertPEMWithoutRSAInit=function(sCertPEM){var hCert=X509.pemToHex(sCertPEM);var a=X509.getPublicKeyHexArrayFromCertHex(hCert);this.subjectPublicKeyRSA.setPublic(a[0],a[1]);this.subjectPublicKeyRSA_hN=a[0];this.subjectPublicKeyRSA_hE=a[1];this.hex=hCert}}X509.pemToBase64=function(sCertPEM){var s=sCertPEM;s=s.replace("-----BEGIN CERTIFICATE-----","");s=s.replace("-----END CERTIFICATE-----","");s=s.replace(/[ \n]+/g,"");return s};X509.pemToHex=function(sCertPEM){var b64Cert=X509.pemToBase64(sCertPEM);var hCert=b64tohex(b64Cert);return hCert};X509.getSubjectPublicKeyPosFromCertHex=function(hCert){var pInfo=X509.getSubjectPublicKeyInfoPosFromCertHex(hCert);if(pInfo==-1)return-1;var a=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,pInfo);if(a.length!=2)return-1;var pBitString=a[1];if(hCert.substring(pBitString,pBitString+2)!="03")return-1;var pBitStringV=ASN1HEX.getStartPosOfV_AtObj(hCert,pBitString);if(hCert.substring(pBitStringV,pBitStringV+2)!="00")return-1;return pBitStringV+2};X509.getSubjectPublicKeyInfoPosFromCertHex=function(hCert){var pTbsCert=ASN1HEX.getStartPosOfV_AtObj(hCert,0);var a=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,pTbsCert);if(a.length<1)return-1;if(hCert.substring(a[0],a[0]+10)=="a003020102"){if(a.length<6)return-1;return a[6]}else{if(a.length<5)return-1;return a[5]}};X509.getPublicKeyHexArrayFromCertHex=function(hCert){var p=X509.getSubjectPublicKeyPosFromCertHex(hCert);var a=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,p);if(a.length!=2)return[];var hN=ASN1HEX.getHexOfV_AtObj(hCert,a[0]);var hE=ASN1HEX.getHexOfV_AtObj(hCert,a[1]);if(hN!=null&&hE!=null){return[hN,hE]}else{return[]}};X509.getHexTbsCertificateFromCert=function(hCert){var pTbsCert=ASN1HEX.getStartPosOfV_AtObj(hCert,0);return pTbsCert};X509.getPublicKeyHexArrayFromCertPEM=function(sCertPEM){var hCert=X509.pemToHex(sCertPEM);var a=X509.getPublicKeyHexArrayFromCertHex(hCert);return a};X509.hex2dn=function(hDN){var s="";var a=ASN1HEX.getPosArrayOfChildren_AtObj(hDN,0);for(var i=0;i<a.length;i++){var hRDN=ASN1HEX.getHexOfTLV_AtObj(hDN,a[i]);s=s+"/"+X509.hex2rdn(hRDN)}return s};X509.hex2rdn=function(hRDN){var hType=ASN1HEX.getDecendantHexTLVByNthList(hRDN,0,[0,0]);var hValue=ASN1HEX.getDecendantHexVByNthList(hRDN,0,[0,1]);var type="";try{type=X509.DN_ATTRHEX[hType]}catch(ex){type=hType}hValue=hValue.replace(/(..)/g,"%$1");var value=decodeURIComponent(hValue);return type+"="+value};X509.DN_ATTRHEX={"0603550406":"C","060355040a":"O","060355040b":"OU","0603550403":"CN","0603550405":"SN","0603550408":"ST","0603550407":"L"};X509.getPublicKeyFromCertPEM=function(sCertPEM){var info=X509.getPublicKeyInfoPropOfCertPEM(sCertPEM);if(info.algoid=="2a864886f70d010101"){var aRSA=KEYUTIL.parsePublicRawRSAKeyHex(info.keyhex);var key=new RSAKey;key.setPublic(aRSA.n,aRSA.e);return key}else if(info.algoid=="2a8648ce3d0201"){var curveName=KJUR.crypto.OID.oidhex2name[info.algparam];var key=new KJUR.crypto.ECDSA({curve:curveName,info:info.keyhex});key.setPublicKeyHex(info.keyhex);return key}else if(info.algoid=="2a8648ce380401"){var p=ASN1HEX.getVbyList(info.algparam,0,[0],"02");var q=ASN1HEX.getVbyList(info.algparam,0,[1],"02");var g=ASN1HEX.getVbyList(info.algparam,0,[2],"02");var y=ASN1HEX.getHexOfV_AtObj(info.keyhex,0);y=y.substr(2);var key=new KJUR.crypto.DSA;key.setPublic(new BigInteger(p,16),new BigInteger(q,16),new BigInteger(g,16),new BigInteger(y,16));return key}else{throw"unsupported key"}};X509.getPublicKeyInfoPropOfCertPEM=function(sCertPEM){var result={};result.algparam=null;var hCert=X509.pemToHex(sCertPEM);var a1=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,0);if(a1.length!=3)throw"malformed X.509 certificate PEM (code:001)";if(hCert.substr(a1[0],2)!="30")throw"malformed X.509 certificate PEM (code:002)";var a2=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,a1[0]);if(a2.length<7)throw"malformed X.509 certificate PEM (code:003)";var a3=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,a2[6]);if(a3.length!=2)throw"malformed X.509 certificate PEM (code:004)";var a4=ASN1HEX.getPosArrayOfChildren_AtObj(hCert,a3[0]);if(a4.length!=2)throw"malformed X.509 certificate PEM (code:005)";result.algoid=ASN1HEX.getHexOfV_AtObj(hCert,a4[0]);if(hCert.substr(a4[1],2)=="06"){result.algparam=ASN1HEX.getHexOfV_AtObj(hCert,a4[1])}else if(hCert.substr(a4[1],2)=="30"){result.algparam=ASN1HEX.getHexOfTLV_AtObj(hCert,a4[1])}if(hCert.substr(a3[1],2)!="03")throw"malformed X.509 certificate PEM (code:006)";var unusedBitAndKeyHex=ASN1HEX.getHexOfV_AtObj(hCert,a3[1]);result.keyhex=unusedBitAndKeyHex.substr(2);return result};if(typeof KJUR=="undefined"||!KJUR)KJUR={};if(typeof KJUR.asn1=="undefined"||!KJUR.asn1)KJUR.asn1={};KJUR.asn1.ASN1Util=new function(){this.integerToByteHex=function(i){var h=i.toString(16);if(h.length%2==1)h="0"+h;return h};this.bigIntToMinTwosComplementsHex=function(bigIntegerValue){var h=bigIntegerValue.toString(16);if(h.substr(0,1)!="-"){if(h.length%2==1){h="0"+h}else{if(!h.match(/^[0-7]/)){h="00"+h}}}else{var hPos=h.substr(1);var xorLen=hPos.length;if(xorLen%2==1){xorLen+=1}else{if(!h.match(/^[0-7]/)){xorLen+=2}}var hMask="";for(var i=0;i<xorLen;i++){hMask+="f"}var biMask=new BigInteger(hMask,16);var biNeg=biMask.xor(bigIntegerValue).add(BigInteger.ONE);h=biNeg.toString(16).replace(/^-/,"")}return h};this.getPEMStringFromHex=function(dataHex,pemHeader){var ns1=KJUR.asn1;var dataWA=CryptoJS.enc.Hex.parse(dataHex);var dataB64=CryptoJS.enc.Base64.stringify(dataWA);var pemBody=dataB64.replace(/(.{64})/g,"$1\r\n");pemBody=pemBody.replace(/\r\n$/,"");return"-----BEGIN "+pemHeader+"-----\r\n"+pemBody+"\r\n-----END "+pemHeader+"-----\r\n"};this.newObject=function(param){var ns1=KJUR.asn1;var keys=Object.keys(param);if(keys.length!=1)throw"key of param shall be only one.";var key=keys[0];if(":bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:seq:set:tag:".indexOf(":"+key+":")==-1)throw"undefined key: "+key;if(key=="bool")return new ns1.DERBoolean(param[key]);if(key=="int")return new ns1.DERInteger(param[key]);if(key=="bitstr")return new ns1.DERBitString(param[key]);if(key=="octstr")return new ns1.DEROctetString(param[key]);if(key=="null")return new ns1.DERNull(param[key]);if(key=="oid")return new ns1.DERObjectIdentifier(param[key]);if(key=="enum")return new ns1.DEREnumerated(param[key]);if(key=="utf8str")return new ns1.DERUTF8String(param[key]);if(key=="numstr")return new ns1.DERNumericString(param[key]);if(key=="prnstr")return new ns1.DERPrintableString(param[key]);if(key=="telstr")return new ns1.DERTeletexString(param[key]);if(key=="ia5str")return new ns1.DERIA5String(param[key]);if(key=="utctime")return new ns1.DERUTCTime(param[key]);if(key=="gentime")return new ns1.DERGeneralizedTime(param[key]);if(key=="seq"){var paramList=param[key];var a=[];for(var i=0;i<paramList.length;i++){var asn1Obj=ns1.ASN1Util.newObject(paramList[i]);a.push(asn1Obj)}return new ns1.DERSequence({array:a})}if(key=="set"){var paramList=param[key];var a=[];for(var i=0;i<paramList.length;i++){var asn1Obj=ns1.ASN1Util.newObject(paramList[i]);a.push(asn1Obj)}return new ns1.DERSet({array:a})}if(key=="tag"){var tagParam=param[key];if(Object.prototype.toString.call(tagParam)==="[object Array]"&&tagParam.length==3){var obj=ns1.ASN1Util.newObject(tagParam[2]);return new ns1.DERTaggedObject({tag:tagParam[0],explicit:tagParam[1],obj:obj})}else{var newParam={};if(tagParam.explicit!==undefined)newParam.explicit=tagParam.explicit;if(tagParam.tag!==undefined)newParam.tag=tagParam.tag;if(tagParam.obj===undefined)throw"obj shall be specified for 'tag'.";newParam.obj=ns1.ASN1Util.newObject(tagParam.obj);return new ns1.DERTaggedObject(newParam)}}};this.jsonToASN1HEX=function(param){var asn1Obj=this.newObject(param);return asn1Obj.getEncodedHex()}};KJUR.asn1.ASN1Object=function(){var isModified=true;var hTLV=null;var hT="00";var hL="00";var hV="";this.getLengthHexFromValue=function(){if(typeof this.hV=="undefined"||this.hV==null){throw"this.hV is null or undefined."}if(this.hV.length%2==1){throw"value hex must be even length: n="+hV.length+",v="+this.hV}var n=this.hV.length/2;var hN=n.toString(16);if(hN.length%2==1){hN="0"+hN}if(n<128){return hN}else{var hNlen=hN.length/2;if(hNlen>15){throw"ASN.1 length too long to represent by 8x: n = "+n.toString(16)}var head=128+hNlen;return head.toString(16)+hN}};this.getEncodedHex=function(){if(this.hTLV==null||this.isModified){this.hV=this.getFreshValueHex();this.hL=this.getLengthHexFromValue();this.hTLV=this.hT+this.hL+this.hV;this.isModified=false}return this.hTLV};this.getValueHex=function(){this.getEncodedHex();return this.hV};this.getFreshValueHex=function(){return""}};KJUR.asn1.DERAbstractString=function(params){KJUR.asn1.DERAbstractString.superclass.constructor.call(this);var s=null;var hV=null;this.getString=function(){return this.s};this.setString=function(newS){this.hTLV=null;this.isModified=true;this.s=newS;this.hV=stohex(this.s)};this.setStringHex=function(newHexString){this.hTLV=null;this.isModified=true;this.s=null;this.hV=newHexString};this.getFreshValueHex=function(){return this.hV};if(typeof params!="undefined"){if(typeof params=="string"){this.setString(params)}else if(typeof params["str"]!="undefined"){this.setString(params["str"])}else if(typeof params["hex"]!="undefined"){this.setStringHex(params["hex"])}}};YAHOO.lang.extend(KJUR.asn1.DERAbstractString,KJUR.asn1.ASN1Object);KJUR.asn1.DERAbstractTime=function(params){KJUR.asn1.DERAbstractTime.superclass.constructor.call(this);var s=null;var date=null;this.localDateToUTC=function(d){utc=d.getTime()+d.getTimezoneOffset()*6e4;var utcDate=new Date(utc);return utcDate};this.formatDate=function(dateObject,type,withMillis){var pad=this.zeroPadding;var d=this.localDateToUTC(dateObject);var year=String(d.getFullYear());if(type=="utc")year=year.substr(2,2);var month=pad(String(d.getMonth()+1),2);var day=pad(String(d.getDate()),2);var hour=pad(String(d.getHours()),2);var min=pad(String(d.getMinutes()),2);var sec=pad(String(d.getSeconds()),2);var s=year+month+day+hour+min+sec;if(withMillis===true){var millis=d.getMilliseconds();if(millis!=0){var sMillis=pad(String(millis),3);sMillis=sMillis.replace(/[0]+$/,"");s=s+"."+sMillis}}return s+"Z"};this.zeroPadding=function(s,len){if(s.length>=len)return s;return new Array(len-s.length+1).join("0")+s};this.getString=function(){return this.s};this.setString=function(newS){this.hTLV=null;this.isModified=true;this.s=newS;this.hV=stohex(newS)};this.setByDateValue=function(year,month,day,hour,min,sec){var dateObject=new Date(Date.UTC(year,month-1,day,hour,min,sec,0));this.setByDate(dateObject)};this.getFreshValueHex=function(){return this.hV}};YAHOO.lang.extend(KJUR.asn1.DERAbstractTime,KJUR.asn1.ASN1Object);KJUR.asn1.DERAbstractStructured=function(params){KJUR.asn1.DERAbstractString.superclass.constructor.call(this);var asn1Array=null;this.setByASN1ObjectArray=function(asn1ObjectArray){this.hTLV=null;this.isModified=true;this.asn1Array=asn1ObjectArray};this.appendASN1Object=function(asn1Object){this.hTLV=null;this.isModified=true;this.asn1Array.push(asn1Object)};this.asn1Array=new Array;if(typeof params!="undefined"){if(typeof params["array"]!="undefined"){this.asn1Array=params["array"]}}};YAHOO.lang.extend(KJUR.asn1.DERAbstractStructured,KJUR.asn1.ASN1Object);KJUR.asn1.DERBoolean=function(){KJUR.asn1.DERBoolean.superclass.constructor.call(this);this.hT="01";this.hTLV="0101ff"};YAHOO.lang.extend(KJUR.asn1.DERBoolean,KJUR.asn1.ASN1Object);KJUR.asn1.DERInteger=function(params){KJUR.asn1.DERInteger.superclass.constructor.call(this);this.hT="02";this.setByBigInteger=function(bigIntegerValue){this.hTLV=null;this.isModified=true;this.hV=KJUR.asn1.ASN1Util.bigIntToMinTwosComplementsHex(bigIntegerValue)};this.setByInteger=function(intValue){var bi=new BigInteger(String(intValue),10);this.setByBigInteger(bi)};this.setValueHex=function(newHexString){this.hV=newHexString};this.getFreshValueHex=function(){return this.hV};if(typeof params!="undefined"){if(typeof params["bigint"]!="undefined"){this.setByBigInteger(params["bigint"])}else if(typeof params["int"]!="undefined"){this.setByInteger(params["int"])}else if(typeof params=="number"){this.setByInteger(params)}else if(typeof params["hex"]!="undefined"){this.setValueHex(params["hex"])}}};YAHOO.lang.extend(KJUR.asn1.DERInteger,KJUR.asn1.ASN1Object);KJUR.asn1.DERBitString=function(params){KJUR.asn1.DERBitString.superclass.constructor.call(this);this.hT="03";this.setHexValueIncludingUnusedBits=function(newHexStringIncludingUnusedBits){this.hTLV=null;this.isModified=true;this.hV=newHexStringIncludingUnusedBits};this.setUnusedBitsAndHexValue=function(unusedBits,hValue){if(unusedBits<0||7<unusedBits){throw"unused bits shall be from 0 to 7: u = "+unusedBits}var hUnusedBits="0"+unusedBits;this.hTLV=null;this.isModified=true;this.hV=hUnusedBits+hValue};this.setByBinaryString=function(binaryString){binaryString=binaryString.replace(/0+$/,"");var unusedBits=8-binaryString.length%8;if(unusedBits==8)unusedBits=0;for(var i=0;i<=unusedBits;i++){binaryString+="0"}var h="";for(var i=0;i<binaryString.length-1;i+=8){var b=binaryString.substr(i,8);var x=parseInt(b,2).toString(16);if(x.length==1)x="0"+x;h+=x}this.hTLV=null;this.isModified=true;this.hV="0"+unusedBits+h};this.setByBooleanArray=function(booleanArray){var s="";for(var i=0;i<booleanArray.length;i++){if(booleanArray[i]==true){s+="1"}else{s+="0"}}this.setByBinaryString(s)};this.newFalseArray=function(nLength){var a=new Array(nLength);for(var i=0;i<nLength;i++){a[i]=false}return a};this.getFreshValueHex=function(){return this.hV};if(typeof params!="undefined"){if(typeof params=="string"&&params.toLowerCase().match(/^[0-9a-f]+$/)){this.setHexValueIncludingUnusedBits(params)}else if(typeof params["hex"]!="undefined"){this.setHexValueIncludingUnusedBits(params["hex"])}else if(typeof params["bin"]!="undefined"){this.setByBinaryString(params["bin"])}else if(typeof params["array"]!="undefined"){this.setByBooleanArray(params["array"])}}};YAHOO.lang.extend(KJUR.asn1.DERBitString,KJUR.asn1.ASN1Object);KJUR.asn1.DEROctetString=function(params){KJUR.asn1.DEROctetString.superclass.constructor.call(this,params);this.hT="04"};YAHOO.lang.extend(KJUR.asn1.DEROctetString,KJUR.asn1.DERAbstractString);KJUR.asn1.DERNull=function(){KJUR.asn1.DERNull.superclass.constructor.call(this);this.hT="05";this.hTLV="0500"};YAHOO.lang.extend(KJUR.asn1.DERNull,KJUR.asn1.ASN1Object);KJUR.asn1.DERObjectIdentifier=function(params){var itox=function(i){var h=i.toString(16);if(h.length==1)h="0"+h;return h};var roidtox=function(roid){var h="";var bi=new BigInteger(roid,10);var b=bi.toString(2);var padLen=7-b.length%7;if(padLen==7)padLen=0;var bPad="";for(var i=0;i<padLen;i++)bPad+="0";b=bPad+b;for(var i=0;i<b.length-1;i+=7){var b8=b.substr(i,7);if(i!=b.length-7)b8="1"+b8;h+=itox(parseInt(b8,2))}return h};KJUR.asn1.DERObjectIdentifier.superclass.constructor.call(this);this.hT="06";this.setValueHex=function(newHexString){this.hTLV=null;this.isModified=true;this.s=null;this.hV=newHexString};this.setValueOidString=function(oidString){if(!oidString.match(/^[0-9.]+$/)){throw"malformed oid string: "+oidString}var h="";var a=oidString.split(".");var i0=parseInt(a[0])*40+parseInt(a[1]);h+=itox(i0);a.splice(0,2);for(var i=0;i<a.length;i++){h+=roidtox(a[i])}this.hTLV=null;this.isModified=true;this.s=null;this.hV=h};this.setValueName=function(oidName){if(typeof KJUR.asn1.x509.OID.name2oidList[oidName]!="undefined"){var oid=KJUR.asn1.x509.OID.name2oidList[oidName];this.setValueOidString(oid)}else{throw"DERObjectIdentifier oidName undefined: "+oidName}};this.getFreshValueHex=function(){return this.hV};if(typeof params!="undefined"){if(typeof params=="string"&&params.match(/^[0-2].[0-9.]+$/)){this.setValueOidString(params)}else if(KJUR.asn1.x509.OID.name2oidList[params]!==undefined){this.setValueOidString(KJUR.asn1.x509.OID.name2oidList[params])}else if(typeof params["oid"]!="undefined"){this.setValueOidString(params["oid"])}else if(typeof params["hex"]!="undefined"){this.setValueHex(params["hex"])}else if(typeof params["name"]!="undefined"){this.setValueName(params["name"])}}};YAHOO.lang.extend(KJUR.asn1.DERObjectIdentifier,KJUR.asn1.ASN1Object);KJUR.asn1.DEREnumerated=function(params){KJUR.asn1.DEREnumerated.superclass.constructor.call(this);this.hT="0a";this.setByBigInteger=function(bigIntegerValue){this.hTLV=null;this.isModified=true;this.hV=KJUR.asn1.ASN1Util.bigIntToMinTwosComplementsHex(bigIntegerValue)};this.setByInteger=function(intValue){var bi=new BigInteger(String(intValue),10);this.setByBigInteger(bi)};this.setValueHex=function(newHexString){this.hV=newHexString};this.getFreshValueHex=function(){return this.hV};if(typeof params!="undefined"){if(typeof params["int"]!="undefined"){this.setByInteger(params["int"])}else if(typeof params=="number"){this.setByInteger(params)}else if(typeof params["hex"]!="undefined"){this.setValueHex(params["hex"])}}};YAHOO.lang.extend(KJUR.asn1.DEREnumerated,KJUR.asn1.ASN1Object);KJUR.asn1.DERUTF8String=function(params){KJUR.asn1.DERUTF8String.superclass.constructor.call(this,params);this.hT="0c"};YAHOO.lang.extend(KJUR.asn1.DERUTF8String,KJUR.asn1.DERAbstractString);KJUR.asn1.DERNumericString=function(params){KJUR.asn1.DERNumericString.superclass.constructor.call(this,params);this.hT="12"};YAHOO.lang.extend(KJUR.asn1.DERNumericString,KJUR.asn1.DERAbstractString);KJUR.asn1.DERPrintableString=function(params){KJUR.asn1.DERPrintableString.superclass.constructor.call(this,params);this.hT="13"};YAHOO.lang.extend(KJUR.asn1.DERPrintableString,KJUR.asn1.DERAbstractString);KJUR.asn1.DERTeletexString=function(params){KJUR.asn1.DERTeletexString.superclass.constructor.call(this,params);this.hT="14"};YAHOO.lang.extend(KJUR.asn1.DERTeletexString,KJUR.asn1.DERAbstractString);KJUR.asn1.DERIA5String=function(params){KJUR.asn1.DERIA5String.superclass.constructor.call(this,params);this.hT="16"};YAHOO.lang.extend(KJUR.asn1.DERIA5String,KJUR.asn1.DERAbstractString);KJUR.asn1.DERUTCTime=function(params){KJUR.asn1.DERUTCTime.superclass.constructor.call(this,params);this.hT="17";this.setByDate=function(dateObject){this.hTLV=null;this.isModified=true;this.date=dateObject;this.s=this.formatDate(this.date,"utc");this.hV=stohex(this.s)};this.getFreshValueHex=function(){if(typeof this.date=="undefined"&&typeof this.s=="undefined"){this.date=new Date;this.s=this.formatDate(this.date,"utc");this.hV=stohex(this.s)}return this.hV};if(typeof params!="undefined"){if(typeof params["str"]!="undefined"){this.setString(params["str"])}else if(typeof params=="string"&&params.match(/^[0-9]{12}Z$/)){this.setString(params)}else if(typeof params["hex"]!="undefined"){this.setStringHex(params["hex"])}else if(typeof params["date"]!="undefined"){this.setByDate(params["date"])}}};YAHOO.lang.extend(KJUR.asn1.DERUTCTime,KJUR.asn1.DERAbstractTime);KJUR.asn1.DERGeneralizedTime=function(params){KJUR.asn1.DERGeneralizedTime.superclass.constructor.call(this,params);this.hT="18";this.withMillis=false;this.setByDate=function(dateObject){this.hTLV=null;this.isModified=true;this.date=dateObject;this.s=this.formatDate(this.date,"gen",this.withMillis);this.hV=stohex(this.s)};this.getFreshValueHex=function(){if(typeof this.date=="undefined"&&typeof this.s=="undefined"){this.date=new Date;this.s=this.formatDate(this.date,"gen",this.withMillis);this.hV=stohex(this.s)}return this.hV};if(typeof params!="undefined"){if(typeof params["str"]!="undefined"){this.setString(params["str"])}else if(typeof params=="string"&&params.match(/^[0-9]{14}Z$/)){this.setString(params)}else if(typeof params["hex"]!="undefined"){this.setStringHex(params["hex"])}else if(typeof params["date"]!="undefined"){this.setByDate(params["date"])}else if(params.millis===true){this.withMillis=true}}};YAHOO.lang.extend(KJUR.asn1.DERGeneralizedTime,KJUR.asn1.DERAbstractTime);KJUR.asn1.DERSequence=function(params){KJUR.asn1.DERSequence.superclass.constructor.call(this,params);this.hT="30";this.getFreshValueHex=function(){var h="";for(var i=0;i<this.asn1Array.length;i++){var asn1Obj=this.asn1Array[i];h+=asn1Obj.getEncodedHex()}this.hV=h;return this.hV}};YAHOO.lang.extend(KJUR.asn1.DERSequence,KJUR.asn1.DERAbstractStructured);KJUR.asn1.DERSet=function(params){KJUR.asn1.DERSet.superclass.constructor.call(this,params);this.hT="31";this.sortFlag=true;this.getFreshValueHex=function(){var a=new Array;for(var i=0;i<this.asn1Array.length;i++){var asn1Obj=this.asn1Array[i];a.push(asn1Obj.getEncodedHex())}if(this.sortFlag==true)a.sort();this.hV=a.join("");return this.hV};if(typeof params!="undefined"){if(typeof params.sortflag!="undefined"&&params.sortflag==false)this.sortFlag=false}};YAHOO.lang.extend(KJUR.asn1.DERSet,KJUR.asn1.DERAbstractStructured);KJUR.asn1.DERTaggedObject=function(params){KJUR.asn1.DERTaggedObject.superclass.constructor.call(this);this.hT="a0";this.hV="";this.isExplicit=true;this.asn1Object=null;this.setASN1Object=function(isExplicitFlag,tagNoHex,asn1Object){this.hT=tagNoHex;this.isExplicit=isExplicitFlag;this.asn1Object=asn1Object;if(this.isExplicit){this.hV=this.asn1Object.getEncodedHex();this.hTLV=null;this.isModified=true}else{this.hV=null;this.hTLV=asn1Object.getEncodedHex();this.hTLV=this.hTLV.replace(/^../,tagNoHex);this.isModified=false}};this.getFreshValueHex=function(){return this.hV};if(typeof params!="undefined"){if(typeof params["tag"]!="undefined"){this.hT=params["tag"]}if(typeof params["explicit"]!="undefined"){this.isExplicit=params["explicit"]}if(typeof params["obj"]!="undefined"){this.asn1Object=params["obj"];this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)}}};YAHOO.lang.extend(KJUR.asn1.DERTaggedObject,KJUR.asn1.ASN1Object);if(typeof KJUR=="undefined"||!KJUR)KJUR={};if(typeof KJUR.asn1=="undefined"||!KJUR.asn1)KJUR.asn1={};if(typeof KJUR.asn1.cms=="undefined"||!KJUR.asn1.cms)KJUR.asn1.cms={};KJUR.asn1.cms.Attribute=function(params){KJUR.asn1.cms.Attribute.superclass.constructor.call(this);var valueList=[];this.getEncodedHex=function(){var attrTypeASN1,attrValueASN1,seq;attrTypeASN1=new KJUR.asn1.DERObjectIdentifier({oid:this.attrTypeOid});attrValueASN1=new KJUR.asn1.DERSet({array:this.valueList});try{attrValueASN1.getEncodedHex()}catch(ex){throw"fail valueSet.getEncodedHex in Attribute(1)/"+ex}seq=new KJUR.asn1.DERSequence({array:[attrTypeASN1,attrValueASN1]});try{this.hTLV=seq.getEncodedHex()}catch(ex){throw"failed seq.getEncodedHex in Attribute(2)/"+ex}return this.hTLV}};YAHOO.lang.extend(KJUR.asn1.cms.Attribute,KJUR.asn1.ASN1Object);KJUR.asn1.cms.ContentType=function(params){KJUR.asn1.cms.ContentType.superclass.constructor.call(this);this.attrTypeOid="1.2.840.113549.1.9.3";var contentTypeASN1=null;if(typeof params!="undefined"){var contentTypeASN1=new KJUR.asn1.DERObjectIdentifier(params);this.valueList=[contentTypeASN1]}};YAHOO.lang.extend(KJUR.asn1.cms.ContentType,KJUR.asn1.cms.Attribute);KJUR.asn1.cms.MessageDigest=function(params){KJUR.asn1.cms.MessageDigest.superclass.constructor.call(this);this.attrTypeOid="1.2.840.113549.1.9.4";if(typeof params!="undefined"){if(params.eciObj instanceof KJUR.asn1.cms.EncapsulatedContentInfo&&typeof params.hashAlg=="string"){var dataHex=params.eciObj.eContentValueHex;var hashAlg=params.hashAlg;var hashValueHex=KJUR.crypto.Util.hashHex(dataHex,hashAlg);var dAttrValue1=new KJUR.asn1.DEROctetString({hex:hashValueHex});dAttrValue1.getEncodedHex();this.valueList=[dAttrValue1]}else{var dAttrValue1=new KJUR.asn1.DEROctetString(params);dAttrValue1.getEncodedHex();this.valueList=[dAttrValue1]}}};YAHOO.lang.extend(KJUR.asn1.cms.MessageDigest,KJUR.asn1.cms.Attribute);KJUR.asn1.cms.SigningTime=function(params){KJUR.asn1.cms.SigningTime.superclass.constructor.call(this);this.attrTypeOid="1.2.840.113549.1.9.5";if(typeof params!="undefined"){var asn1=new KJUR.asn1.x509.Time(params);try{asn1.getEncodedHex()}catch(ex){throw"SigningTime.getEncodedHex() failed/"+ex}this.valueList=[asn1]}};YAHOO.lang.extend(KJUR.asn1.cms.SigningTime,KJUR.asn1.cms.Attribute);KJUR.asn1.cms.SigningCertificate=function(params){KJUR.asn1.cms.SigningCertificate.superclass.constructor.call(this);this.attrTypeOid="1.2.840.113549.1.9.16.2.12";var nA=KJUR.asn1;var nC=KJUR.asn1.cms;var nY=KJUR.crypto;this.setCerts=function(listPEM){var list=[];for(var i=0;i<listPEM.length;i++){var hex=KEYUTIL.getHexFromPEM(listPEM[i]);var certHashHex=nY.Util.hashHex(hex,"sha1");var dCertHash=new nA.DEROctetString({hex:certHashHex});dCertHash.getEncodedHex();var dIssuerSerial=new nC.IssuerAndSerialNumber({cert:listPEM[i]});dIssuerSerial.getEncodedHex();var dESSCertID=new nA.DERSequence({array:[dCertHash,dIssuerSerial]});dESSCertID.getEncodedHex();list.push(dESSCertID)}var dValue=new nA.DERSequence({array:list});dValue.getEncodedHex();this.valueList=[dValue]};if(typeof params!="undefined"){if(typeof params.array=="object"){this.setCerts(params.array)}}};YAHOO.lang.extend(KJUR.asn1.cms.SigningCertificate,KJUR.asn1.cms.Attribute);KJUR.asn1.cms.SigningCertificateV2=function(params){KJUR.asn1.cms.SigningCertificateV2.superclass.constructor.call(this);this.attrTypeOid="1.2.840.113549.1.9.16.2.47";var nA=KJUR.asn1;var nX=KJUR.asn1.x509;var nC=KJUR.asn1.cms;var nY=KJUR.crypto;this.setCerts=function(listPEM,hashAlg){var list=[];for(var i=0;i<listPEM.length;i++){var hex=KEYUTIL.getHexFromPEM(listPEM[i]);var a=[];if(hashAlg!="sha256")a.push(new nX.AlgorithmIdentifier({name:hashAlg}));var certHashHex=nY.Util.hashHex(hex,hashAlg);var dCertHash=new nA.DEROctetString({hex:certHashHex});dCertHash.getEncodedHex();a.push(dCertHash);var dIssuerSerial=new nC.IssuerAndSerialNumber({cert:listPEM[i]});dIssuerSerial.getEncodedHex();a.push(dIssuerSerial);var dESSCertIDv2=new nA.DERSequence({array:a});dESSCertIDv2.getEncodedHex();list.push(dESSCertIDv2)}var dValue=new nA.DERSequence({array:list});dValue.getEncodedHex();this.valueList=[dValue]};if(typeof params!="undefined"){if(typeof params.array=="object"){var hashAlg="sha256";if(typeof params.hashAlg=="string")hashAlg=params.hashAlg;this.setCerts(params.array,hashAlg)}}};YAHOO.lang.extend(KJUR.asn1.cms.SigningCertificateV2,KJUR.asn1.cms.Attribute);KJUR.asn1.cms.IssuerAndSerialNumber=function(params){KJUR.asn1.cms.IssuerAndSerialNumber.superclass.constructor.call(this);var dIssuer=null;var dSerial=null;var nA=KJUR.asn1;var nX=nA.x509;this.setByCertPEM=function(certPEM){var certHex=KEYUTIL.getHexFromPEM(certPEM);var x=new X509;x.hex=certHex;var issuerTLVHex=x.getIssuerHex();this.dIssuer=new nX.X500Name;
this.dIssuer.hTLV=issuerTLVHex;var serialVHex=x.getSerialNumberHex();this.dSerial=new nA.DERInteger({hex:serialVHex})};this.getEncodedHex=function(){var seq=new KJUR.asn1.DERSequence({array:[this.dIssuer,this.dSerial]});this.hTLV=seq.getEncodedHex();return this.hTLV};if(typeof params!="undefined"){if(typeof params=="string"&&params.indexOf("-----BEGIN ")!=-1){this.setByCertPEM(params)}if(params.issuer&&params.serial){if(params.issuer instanceof KJUR.asn1.x509.X500Name){this.dIssuer=params.issuer}else{this.dIssuer=new KJUR.asn1.x509.X500Name(params.issuer)}if(params.serial instanceof KJUR.asn1.DERInteger){this.dSerial=params.serial}else{this.dSerial=new KJUR.asn1.DERInteger(params.serial)}}if(typeof params.cert=="string"){this.setByCertPEM(params.cert)}}};YAHOO.lang.extend(KJUR.asn1.cms.IssuerAndSerialNumber,KJUR.asn1.ASN1Object);KJUR.asn1.cms.AttributeList=function(params){KJUR.asn1.cms.AttributeList.superclass.constructor.call(this);this.list=new Array;this.sortFlag=true;this.add=function(item){if(item instanceof KJUR.asn1.cms.Attribute){this.list.push(item)}};this.length=function(){return this.list.length};this.clear=function(){this.list=new Array;this.hTLV=null;this.hV=null};this.getEncodedHex=function(){if(typeof this.hTLV=="string")return this.hTLV;var set=new KJUR.asn1.DERSet({array:this.list,sortflag:this.sortFlag});this.hTLV=set.getEncodedHex();return this.hTLV};if(typeof params!="undefined"){if(typeof params.sortflag!="undefined"&&params.sortflag==false)this.sortFlag=false}};YAHOO.lang.extend(KJUR.asn1.cms.AttributeList,KJUR.asn1.ASN1Object);KJUR.asn1.cms.SignerInfo=function(params){KJUR.asn1.cms.SignerInfo.superclass.constructor.call(this);var nA=KJUR.asn1;var nC=KJUR.asn1.cms;var nX=KJUR.asn1.x509;this.dCMSVersion=new nA.DERInteger({"int":1});this.dSignerIdentifier=null;this.dDigestAlgorithm=null;this.dSignedAttrs=new nC.AttributeList;this.dSigAlg=null;this.dSig=null;this.dUnsignedAttrs=new nC.AttributeList;this.setSignerIdentifier=function(params){if(typeof params=="string"&&params.indexOf("CERTIFICATE")!=-1&&params.indexOf("BEGIN")!=-1&&params.indexOf("END")!=-1){var certPEM=params;this.dSignerIdentifier=new nC.IssuerAndSerialNumber({cert:params})}};this.setForContentAndHash=function(params){if(typeof params!="undefined"){if(params.eciObj instanceof KJUR.asn1.cms.EncapsulatedContentInfo){this.dSignedAttrs.add(new nC.ContentType({oid:"1.2.840.113549.1.7.1"}));this.dSignedAttrs.add(new nC.MessageDigest({eciObj:params.eciObj,hashAlg:params.hashAlg}))}if(typeof params.sdObj!="undefined"&&params.sdObj instanceof KJUR.asn1.cms.SignedData){if(params.sdObj.digestAlgNameList.join(":").indexOf(params.hashAlg)==-1){params.sdObj.digestAlgNameList.push(params.hashAlg)}}if(typeof params.hashAlg=="string"){this.dDigestAlgorithm=new nX.AlgorithmIdentifier({name:params.hashAlg})}}};this.sign=function(keyParam,sigAlg){this.dSigAlg=new nX.AlgorithmIdentifier({name:sigAlg});var data=this.dSignedAttrs.getEncodedHex();var prvKey=KEYUTIL.getKey(keyParam);var sig=new KJUR.crypto.Signature({alg:sigAlg});sig.init(prvKey);sig.updateHex(data);var sigValHex=sig.sign();this.dSig=new nA.DEROctetString({hex:sigValHex})};this.addUnsigned=function(attr){this.hTLV=null;this.dUnsignedAttrs.hTLV=null;this.dUnsignedAttrs.add(attr)};this.getEncodedHex=function(){if(this.dSignedAttrs instanceof KJUR.asn1.cms.AttributeList&&this.dSignedAttrs.length()==0){throw"SignedAttrs length = 0 (empty)"}var sa=new nA.DERTaggedObject({obj:this.dSignedAttrs,tag:"a0",explicit:false});var ua=null;if(this.dUnsignedAttrs.length()>0){ua=new nA.DERTaggedObject({obj:this.dUnsignedAttrs,tag:"a1",explicit:false})}var items=[this.dCMSVersion,this.dSignerIdentifier,this.dDigestAlgorithm,sa,this.dSigAlg,this.dSig];if(ua!=null)items.push(ua);var seq=new nA.DERSequence({array:items});this.hTLV=seq.getEncodedHex();return this.hTLV}};YAHOO.lang.extend(KJUR.asn1.cms.SignerInfo,KJUR.asn1.ASN1Object);KJUR.asn1.cms.EncapsulatedContentInfo=function(params){KJUR.asn1.cms.EncapsulatedContentInfo.superclass.constructor.call(this);var nA=KJUR.asn1;var nC=KJUR.asn1.cms;var nX=KJUR.asn1.x509;this.dEContentType=new nA.DERObjectIdentifier({name:"data"});this.dEContent=null;this.isDetached=false;this.eContentValueHex=null;this.setContentType=function(nameOrOid){if(nameOrOid.match(/^[0-2][.][0-9.]+$/)){this.dEContentType=new nA.DERObjectIdentifier({oid:nameOrOid})}else{this.dEContentType=new nA.DERObjectIdentifier({name:nameOrOid})}};this.setContentValue=function(params){if(typeof params!="undefined"){if(typeof params.hex=="string"){this.eContentValueHex=params.hex}else if(typeof params.str=="string"){this.eContentValueHex=utf8tohex(params.str)}}};this.setContentValueHex=function(valueHex){this.eContentValueHex=valueHex};this.setContentValueStr=function(valueStr){this.eContentValueHex=utf8tohex(valueStr)};this.getEncodedHex=function(){if(typeof this.eContentValueHex!="string"){throw"eContentValue not yet set"}var dValue=new nA.DEROctetString({hex:this.eContentValueHex});this.dEContent=new nA.DERTaggedObject({obj:dValue,tag:"a0",explicit:true});var a=[this.dEContentType];if(!this.isDetached)a.push(this.dEContent);var seq=new nA.DERSequence({array:a});this.hTLV=seq.getEncodedHex();return this.hTLV}};YAHOO.lang.extend(KJUR.asn1.cms.EncapsulatedContentInfo,KJUR.asn1.ASN1Object);KJUR.asn1.cms.ContentInfo=function(params){KJUR.asn1.cms.ContentInfo.superclass.constructor.call(this);var nA=KJUR.asn1;var nC=KJUR.asn1.cms;var nX=KJUR.asn1.x509;this.dContentType=null;this.dContent=null;this.setContentType=function(params){if(typeof params=="string"){this.dContentType=nX.OID.name2obj(params)}};this.getEncodedHex=function(){var dContent0=new nA.DERTaggedObject({obj:this.dContent,tag:"a0",explicit:true});var seq=new nA.DERSequence({array:[this.dContentType,dContent0]});this.hTLV=seq.getEncodedHex();return this.hTLV};if(typeof params!="undefined"){if(params.type)this.setContentType(params.type);if(params.obj&&params.obj instanceof nA.ASN1Object)this.dContent=params.obj}};YAHOO.lang.extend(KJUR.asn1.cms.ContentInfo,KJUR.asn1.ASN1Object);KJUR.asn1.cms.SignedData=function(params){KJUR.asn1.cms.SignedData.superclass.constructor.call(this);var nA=KJUR.asn1;var nC=KJUR.asn1.cms;var nX=KJUR.asn1.x509;this.dCMSVersion=new nA.DERInteger({"int":1});this.dDigestAlgs=null;this.digestAlgNameList=[];this.dEncapContentInfo=new nC.EncapsulatedContentInfo;this.dCerts=null;this.certificateList=[];this.crlList=[];this.signerInfoList=[new nC.SignerInfo];this.addCertificatesByPEM=function(certPEM){var hex=KEYUTIL.getHexFromPEM(certPEM);var o=new nA.ASN1Object;o.hTLV=hex;this.certificateList.push(o)};this.getEncodedHex=function(){if(typeof this.hTLV=="string")return this.hTLV;if(this.dDigestAlgs==null){var digestAlgList=[];for(var i=0;i<this.digestAlgNameList.length;i++){var name=this.digestAlgNameList[i];var o=new nX.AlgorithmIdentifier({name:name});digestAlgList.push(o)}this.dDigestAlgs=new nA.DERSet({array:digestAlgList})}var a=[this.dCMSVersion,this.dDigestAlgs,this.dEncapContentInfo];if(this.dCerts==null){if(this.certificateList.length>0){var o1=new nA.DERSet({array:this.certificateList});this.dCerts=new nA.DERTaggedObject({obj:o1,tag:"a0",explicit:false})}}if(this.dCerts!=null)a.push(this.dCerts);var dSignerInfos=new nA.DERSet({array:this.signerInfoList});a.push(dSignerInfos);var seq=new nA.DERSequence({array:a});this.hTLV=seq.getEncodedHex();return this.hTLV};this.getContentInfo=function(){this.getEncodedHex();var ci=new nC.ContentInfo({type:"signed-data",obj:this});return ci};this.getContentInfoEncodedHex=function(){var ci=this.getContentInfo();var ciHex=ci.getEncodedHex();return ciHex};this.getPEM=function(){var hex=this.getContentInfoEncodedHex();var pem=nA.ASN1Util.getPEMStringFromHex(hex,"CMS");return pem}};YAHOO.lang.extend(KJUR.asn1.cms.SignedData,KJUR.asn1.ASN1Object);KJUR.asn1.cms.CMSUtil=new function(){};KJUR.asn1.cms.CMSUtil.newSignedData=function(param){var nC=KJUR.asn1.cms;var nE=KJUR.asn1.cades;var sd=new nC.SignedData;sd.dEncapContentInfo.setContentValue(param.content);if(typeof param.certs=="object"){for(var i=0;i<param.certs.length;i++){sd.addCertificatesByPEM(param.certs[i])}}sd.signerInfoList=[];for(var i=0;i<param.signerInfos.length;i++){var siParam=param.signerInfos[i];var si=new nC.SignerInfo;si.setSignerIdentifier(siParam.signerCert);si.setForContentAndHash({sdObj:sd,eciObj:sd.dEncapContentInfo,hashAlg:siParam.hashAlg});for(attrName in siParam.sAttr){var attrParam=siParam.sAttr[attrName];if(attrName=="SigningTime"){var attr=new nC.SigningTime(attrParam);si.dSignedAttrs.add(attr)}if(attrName=="SigningCertificate"){var attr=new nC.SigningCertificate(attrParam);si.dSignedAttrs.add(attr)}if(attrName=="SigningCertificateV2"){var attr=new nC.SigningCertificateV2(attrParam);si.dSignedAttrs.add(attr)}if(attrName=="SignaturePolicyIdentifier"){var attr=new nE.SignaturePolicyIdentifier(attrParam);si.dSignedAttrs.add(attr)}}si.sign(siParam.signerPrvKey,siParam.sigAlg);sd.signerInfoList.push(si)}return sd};if(typeof KJUR=="undefined"||!KJUR)KJUR={};if(typeof KJUR.asn1=="undefined"||!KJUR.asn1)KJUR.asn1={};if(typeof KJUR.asn1.cades=="undefined"||!KJUR.asn1.cades)KJUR.asn1.cades={};KJUR.asn1.cades.SignaturePolicyIdentifier=function(params){KJUR.asn1.cades.SignaturePolicyIdentifier.superclass.constructor.call(this);this.attrTypeOid="1.2.840.113549.1.9.16.2.15";var nA=KJUR.asn1;var nC=KJUR.asn1.cades;if(typeof params!="undefined"){if(typeof params.oid=="string"&&typeof params.hash=="object"){var dOid=new nA.DERObjectIdentifier({oid:params.oid});var dHash=new nC.OtherHashAlgAndValue(params.hash);var seq=new nA.DERSequence({array:[dOid,dHash]});this.valueList=[seq]}}};YAHOO.lang.extend(KJUR.asn1.cades.SignaturePolicyIdentifier,KJUR.asn1.cms.Attribute);KJUR.asn1.cades.OtherHashAlgAndValue=function(params){KJUR.asn1.cades.OtherHashAlgAndValue.superclass.constructor.call(this);var nA=KJUR.asn1;var nX=KJUR.asn1.x509;this.dAlg=null;this.dHash=null;this.getEncodedHex=function(){var seq=new nA.DERSequence({array:[this.dAlg,this.dHash]});this.hTLV=seq.getEncodedHex();return this.hTLV};if(typeof params!="undefined"){if(typeof params.alg=="string"&&typeof params.hash=="string"){this.dAlg=new nX.AlgorithmIdentifier({name:params.alg});this.dHash=new nA.DEROctetString({hex:params.hash})}}};YAHOO.lang.extend(KJUR.asn1.cades.OtherHashAlgAndValue,KJUR.asn1.ASN1Object);KJUR.asn1.cades.SignatureTimeStamp=function(params){KJUR.asn1.cades.SignatureTimeStamp.superclass.constructor.call(this);this.attrTypeOid="1.2.840.113549.1.9.16.2.14";this.tstHex=null;var nA=KJUR.asn1;if(typeof params!="undefined"){if(typeof params.res!="undefined"){if(typeof params.res=="string"&&params.res.match(/^[0-9A-Fa-f]+$/)){}else if(params.res instanceof KJUR.asn1.ASN1Object){}else{throw"res param shall be ASN1Object or hex string"}}if(typeof params.tst!="undefined"){if(typeof params.tst=="string"&&params.tst.match(/^[0-9A-Fa-f]+$/)){var d=new nA.ASN1Object;this.tstHex=params.tst;d.hTLV=this.tstHex;d.getEncodedHex();this.valueList=[d]}else if(params.tst instanceof KJUR.asn1.ASN1Object){}else{throw"tst param shall be ASN1Object or hex string"}}}};YAHOO.lang.extend(KJUR.asn1.cades.SignatureTimeStamp,KJUR.asn1.cms.Attribute);KJUR.asn1.cades.CompleteCertificateRefs=function(params){KJUR.asn1.cades.CompleteCertificateRefs.superclass.constructor.call(this);this.attrTypeOid="1.2.840.113549.1.9.16.2.21";var nA=KJUR.asn1;var nD=KJUR.asn1.cades;this.setByArray=function(a){this.valueList=[];for(var i=0;i<a.length;i++){var o=new nD.OtherCertID(a[i]);this.valueList.push(o)}};if(typeof params!="undefined"){if(typeof params=="object"&&typeof params.length=="number"){this.setByArray(params)}}};YAHOO.lang.extend(KJUR.asn1.cades.CompleteCertificateRefs,KJUR.asn1.cms.Attribute);KJUR.asn1.cades.OtherCertID=function(params){KJUR.asn1.cades.OtherCertID.superclass.constructor.call(this);var nA=KJUR.asn1;var nC=KJUR.asn1.cms;var nD=KJUR.asn1.cades;this.hasIssuerSerial=true;this.dOtherCertHash=null;this.dIssuerSerial=null;this.setByCertPEM=function(certPEM){this.dOtherCertHash=new nD.OtherHash(certPEM);if(this.hasIssuerSerial)this.dIssuerSerial=new nC.IssuerAndSerialNumber(certPEM)};this.getEncodedHex=function(){if(this.hTLV!=null)return this.hTLV;if(this.dOtherCertHash==null)throw"otherCertHash not set";var a=[this.dOtherCertHash];if(this.dIssuerSerial!=null)a.push(this.dIssuerSerial);var seq=new nA.DERSequence({array:a});this.hTLV=seq.getEncodedHex();return this.hTLV};if(typeof params!="undefined"){if(typeof params=="string"&&params.indexOf("-----BEGIN ")!=-1){this.setByCertPEM(params)}if(typeof params=="object"){if(params.hasis===false)this.hasIssuerSerial=false;if(typeof params.cert=="string")this.setByCertPEM(params.cert)}}};YAHOO.lang.extend(KJUR.asn1.cades.OtherCertID,KJUR.asn1.ASN1Object);KJUR.asn1.cades.OtherHash=function(params){KJUR.asn1.cades.OtherHash.superclass.constructor.call(this);var nA=KJUR.asn1;var nD=KJUR.asn1.cades;this.alg="sha256";this.dOtherHash=null;this.setByCertPEM=function(certPEM){if(certPEM.indexOf("-----BEGIN ")==-1)throw"certPEM not to seem PEM format";var hex=X509.pemToHex(certPEM);var hash=KJUR.crypto.Util.hashHex(hex,this.alg);this.dOtherHash=new nD.OtherHashAlgAndValue({alg:this.alg,hash:hash})};this.getEncodedHex=function(){if(this.dOtherHash==null)throw"OtherHash not set";return this.dOtherHash.getEncodedHex()};if(typeof params!="undefined"){if(typeof params=="string"){if(params.indexOf("-----BEGIN ")!=-1){this.setByCertPEM(params)}else if(params.match(/^[0-9A-Fa-f]+$/)){this.dOtherHash=new nA.DEROctetString({hex:params})}else{throw"unsupported string value for params"}}else if(typeof params=="object"){if(typeof params.cert=="string"){if(typeof params.alg=="string")this.alg=params.alg;this.setByCertPEM(params.cert)}else{this.dOtherHash=new nD.OtherHashAlgAndValue(params)}}}};YAHOO.lang.extend(KJUR.asn1.cades.OtherHash,KJUR.asn1.ASN1Object);KJUR.asn1.cades.CAdESUtil=new function(){};KJUR.asn1.cades.CAdESUtil.addSigTS=function(dCMS,siIdx,sigTSHex){};KJUR.asn1.cades.CAdESUtil.parseSignedDataForAddingUnsigned=function(hex){var nA=KJUR.asn1;var nC=KJUR.asn1.cms;var nU=KJUR.asn1.cades.CAdESUtil;var r={};if(ASN1HEX.getDecendantHexTLVByNthList(hex,0,[0])!="06092a864886f70d010702")throw"hex is not CMS SignedData";var iSD=ASN1HEX.getDecendantIndexByNthList(hex,0,[1,0]);var aSDChildIdx=ASN1HEX.getPosArrayOfChildren_AtObj(hex,iSD);if(aSDChildIdx.length<4)throw"num of SignedData elem shall be 4 at least";var iVersion=aSDChildIdx.shift();r.version=ASN1HEX.getHexOfTLV_AtObj(hex,iVersion);var iAlgs=aSDChildIdx.shift();r.algs=ASN1HEX.getHexOfTLV_AtObj(hex,iAlgs);var iEncapContent=aSDChildIdx.shift();r.encapcontent=ASN1HEX.getHexOfTLV_AtObj(hex,iEncapContent);r.certs=null;r.revs=null;r.si=[];var iNext=aSDChildIdx.shift();if(hex.substr(iNext,2)=="a0"){r.certs=ASN1HEX.getHexOfTLV_AtObj(hex,iNext);iNext=aSDChildIdx.shift()}if(hex.substr(iNext,2)=="a1"){r.revs=ASN1HEX.getHexOfTLV_AtObj(hex,iNext);iNext=aSDChildIdx.shift()}var iSignerInfos=iNext;if(hex.substr(iSignerInfos,2)!="31")throw"Can't find signerInfos";var aSIIndex=ASN1HEX.getPosArrayOfChildren_AtObj(hex,iSignerInfos);for(var i=0;i<aSIIndex.length;i++){var iSI=aSIIndex[i];var pSI=nU.parseSignerInfoForAddingUnsigned(hex,iSI,i);r.si[i]=pSI}var tmp=null;r.obj=new nC.SignedData;tmp=new nA.ASN1Object;tmp.hTLV=r.version;r.obj.dCMSVersion=tmp;tmp=new nA.ASN1Object;tmp.hTLV=r.algs;r.obj.dDigestAlgs=tmp;tmp=new nA.ASN1Object;tmp.hTLV=r.encapcontent;r.obj.dEncapContentInfo=tmp;tmp=new nA.ASN1Object;tmp.hTLV=r.certs;r.obj.dCerts=tmp;r.obj.signerInfoList=[];for(var i=0;i<r.si.length;i++){r.obj.signerInfoList.push(r.si[i].obj)}return r};KJUR.asn1.cades.CAdESUtil.parseSignerInfoForAddingUnsigned=function(hex,iSI,nth){var nA=KJUR.asn1;var nC=KJUR.asn1.cms;var r={};var aSIChildIdx=ASN1HEX.getPosArrayOfChildren_AtObj(hex,iSI);if(aSIChildIdx.length!=6)throw"not supported items for SignerInfo (!=6)";var iVersion=aSIChildIdx.shift();r.version=ASN1HEX.getHexOfTLV_AtObj(hex,iVersion);var iIdentifier=aSIChildIdx.shift();r.si=ASN1HEX.getHexOfTLV_AtObj(hex,iIdentifier);var iDigestAlg=aSIChildIdx.shift();r.digalg=ASN1HEX.getHexOfTLV_AtObj(hex,iDigestAlg);var iSignedAttrs=aSIChildIdx.shift();r.sattrs=ASN1HEX.getHexOfTLV_AtObj(hex,iSignedAttrs);var iSigAlg=aSIChildIdx.shift();r.sigalg=ASN1HEX.getHexOfTLV_AtObj(hex,iSigAlg);var iSig=aSIChildIdx.shift();r.sig=ASN1HEX.getHexOfTLV_AtObj(hex,iSig);r.sigval=ASN1HEX.getHexOfV_AtObj(hex,iSig);var tmp=null;r.obj=new nC.SignerInfo;tmp=new nA.ASN1Object;tmp.hTLV=r.version;r.obj.dCMSVersion=tmp;tmp=new nA.ASN1Object;tmp.hTLV=r.si;r.obj.dSignerIdentifier=tmp;tmp=new nA.ASN1Object;tmp.hTLV=r.digalg;r.obj.dDigestAlgorithm=tmp;tmp=new nA.ASN1Object;tmp.hTLV=r.sattrs;r.obj.dSignedAttrs=tmp;tmp=new nA.ASN1Object;tmp.hTLV=r.sigalg;r.obj.dSigAlg=tmp;tmp=new nA.ASN1Object;tmp.hTLV=r.sig;r.obj.dSig=tmp;r.obj.dUnsignedAttrs=new nC.AttributeList;return r};var ASN1HEX=new function(){this.getByteLengthOfL_AtObj=function(s,pos){if(s.substring(pos+2,pos+3)!="8")return 1;var i=parseInt(s.substring(pos+3,pos+4));if(i==0)return-1;if(0<i&&i<10)return i+1;return-2};this.getHexOfL_AtObj=function(s,pos){var len=this.getByteLengthOfL_AtObj(s,pos);if(len<1)return"";return s.substring(pos+2,pos+2+len*2)};this.getIntOfL_AtObj=function(s,pos){var hLength=this.getHexOfL_AtObj(s,pos);if(hLength=="")return-1;var bi;if(parseInt(hLength.substring(0,1))<8){bi=new BigInteger(hLength,16)}else{bi=new BigInteger(hLength.substring(2),16)}return bi.intValue()};this.getStartPosOfV_AtObj=function(s,pos){var l_len=this.getByteLengthOfL_AtObj(s,pos);if(l_len<0)return l_len;return pos+(l_len+1)*2};this.getHexOfV_AtObj=function(s,pos){var pos1=this.getStartPosOfV_AtObj(s,pos);var len=this.getIntOfL_AtObj(s,pos);return s.substring(pos1,pos1+len*2)};this.getHexOfTLV_AtObj=function(s,pos){var hT=s.substr(pos,2);var hL=this.getHexOfL_AtObj(s,pos);var hV=this.getHexOfV_AtObj(s,pos);return hT+hL+hV};this.getPosOfNextSibling_AtObj=function(s,pos){var pos1=this.getStartPosOfV_AtObj(s,pos);var len=this.getIntOfL_AtObj(s,pos);return pos1+len*2};this.getPosArrayOfChildren_AtObj=function(h,pos){var a=new Array;var p0=this.getStartPosOfV_AtObj(h,pos);a.push(p0);var len=this.getIntOfL_AtObj(h,pos);var p=p0;var k=0;while(1){var pNext=this.getPosOfNextSibling_AtObj(h,p);if(pNext==null||pNext-p0>=len*2)break;if(k>=200)break;a.push(pNext);p=pNext;k++}return a};this.getNthChildIndex_AtObj=function(h,idx,nth){var a=this.getPosArrayOfChildren_AtObj(h,idx);return a[nth]};this.getDecendantIndexByNthList=function(h,currentIndex,nthList){if(nthList.length==0){return currentIndex}var firstNth=nthList.shift();var a=this.getPosArrayOfChildren_AtObj(h,currentIndex);return this.getDecendantIndexByNthList(h,a[firstNth],nthList)};this.getDecendantHexTLVByNthList=function(h,currentIndex,nthList){var idx=this.getDecendantIndexByNthList(h,currentIndex,nthList);return this.getHexOfTLV_AtObj(h,idx)};this.getDecendantHexVByNthList=function(h,currentIndex,nthList){var idx=this.getDecendantIndexByNthList(h,currentIndex,nthList);return this.getHexOfV_AtObj(h,idx)}};ASN1HEX.getVbyList=function(h,currentIndex,nthList,checkingTag){var idx=this.getDecendantIndexByNthList(h,currentIndex,nthList);if(idx===undefined){throw"can't find nthList object"}if(checkingTag!==undefined){if(h.substr(idx,2)!=checkingTag){throw"checking tag doesn't match: "+h.substr(idx,2)+"!="+checkingTag}}return this.getHexOfV_AtObj(h,idx)};ASN1HEX.hextooidstr=function(hex){var zeroPadding=function(s,len){if(s.length>=len)return s;return new Array(len-s.length+1).join("0")+s};var a=[];var hex0=hex.substr(0,2);var i0=parseInt(hex0,16);a[0]=new String(Math.floor(i0/40));a[1]=new String(i0%40);var hex1=hex.substr(2);var b=[];for(var i=0;i<hex1.length/2;i++){b.push(parseInt(hex1.substr(i*2,2),16))}var c=[];var cbin="";for(var i=0;i<b.length;i++){if(b[i]&128){cbin=cbin+zeroPadding((b[i]&127).toString(2),7)}else{cbin=cbin+zeroPadding((b[i]&127).toString(2),7);c.push(new String(parseInt(cbin,2)));cbin=""}}var s=a.join(".");if(c.length>0)s=s+"."+c.join(".");return s};if(typeof KJUR=="undefined"||!KJUR)KJUR={};if(typeof KJUR.asn1=="undefined"||!KJUR.asn1)KJUR.asn1={};if(typeof KJUR.asn1.tsp=="undefined"||!KJUR.asn1.tsp)KJUR.asn1.tsp={};KJUR.asn1.tsp.Accuracy=function(params){KJUR.asn1.tsp.Accuracy.superclass.constructor.call(this);var nA=KJUR.asn1;this.seconds=null;this.millis=null;this.micros=null;this.getEncodedHex=function(){var dSeconds=null;var dTagMillis=null;var dTagMicros=null;var a=[];if(this.seconds!=null){dSeconds=new nA.DERInteger({"int":this.seconds});a.push(dSeconds)}if(this.millis!=null){var dMillis=new nA.DERInteger({"int":this.millis});dTagMillis=new nA.DERTaggedObject({obj:dMillis,tag:"80",explicit:false});a.push(dTagMillis)}if(this.micros!=null){var dMicros=new nA.DERInteger({"int":this.micros});dTagMicros=new nA.DERTaggedObject({obj:dMicros,tag:"81",explicit:false});a.push(dTagMicros)}var seq=new nA.DERSequence({array:a});this.hTLV=seq.getEncodedHex();return this.hTLV};if(typeof params!="undefined"){if(typeof params.seconds=="number")this.seconds=params.seconds;if(typeof params.millis=="number")this.millis=params.millis;if(typeof params.micros=="number")this.micros=params.micros}};YAHOO.lang.extend(KJUR.asn1.tsp.Accuracy,KJUR.asn1.ASN1Object);KJUR.asn1.tsp.MessageImprint=function(params){KJUR.asn1.tsp.MessageImprint.superclass.constructor.call(this);var nA=KJUR.asn1;var nX=KJUR.asn1.x509;this.dHashAlg=null;this.dHashValue=null;this.getEncodedHex=function(){if(typeof this.hTLV=="string")return this.hTLV;var seq=new nA.DERSequence({array:[this.dHashAlg,this.dHashValue]});return seq.getEncodedHex()};if(typeof params!="undefined"){if(typeof params.hashAlg=="string"){this.dHashAlg=new nX.AlgorithmIdentifier({name:params.hashAlg})}if(typeof params.hashValue=="string"){this.dHashValue=new nA.DEROctetString({hex:params.hashValue})}}};YAHOO.lang.extend(KJUR.asn1.tsp.MessageImprint,KJUR.asn1.ASN1Object);KJUR.asn1.tsp.TimeStampReq=function(params){KJUR.asn1.tsp.TimeStampReq.superclass.constructor.call(this);var nA=KJUR.asn1;var nT=KJUR.asn1.tsp;this.dVersion=new nA.DERInteger({"int":1});this.dMessageImprint=null;this.dPolicy=null;this.dNonce=null;this.certReq=true;this.setMessageImprint=function(params){if(params instanceof KJUR.asn1.tsp.MessageImprint){this.dMessageImprint=params;return}if(typeof params=="object"){this.dMessageImprint=new nT.MessageImprint(params)}};this.getEncodedHex=function(){if(this.dMessageImprint==null)throw"messageImprint shall be specified";var a=[this.dVersion,this.dMessageImprint];if(this.dPolicy!=null)a.push(this.dPolicy);if(this.dNonce!=null)a.push(this.dNonce);if(this.certReq)a.push(new nA.DERBoolean);var seq=new nA.DERSequence({array:a});this.hTLV=seq.getEncodedHex();return this.hTLV};if(typeof params!="undefined"){if(typeof params.mi=="object"){this.setMessageImprint(params.mi)}if(typeof params.policy=="object"){this.dPolicy=new nA.DERObjectIdentifier(params.policy)}if(typeof params.nonce=="object"){this.dNonce=new nA.DERInteger(params.nonce)}if(typeof params.certreq=="boolean"){this.certReq=params.certreq}}};YAHOO.lang.extend(KJUR.asn1.tsp.TimeStampReq,KJUR.asn1.ASN1Object);KJUR.asn1.tsp.TSTInfo=function(params){KJUR.asn1.tsp.TSTInfo.superclass.constructor.call(this);var nA=KJUR.asn1;var nX=KJUR.asn1.x509;var nT=KJUR.asn1.tsp;this.dVersion=new nA.DERInteger({"int":1});this.dPolicy=null;this.dMessageImprint=null;this.dSerialNumber=null;this.dGenTime=null;this.dAccuracy=null;this.dOrdering=null;this.dNonce=null;this.dTsa=null;this.getEncodedHex=function(){var a=[this.dVersion];if(this.dPolicy==null)throw"policy shall be specified.";a.push(this.dPolicy);if(this.dMessageImprint==null)throw"messageImprint shall be specified.";a.push(this.dMessageImprint);if(this.dSerialNumber==null)throw"serialNumber shall be specified.";a.push(this.dSerialNumber);if(this.dGenTime==null)throw"genTime shall be specified.";a.push(this.dGenTime);if(this.dAccuracy!=null)a.push(this.dAccuracy);if(this.dOrdering!=null)a.push(this.dOrdering);if(this.dNonce!=null)a.push(this.dNonce);if(this.dTsa!=null)a.push(this.dTsa);var seq=new nA.DERSequence({array:a});this.hTLV=seq.getEncodedHex();return this.hTLV};if(typeof params!="undefined"){if(typeof params.policy=="string"){if(!params.policy.match(/^[0-9.]+$/))throw"policy shall be oid like 0.1.4.134";this.dPolicy=new nA.DERObjectIdentifier({oid:params.policy})}if(typeof params.messageImprint!="undefined"){this.dMessageImprint=new nT.MessageImprint(params.messageImprint)}if(typeof params.serialNumber!="undefined"){this.dSerialNumber=new nA.DERInteger(params.serialNumber)}if(typeof params.genTime!="undefined"){this.dGenTime=new nA.DERGeneralizedTime(params.genTime)}if(typeof params.accuracy!="undefind"){this.dAccuracy=new nT.Accuracy(params.accuracy)}if(typeof params.ordering!="undefined"&&params.ordering==true){this.dOrdering=new nA.DERBoolean}if(typeof params.nonce!="undefined"){this.dNonce=new nA.DERInteger(params.nonce)}if(typeof params.tsa!="undefined"){this.dTsa=new nX.X500Name(params.tsa)}}};YAHOO.lang.extend(KJUR.asn1.tsp.TSTInfo,KJUR.asn1.ASN1Object);KJUR.asn1.tsp.TimeStampResp=function(params){KJUR.asn1.tsp.TimeStampResp.superclass.constructor.call(this);var nA=KJUR.asn1;var nT=KJUR.asn1.tsp;this.dStatus=null;this.dTST=null;this.getEncodedHex=function(){if(this.dStatus==null)throw"status shall be specified";var a=[this.dStatus];if(this.dTST!=null)a.push(this.dTST);var seq=new nA.DERSequence({array:a});this.hTLV=seq.getEncodedHex();return this.hTLV};if(typeof params!="undefined"){if(typeof params.status=="object"){this.dStatus=new nT.PKIStatusInfo(params.status)}if(typeof params.tst!="undefined"&&params.tst instanceof KJUR.asn1.ASN1Object){this.dTST=params.tst.getContentInfo()}}};YAHOO.lang.extend(KJUR.asn1.tsp.TimeStampResp,KJUR.asn1.ASN1Object);KJUR.asn1.tsp.PKIStatusInfo=function(params){KJUR.asn1.tsp.PKIStatusInfo.superclass.constructor.call(this);var nA=KJUR.asn1;var nT=KJUR.asn1.tsp;this.dStatus=null;this.dStatusString=null;this.dFailureInfo=null;this.getEncodedHex=function(){if(this.dStatus==null)throw"status shall be specified";var a=[this.dStatus];if(this.dStatusString!=null)a.push(this.dStatusString);if(this.dFailureInfo!=null)a.push(this.dFailureInfo);var seq=new nA.DERSequence({array:a});this.hTLV=seq.getEncodedHex();return this.hTLV};if(typeof params!="undefined"){if(typeof params.status=="object"){this.dStatus=new nT.PKIStatus(params.status)}if(typeof params.statstr=="object"){this.dStatusString=new nT.PKIFreeText({array:params.statstr})}if(typeof params.failinfo=="object"){this.dFailureInfo=new nT.PKIFailureInfo(params.failinfo)}}};YAHOO.lang.extend(KJUR.asn1.tsp.PKIStatusInfo,KJUR.asn1.ASN1Object);KJUR.asn1.tsp.PKIStatus=function(params){KJUR.asn1.tsp.PKIStatus.superclass.constructor.call(this);var nA=KJUR.asn1;var nT=KJUR.asn1.tsp;var dStatus=null;this.getEncodedHex=function(){this.hTLV=this.dStatus.getEncodedHex();return this.hTLV};if(typeof params!="undefined"){if(typeof params.name!="undefined"){var list=nT.PKIStatus.valueList;if(typeof list[params.name]=="undefined")throw"name undefined: "+params.name;this.dStatus=new nA.DERInteger({"int":list[params.name]})}else{this.dStatus=new nA.DERInteger(params)}}};YAHOO.lang.extend(KJUR.asn1.tsp.PKIStatus,KJUR.asn1.ASN1Object);KJUR.asn1.tsp.PKIStatus.valueList={granted:0,grantedWithMods:1,rejection:2,waiting:3,revocationWarning:4,revocationNotification:5};KJUR.asn1.tsp.PKIFreeText=function(params){KJUR.asn1.tsp.PKIFreeText.superclass.constructor.call(this);var nA=KJUR.asn1;this.textList=[];this.getEncodedHex=function(){var a=[];for(var i=0;i<this.textList.length;i++){a.push(new nA.DERUTF8String({str:this.textList[i]}))}var seq=new nA.DERSequence({array:a});this.hTLV=seq.getEncodedHex();return this.hTLV};if(typeof params!="undefined"){if(typeof params.array=="object"){this.textList=params.array}}};YAHOO.lang.extend(KJUR.asn1.tsp.PKIFreeText,KJUR.asn1.ASN1Object);KJUR.asn1.tsp.PKIFailureInfo=function(params){KJUR.asn1.tsp.PKIFailureInfo.superclass.constructor.call(this);var nA=KJUR.asn1;var nT=KJUR.asn1.tsp;this.value=null;this.getEncodedHex=function(){if(this.value==null)throw"value shall be specified";var binValue=new Number(this.value).toString(2);var dValue=new nA.DERBitString;dValue.setByBinaryString(binValue);this.hTLV=dValue.getEncodedHex();return this.hTLV};if(typeof params!="undefined"){if(typeof params.name=="string"){var list=nT.PKIFailureInfo.valueList;if(typeof list[params.name]=="undefined")throw"name undefined: "+params.name;this.value=list[params.name]}else if(typeof params["int"]=="number"){this.value=params["int"]}}};YAHOO.lang.extend(KJUR.asn1.tsp.PKIFailureInfo,KJUR.asn1.ASN1Object);KJUR.asn1.tsp.PKIFailureInfo.valueList={badAlg:0,badRequest:2,badDataFormat:5,timeNotAvailable:14,unacceptedPolicy:15,unacceptedExtension:16,addInfoNotAvailable:17,systemFailure:25};KJUR.asn1.tsp.AbstractTSAAdapter=function(params){this.getTSTHex=function(msgHex,hashAlg){throw"not implemented yet"}};KJUR.asn1.tsp.SimpleTSAAdapter=function(initParams){KJUR.asn1.tsp.SimpleTSAAdapter.superclass.constructor.call(this);this.params=null;this.serial=0;this.getTSTHex=function(msgHex,hashAlg){var hashHex=KJUR.crypto.Util.hashHex(msgHex,hashAlg);this.params.tstInfo.messageImprint={hashAlg:hashAlg,hashValue:hashHex};this.params.tstInfo.serialNumber={"int":this.serial++};var nonceValue=Math.floor(Math.random()*1e9);this.params.tstInfo.nonce={"int":nonceValue};var obj=KJUR.asn1.tsp.TSPUtil.newTimeStampToken(this.params);return obj.getContentInfoEncodedHex()};if(typeof initParams!="undefined"){this.params=initParams}};YAHOO.lang.extend(KJUR.asn1.tsp.SimpleTSAAdapter,KJUR.asn1.tsp.AbstractTSAAdapter);KJUR.asn1.tsp.FixedTSAAdapter=function(initParams){KJUR.asn1.tsp.FixedTSAAdapter.superclass.constructor.call(this);this.params=null;this.getTSTHex=function(msgHex,hashAlg){var hashHex=KJUR.crypto.Util.hashHex(msgHex,hashAlg);this.params.tstInfo.messageImprint={hashAlg:hashAlg,hashValue:hashHex};var obj=KJUR.asn1.tsp.TSPUtil.newTimeStampToken(this.params);return obj.getContentInfoEncodedHex()};if(typeof initParams!="undefined"){this.params=initParams}};YAHOO.lang.extend(KJUR.asn1.tsp.FixedTSAAdapter,KJUR.asn1.tsp.AbstractTSAAdapter);KJUR.asn1.tsp.TSPUtil=new function(){};KJUR.asn1.tsp.TSPUtil.newTimeStampToken=function(param){var nC=KJUR.asn1.cms;var nT=KJUR.asn1.tsp;var sd=new nC.SignedData;var dTSTInfo=new nT.TSTInfo(param.tstInfo);var tstInfoHex=dTSTInfo.getEncodedHex();sd.dEncapContentInfo.setContentValue({hex:tstInfoHex});sd.dEncapContentInfo.setContentType("tstinfo");if(typeof param.certs=="object"){for(var i=0;i<param.certs.length;i++){sd.addCertificatesByPEM(param.certs[i])}}var si=sd.signerInfoList[0];si.setSignerIdentifier(param.signerCert);si.setForContentAndHash({sdObj:sd,eciObj:sd.dEncapContentInfo,hashAlg:param.hashAlg});var signingCertificate=new nC.SigningCertificate({array:[param.signerCert]});si.dSignedAttrs.add(signingCertificate);si.sign(param.signerPrvKey,param.sigAlg);return sd};KJUR.asn1.tsp.TSPUtil.parseTimeStampReq=function(reqHex){var json={};json.certreq=false;var idxList=ASN1HEX.getPosArrayOfChildren_AtObj(reqHex,0);if(idxList.length<2)throw"TimeStampReq must have at least 2 items";var miHex=ASN1HEX.getHexOfTLV_AtObj(reqHex,idxList[1]);json.mi=KJUR.asn1.tsp.TSPUtil.parseMessageImprint(miHex);for(var i=2;i<idxList.length;i++){var idx=idxList[i];var tag=reqHex.substr(idx,2);if(tag=="06"){var policyHex=ASN1HEX.getHexOfV_AtObj(reqHex,idx);json.policy=ASN1HEX.hextooidstr(policyHex)}if(tag=="02"){json.nonce=ASN1HEX.getHexOfV_AtObj(reqHex,idx)}if(tag=="01"){json.certreq=true}}return json};KJUR.asn1.tsp.TSPUtil.parseMessageImprint=function(miHex){var json={};if(miHex.substr(0,2)!="30")throw"head of messageImprint hex shall be '30'";var idxList=ASN1HEX.getPosArrayOfChildren_AtObj(miHex,0);var hashAlgOidIdx=ASN1HEX.getDecendantIndexByNthList(miHex,0,[0,0]);var hashAlgHex=ASN1HEX.getHexOfV_AtObj(miHex,hashAlgOidIdx);var hashAlgOid=ASN1HEX.hextooidstr(hashAlgHex);var hashAlgName=KJUR.asn1.x509.OID.oid2name(hashAlgOid);
if(hashAlgName=="")throw"hashAlg name undefined: "+hashAlgOid;var hashAlg=hashAlgName;var hashValueIdx=ASN1HEX.getDecendantIndexByNthList(miHex,0,[1]);json.hashAlg=hashAlg;json.hashValue=ASN1HEX.getHexOfV_AtObj(miHex,hashValueIdx);return json};if(typeof KJUR=="undefined"||!KJUR)KJUR={};if(typeof KJUR.asn1=="undefined"||!KJUR.asn1)KJUR.asn1={};if(typeof KJUR.asn1.x509=="undefined"||!KJUR.asn1.x509)KJUR.asn1.x509={};KJUR.asn1.x509.Certificate=function(params){KJUR.asn1.x509.Certificate.superclass.constructor.call(this);var asn1TBSCert=null;var asn1SignatureAlg=null;var asn1Sig=null;var hexSig=null;var prvKey=null;var rsaPrvKey=null;this.setRsaPrvKeyByPEMandPass=function(rsaPEM,passPEM){var caKeyHex=PKCS5PKEY.getDecryptedKeyHex(rsaPEM,passPEM);var caKey=new RSAKey;caKey.readPrivateKeyFromASN1HexString(caKeyHex);this.prvKey=caKey};this.sign=function(){this.asn1SignatureAlg=this.asn1TBSCert.asn1SignatureAlg;sig=new KJUR.crypto.Signature({alg:"SHA1withRSA"});sig.init(this.prvKey);sig.updateHex(this.asn1TBSCert.getEncodedHex());this.hexSig=sig.sign();this.asn1Sig=new KJUR.asn1.DERBitString({hex:"00"+this.hexSig});var seq=new KJUR.asn1.DERSequence({array:[this.asn1TBSCert,this.asn1SignatureAlg,this.asn1Sig]});this.hTLV=seq.getEncodedHex();this.isModified=false};this.setSignatureHex=function(sigHex){this.asn1SignatureAlg=this.asn1TBSCert.asn1SignatureAlg;this.hexSig=sigHex;this.asn1Sig=new KJUR.asn1.DERBitString({hex:"00"+this.hexSig});var seq=new KJUR.asn1.DERSequence({array:[this.asn1TBSCert,this.asn1SignatureAlg,this.asn1Sig]});this.hTLV=seq.getEncodedHex();this.isModified=false};this.getEncodedHex=function(){if(this.isModified==false&&this.hTLV!=null)return this.hTLV;throw"not signed yet"};this.getPEMString=function(){var hCert=this.getEncodedHex();var wCert=CryptoJS.enc.Hex.parse(hCert);var b64Cert=CryptoJS.enc.Base64.stringify(wCert);var pemBody=b64Cert.replace(/(.{64})/g,"$1\r\n");return"-----BEGIN CERTIFICATE-----\r\n"+pemBody+"\r\n-----END CERTIFICATE-----\r\n"};if(typeof params!="undefined"){if(typeof params["tbscertobj"]!="undefined"){this.asn1TBSCert=params["tbscertobj"]}if(typeof params["prvkeyobj"]!="undefined"){this.prvKey=params["prvkeyobj"]}else if(typeof params["rsaprvkey"]!="undefined"){this.prvKey=params["rsaprvkey"]}else if(typeof params["rsaprvpem"]!="undefined"&&typeof params["rsaprvpas"]!="undefined"){this.setRsaPrvKeyByPEMandPass(params["rsaprvpem"],params["rsaprvpas"])}}};YAHOO.lang.extend(KJUR.asn1.x509.Certificate,KJUR.asn1.ASN1Object);KJUR.asn1.x509.TBSCertificate=function(params){KJUR.asn1.x509.TBSCertificate.superclass.constructor.call(this);this._initialize=function(){this.asn1Array=new Array;this.asn1Version=new KJUR.asn1.DERTaggedObject({obj:new KJUR.asn1.DERInteger({"int":2})});this.asn1SerialNumber=null;this.asn1SignatureAlg=null;this.asn1Issuer=null;this.asn1NotBefore=null;this.asn1NotAfter=null;this.asn1Subject=null;this.asn1SubjPKey=null;this.extensionsArray=new Array};this.setSerialNumberByParam=function(intParam){this.asn1SerialNumber=new KJUR.asn1.DERInteger(intParam)};this.setSignatureAlgByParam=function(algIdParam){this.asn1SignatureAlg=new KJUR.asn1.x509.AlgorithmIdentifier(algIdParam)};this.setIssuerByParam=function(x500NameParam){this.asn1Issuer=new KJUR.asn1.x509.X500Name(x500NameParam)};this.setNotBeforeByParam=function(timeParam){this.asn1NotBefore=new KJUR.asn1.x509.Time(timeParam)};this.setNotAfterByParam=function(timeParam){this.asn1NotAfter=new KJUR.asn1.x509.Time(timeParam)};this.setSubjectByParam=function(x500NameParam){this.asn1Subject=new KJUR.asn1.x509.X500Name(x500NameParam)};this.setSubjectPublicKeyByParam=function(subjPKeyParam){this.asn1SubjPKey=new KJUR.asn1.x509.SubjectPublicKeyInfo(subjPKeyParam)};this.setSubjectPublicKeyByGetKey=function(keyParam){var keyObj=KEYUTIL.getKey(keyParam);this.asn1SubjPKey=new KJUR.asn1.x509.SubjectPublicKeyInfo(keyObj)};this.appendExtension=function(extObj){this.extensionsArray.push(extObj)};this.appendExtensionByName=function(name,extParams){if(name.toLowerCase()=="basicconstraints"){var extObj=new KJUR.asn1.x509.BasicConstraints(extParams);this.appendExtension(extObj)}else if(name.toLowerCase()=="keyusage"){var extObj=new KJUR.asn1.x509.KeyUsage(extParams);this.appendExtension(extObj)}else if(name.toLowerCase()=="crldistributionpoints"){var extObj=new KJUR.asn1.x509.CRLDistributionPoints(extParams);this.appendExtension(extObj)}else if(name.toLowerCase()=="extkeyusage"){var extObj=new KJUR.asn1.x509.ExtKeyUsage(extParams);this.appendExtension(extObj)}else if(name.toLowerCase()=="authoritykeyidentifier"){var extObj=new KJUR.asn1.x509.AuthorityKeyIdentifier(extParams);this.appendExtension(extObj)}else{throw"unsupported extension name: "+name}};this.getEncodedHex=function(){if(this.asn1NotBefore==null||this.asn1NotAfter==null)throw"notBefore and/or notAfter not set";var asn1Validity=new KJUR.asn1.DERSequence({array:[this.asn1NotBefore,this.asn1NotAfter]});this.asn1Array=new Array;this.asn1Array.push(this.asn1Version);this.asn1Array.push(this.asn1SerialNumber);this.asn1Array.push(this.asn1SignatureAlg);this.asn1Array.push(this.asn1Issuer);this.asn1Array.push(asn1Validity);this.asn1Array.push(this.asn1Subject);this.asn1Array.push(this.asn1SubjPKey);if(this.extensionsArray.length>0){var extSeq=new KJUR.asn1.DERSequence({array:this.extensionsArray});var extTagObj=new KJUR.asn1.DERTaggedObject({explicit:true,tag:"a3",obj:extSeq});this.asn1Array.push(extTagObj)}var o=new KJUR.asn1.DERSequence({array:this.asn1Array});this.hTLV=o.getEncodedHex();this.isModified=false;return this.hTLV};this._initialize()};YAHOO.lang.extend(KJUR.asn1.x509.TBSCertificate,KJUR.asn1.ASN1Object);KJUR.asn1.x509.Extension=function(params){KJUR.asn1.x509.Extension.superclass.constructor.call(this);var asn1ExtnValue=null;this.getEncodedHex=function(){var asn1Oid=new KJUR.asn1.DERObjectIdentifier({oid:this.oid});var asn1EncapExtnValue=new KJUR.asn1.DEROctetString({hex:this.getExtnValueHex()});var asn1Array=new Array;asn1Array.push(asn1Oid);if(this.critical)asn1Array.push(new KJUR.asn1.DERBoolean);asn1Array.push(asn1EncapExtnValue);var asn1Seq=new KJUR.asn1.DERSequence({array:asn1Array});return asn1Seq.getEncodedHex()};this.critical=false;if(typeof params!="undefined"){if(typeof params["critical"]!="undefined"){this.critical=params["critical"]}}};YAHOO.lang.extend(KJUR.asn1.x509.Extension,KJUR.asn1.ASN1Object);KJUR.asn1.x509.KeyUsage=function(params){KJUR.asn1.x509.KeyUsage.superclass.constructor.call(this,params);this.getExtnValueHex=function(){return this.asn1ExtnValue.getEncodedHex()};this.oid="2.5.29.15";if(typeof params!="undefined"){if(typeof params["bin"]!="undefined"){this.asn1ExtnValue=new KJUR.asn1.DERBitString(params)}}};YAHOO.lang.extend(KJUR.asn1.x509.KeyUsage,KJUR.asn1.x509.Extension);KJUR.asn1.x509.BasicConstraints=function(params){KJUR.asn1.x509.BasicConstraints.superclass.constructor.call(this,params);var cA=false;var pathLen=-1;this.getExtnValueHex=function(){var asn1Array=new Array;if(this.cA)asn1Array.push(new KJUR.asn1.DERBoolean);if(this.pathLen>-1)asn1Array.push(new KJUR.asn1.DERInteger({"int":this.pathLen}));var asn1Seq=new KJUR.asn1.DERSequence({array:asn1Array});this.asn1ExtnValue=asn1Seq;return this.asn1ExtnValue.getEncodedHex()};this.oid="2.5.29.19";this.cA=false;this.pathLen=-1;if(typeof params!="undefined"){if(typeof params["cA"]!="undefined"){this.cA=params["cA"]}if(typeof params["pathLen"]!="undefined"){this.pathLen=params["pathLen"]}}};YAHOO.lang.extend(KJUR.asn1.x509.BasicConstraints,KJUR.asn1.x509.Extension);KJUR.asn1.x509.CRLDistributionPoints=function(params){KJUR.asn1.x509.CRLDistributionPoints.superclass.constructor.call(this,params);this.getExtnValueHex=function(){return this.asn1ExtnValue.getEncodedHex()};this.setByDPArray=function(dpArray){this.asn1ExtnValue=new KJUR.asn1.DERSequence({array:dpArray})};this.setByOneURI=function(uri){var gn1=new KJUR.asn1.x509.GeneralNames([{uri:uri}]);var dpn1=new KJUR.asn1.x509.DistributionPointName(gn1);var dp1=new KJUR.asn1.x509.DistributionPoint({dpobj:dpn1});this.setByDPArray([dp1])};this.oid="2.5.29.31";if(typeof params!="undefined"){if(typeof params["array"]!="undefined"){this.setByDPArray(params["array"])}else if(typeof params["uri"]!="undefined"){this.setByOneURI(params["uri"])}}};YAHOO.lang.extend(KJUR.asn1.x509.CRLDistributionPoints,KJUR.asn1.x509.Extension);KJUR.asn1.x509.ExtKeyUsage=function(params){KJUR.asn1.x509.ExtKeyUsage.superclass.constructor.call(this,params);this.setPurposeArray=function(purposeArray){this.asn1ExtnValue=new KJUR.asn1.DERSequence;for(var i=0;i<purposeArray.length;i++){var o=new KJUR.asn1.DERObjectIdentifier(purposeArray[i]);this.asn1ExtnValue.appendASN1Object(o)}};this.getExtnValueHex=function(){return this.asn1ExtnValue.getEncodedHex()};this.oid="2.5.29.37";if(typeof params!="undefined"){if(typeof params["array"]!="undefined"){this.setPurposeArray(params["array"])}}};YAHOO.lang.extend(KJUR.asn1.x509.ExtKeyUsage,KJUR.asn1.x509.Extension);KJUR.asn1.x509.AuthorityKeyIdentifier=function(params){KJUR.asn1.x509.AuthorityKeyIdentifier.superclass.constructor.call(this,params);this.asn1KID=null;this.asn1CertIssuer=null;this.asn1CertSN=null;this.getExtnValueHex=function(){var a=new Array;if(this.asn1KID)a.push(new KJUR.asn1.DERTaggedObject({explicit:false,tag:"80",obj:this.asn1KID}));if(this.asn1CertIssuer)a.push(new KJUR.asn1.DERTaggedObject({explicit:false,tag:"a1",obj:this.asn1CertIssuer}));if(this.asn1CertSN)a.push(new KJUR.asn1.DERTaggedObject({explicit:false,tag:"82",obj:this.asn1CertSN}));var asn1Seq=new KJUR.asn1.DERSequence({array:a});this.asn1ExtnValue=asn1Seq;return this.asn1ExtnValue.getEncodedHex()};this.setKIDByParam=function(param){this.asn1KID=new KJUR.asn1.DEROctetString(param)};this.setCertIssuerByParam=function(param){this.asn1CertIssuer=new KJUR.asn1.x509.X500Name(param)};this.setCertSNByParam=function(param){this.asn1CertSN=new KJUR.asn1.DERInteger(param)};this.oid="2.5.29.35";if(typeof params!="undefined"){if(typeof params["kid"]!="undefined"){this.setKIDByParam(params["kid"])}if(typeof params["issuer"]!="undefined"){this.setCertIssuerByParam(params["issuer"])}if(typeof params["sn"]!="undefined"){this.setCertSNByParam(params["sn"])}}};YAHOO.lang.extend(KJUR.asn1.x509.AuthorityKeyIdentifier,KJUR.asn1.x509.Extension);KJUR.asn1.x509.CRL=function(params){KJUR.asn1.x509.CRL.superclass.constructor.call(this);var asn1TBSCertList=null;var asn1SignatureAlg=null;var asn1Sig=null;var hexSig=null;var rsaPrvKey=null;this.setRsaPrvKeyByPEMandPass=function(rsaPEM,passPEM){var caKeyHex=PKCS5PKEY.getDecryptedKeyHex(rsaPEM,passPEM);var caKey=new RSAKey;caKey.readPrivateKeyFromASN1HexString(caKeyHex);this.rsaPrvKey=caKey};this.sign=function(){this.asn1SignatureAlg=this.asn1TBSCertList.asn1SignatureAlg;sig=new KJUR.crypto.Signature({alg:"SHA1withRSA",prov:"cryptojs/jsrsa"});sig.initSign(this.rsaPrvKey);sig.updateHex(this.asn1TBSCertList.getEncodedHex());this.hexSig=sig.sign();this.asn1Sig=new KJUR.asn1.DERBitString({hex:"00"+this.hexSig});var seq=new KJUR.asn1.DERSequence({array:[this.asn1TBSCertList,this.asn1SignatureAlg,this.asn1Sig]});this.hTLV=seq.getEncodedHex();this.isModified=false};this.getEncodedHex=function(){if(this.isModified==false&&this.hTLV!=null)return this.hTLV;throw"not signed yet"};this.getPEMString=function(){var hCert=this.getEncodedHex();var wCert=CryptoJS.enc.Hex.parse(hCert);var b64Cert=CryptoJS.enc.Base64.stringify(wCert);var pemBody=b64Cert.replace(/(.{64})/g,"$1\r\n");return"-----BEGIN X509 CRL-----\r\n"+pemBody+"\r\n-----END X509 CRL-----\r\n"};if(typeof params!="undefined"){if(typeof params["tbsobj"]!="undefined"){this.asn1TBSCertList=params["tbsobj"]}if(typeof params["rsaprvkey"]!="undefined"){this.rsaPrvKey=params["rsaprvkey"]}if(typeof params["rsaprvpem"]!="undefined"&&typeof params["rsaprvpas"]!="undefined"){this.setRsaPrvKeyByPEMandPass(params["rsaprvpem"],params["rsaprvpas"])}}};YAHOO.lang.extend(KJUR.asn1.x509.CRL,KJUR.asn1.ASN1Object);KJUR.asn1.x509.TBSCertList=function(params){KJUR.asn1.x509.TBSCertList.superclass.constructor.call(this);var aRevokedCert=null;this.setSignatureAlgByParam=function(algIdParam){this.asn1SignatureAlg=new KJUR.asn1.x509.AlgorithmIdentifier(algIdParam)};this.setIssuerByParam=function(x500NameParam){this.asn1Issuer=new KJUR.asn1.x509.X500Name(x500NameParam)};this.setThisUpdateByParam=function(timeParam){this.asn1ThisUpdate=new KJUR.asn1.x509.Time(timeParam)};this.setNextUpdateByParam=function(timeParam){this.asn1NextUpdate=new KJUR.asn1.x509.Time(timeParam)};this.addRevokedCert=function(snParam,timeParam){var param={};if(snParam!=undefined&&snParam!=null)param["sn"]=snParam;if(timeParam!=undefined&&timeParam!=null)param["time"]=timeParam;var o=new KJUR.asn1.x509.CRLEntry(param);this.aRevokedCert.push(o)};this.getEncodedHex=function(){this.asn1Array=new Array;if(this.asn1Version!=null)this.asn1Array.push(this.asn1Version);this.asn1Array.push(this.asn1SignatureAlg);this.asn1Array.push(this.asn1Issuer);this.asn1Array.push(this.asn1ThisUpdate);if(this.asn1NextUpdate!=null)this.asn1Array.push(this.asn1NextUpdate);if(this.aRevokedCert.length>0){var seq=new KJUR.asn1.DERSequence({array:this.aRevokedCert});this.asn1Array.push(seq)}var o=new KJUR.asn1.DERSequence({array:this.asn1Array});this.hTLV=o.getEncodedHex();this.isModified=false;return this.hTLV};this._initialize=function(){this.asn1Version=null;this.asn1SignatureAlg=null;this.asn1Issuer=null;this.asn1ThisUpdate=null;this.asn1NextUpdate=null;this.aRevokedCert=new Array};this._initialize()};YAHOO.lang.extend(KJUR.asn1.x509.TBSCertList,KJUR.asn1.ASN1Object);KJUR.asn1.x509.CRLEntry=function(params){KJUR.asn1.x509.CRLEntry.superclass.constructor.call(this);var sn=null;var time=null;this.setCertSerial=function(intParam){this.sn=new KJUR.asn1.DERInteger(intParam)};this.setRevocationDate=function(timeParam){this.time=new KJUR.asn1.x509.Time(timeParam)};this.getEncodedHex=function(){var o=new KJUR.asn1.DERSequence({array:[this.sn,this.time]});this.TLV=o.getEncodedHex();return this.TLV};if(typeof params!="undefined"){if(typeof params["time"]!="undefined"){this.setRevocationDate(params["time"])}if(typeof params["sn"]!="undefined"){this.setCertSerial(params["sn"])}}};YAHOO.lang.extend(KJUR.asn1.x509.CRLEntry,KJUR.asn1.ASN1Object);KJUR.asn1.x509.X500Name=function(params){KJUR.asn1.x509.X500Name.superclass.constructor.call(this);this.asn1Array=new Array;this.setByString=function(dnStr){var a=dnStr.split("/");a.shift();for(var i=0;i<a.length;i++){this.asn1Array.push(new KJUR.asn1.x509.RDN({str:a[i]}))}};this.getEncodedHex=function(){if(typeof this.hTLV=="string")return this.hTLV;var o=new KJUR.asn1.DERSequence({array:this.asn1Array});this.hTLV=o.getEncodedHex();return this.hTLV};if(typeof params!="undefined"){if(typeof params["str"]!="undefined"){this.setByString(params["str"])}if(typeof params.certissuer!="undefined"){var x=new X509;x.hex=X509.pemToHex(params.certissuer);this.hTLV=x.getIssuerHex()}if(typeof params.certsubject!="undefined"){var x=new X509;x.hex=X509.pemToHex(params.certsubject);this.hTLV=x.getSubjectHex()}}};YAHOO.lang.extend(KJUR.asn1.x509.X500Name,KJUR.asn1.ASN1Object);KJUR.asn1.x509.RDN=function(params){KJUR.asn1.x509.RDN.superclass.constructor.call(this);this.asn1Array=new Array;this.addByString=function(rdnStr){this.asn1Array.push(new KJUR.asn1.x509.AttributeTypeAndValue({str:rdnStr}))};this.getEncodedHex=function(){var o=new KJUR.asn1.DERSet({array:this.asn1Array});this.TLV=o.getEncodedHex();return this.TLV};if(typeof params!="undefined"){if(typeof params["str"]!="undefined"){this.addByString(params["str"])}}};YAHOO.lang.extend(KJUR.asn1.x509.RDN,KJUR.asn1.ASN1Object);KJUR.asn1.x509.AttributeTypeAndValue=function(params){KJUR.asn1.x509.AttributeTypeAndValue.superclass.constructor.call(this);var typeObj=null;var valueObj=null;var defaultDSType="utf8";this.setByString=function(attrTypeAndValueStr){if(attrTypeAndValueStr.match(/^([^=]+)=(.+)$/)){this.setByAttrTypeAndValueStr(RegExp.$1,RegExp.$2)}else{throw"malformed attrTypeAndValueStr: "+attrTypeAndValueStr}};this.setByAttrTypeAndValueStr=function(shortAttrType,valueStr){this.typeObj=KJUR.asn1.x509.OID.atype2obj(shortAttrType);var dsType=defaultDSType;if(shortAttrType=="C")dsType="prn";this.valueObj=this.getValueObj(dsType,valueStr)};this.getValueObj=function(dsType,valueStr){if(dsType=="utf8")return new KJUR.asn1.DERUTF8String({str:valueStr});if(dsType=="prn")return new KJUR.asn1.DERPrintableString({str:valueStr});if(dsType=="tel")return new KJUR.asn1.DERTeletexString({str:valueStr});if(dsType=="ia5")return new KJUR.asn1.DERIA5String({str:valueStr});throw"unsupported directory string type: type="+dsType+" value="+valueStr};this.getEncodedHex=function(){var o=new KJUR.asn1.DERSequence({array:[this.typeObj,this.valueObj]});this.TLV=o.getEncodedHex();return this.TLV};if(typeof params!="undefined"){if(typeof params["str"]!="undefined"){this.setByString(params["str"])}}};YAHOO.lang.extend(KJUR.asn1.x509.AttributeTypeAndValue,KJUR.asn1.ASN1Object);KJUR.asn1.x509.SubjectPublicKeyInfo=function(params){KJUR.asn1.x509.SubjectPublicKeyInfo.superclass.constructor.call(this);var asn1AlgId=null;var asn1SubjPKey=null;var rsaKey=null;this.setRSAKey=function(rsaKey){if(!RSAKey.prototype.isPrototypeOf(rsaKey))throw"argument is not RSAKey instance";this.rsaKey=rsaKey;var asn1RsaN=new KJUR.asn1.DERInteger({bigint:rsaKey.n});var asn1RsaE=new KJUR.asn1.DERInteger({"int":rsaKey.e});var asn1RsaPub=new KJUR.asn1.DERSequence({array:[asn1RsaN,asn1RsaE]});var rsaKeyHex=asn1RsaPub.getEncodedHex();this.asn1AlgId=new KJUR.asn1.x509.AlgorithmIdentifier({name:"rsaEncryption"});this.asn1SubjPKey=new KJUR.asn1.DERBitString({hex:"00"+rsaKeyHex})};this.setRSAPEM=function(rsaPubPEM){if(rsaPubPEM.match(/-----BEGIN PUBLIC KEY-----/)){var s=rsaPubPEM;s=s.replace(/^-----[^-]+-----/,"");s=s.replace(/-----[^-]+-----\s*$/,"");var rsaB64=s.replace(/\s+/g,"");var rsaWA=CryptoJS.enc.Base64.parse(rsaB64);var rsaP8Hex=CryptoJS.enc.Hex.stringify(rsaWA);var a=_rsapem_getHexValueArrayOfChildrenFromHex(rsaP8Hex);var hBitStrVal=a[1];var rsaHex=hBitStrVal.substr(2);var a3=_rsapem_getHexValueArrayOfChildrenFromHex(rsaHex);var rsaKey=new RSAKey;rsaKey.setPublic(a3[0],a3[1]);this.setRSAKey(rsaKey)}else{throw"key not supported"}};this.getASN1Object=function(){if(this.asn1AlgId==null||this.asn1SubjPKey==null)throw"algId and/or subjPubKey not set";var o=new KJUR.asn1.DERSequence({array:[this.asn1AlgId,this.asn1SubjPKey]});return o};this.getEncodedHex=function(){var o=this.getASN1Object();this.hTLV=o.getEncodedHex();return this.hTLV};this._setRSAKey=function(key){var asn1RsaPub=KJUR.asn1.ASN1Util.newObject({seq:[{"int":{bigint:key.n}},{"int":{"int":key.e}}]});var rsaKeyHex=asn1RsaPub.getEncodedHex();this.asn1AlgId=new KJUR.asn1.x509.AlgorithmIdentifier({name:"rsaEncryption"});this.asn1SubjPKey=new KJUR.asn1.DERBitString({hex:"00"+rsaKeyHex})};this._setEC=function(key){var asn1Params=new KJUR.asn1.DERObjectIdentifier({name:key.curveName});this.asn1AlgId=new KJUR.asn1.x509.AlgorithmIdentifier({name:"ecPublicKey",asn1params:asn1Params});this.asn1SubjPKey=new KJUR.asn1.DERBitString({hex:"00"+key.pubKeyHex})};this._setDSA=function(key){var asn1Params=new KJUR.asn1.ASN1Util.newObject({seq:[{"int":{bigint:key.p}},{"int":{bigint:key.q}},{"int":{bigint:key.g}}]});this.asn1AlgId=new KJUR.asn1.x509.AlgorithmIdentifier({name:"dsa",asn1params:asn1Params});var pubInt=new KJUR.asn1.DERInteger({bigint:key.y});this.asn1SubjPKey=new KJUR.asn1.DERBitString({hex:"00"+pubInt.getEncodedHex()})};if(typeof params!="undefined"){if(typeof RSAKey!="undefined"&&params instanceof RSAKey){this._setRSAKey(params)}else if(typeof KJUR.crypto.ECDSA!="undefined"&&params instanceof KJUR.crypto.ECDSA){this._setEC(params)}else if(typeof KJUR.crypto.DSA!="undefined"&&params instanceof KJUR.crypto.DSA){this._setDSA(params)}else if(typeof params["rsakey"]!="undefined"){this.setRSAKey(params["rsakey"])}else if(typeof params["rsapem"]!="undefined"){this.setRSAPEM(params["rsapem"])}}};YAHOO.lang.extend(KJUR.asn1.x509.SubjectPublicKeyInfo,KJUR.asn1.ASN1Object);KJUR.asn1.x509.Time=function(params){KJUR.asn1.x509.Time.superclass.constructor.call(this);var type=null;var timeParams=null;this.setTimeParams=function(timeParams){this.timeParams=timeParams};this.getEncodedHex=function(){var o=null;if(this.timeParams!=null){if(this.type=="utc"){o=new KJUR.asn1.DERUTCTime(this.timeParams)}else{o=new KJUR.asn1.DERGeneralizedTime(this.timeParams)}}else{if(this.type=="utc"){o=new KJUR.asn1.DERUTCTime}else{o=new KJUR.asn1.DERGeneralizedTime}}this.TLV=o.getEncodedHex();return this.TLV};this.type="utc";if(typeof params!="undefined"){if(typeof params.type!="undefined"){this.type=params.type}else{if(typeof params.str!="undefined"){if(params.str.match(/^[0-9]{12}Z$/))this.type="utc";if(params.str.match(/^[0-9]{14}Z$/))this.type="gen"}}this.timeParams=params}};YAHOO.lang.extend(KJUR.asn1.x509.Time,KJUR.asn1.ASN1Object);KJUR.asn1.x509.AlgorithmIdentifier=function(params){KJUR.asn1.x509.AlgorithmIdentifier.superclass.constructor.call(this);var nameAlg=null;var asn1Alg=null;var asn1Params=null;var paramEmpty=false;this.getEncodedHex=function(){if(this.nameAlg==null&&this.asn1Alg==null){throw"algorithm not specified"}if(this.nameAlg!=null&&this.asn1Alg==null){this.asn1Alg=KJUR.asn1.x509.OID.name2obj(this.nameAlg)}var a=[this.asn1Alg];if(!this.paramEmpty)a.push(this.asn1Params);var o=new KJUR.asn1.DERSequence({array:a});this.hTLV=o.getEncodedHex();return this.hTLV};if(typeof params!="undefined"){if(typeof params["name"]!="undefined"){this.nameAlg=params["name"]}if(typeof params["asn1params"]!="undefined"){this.asn1Params=params["asn1params"]}if(typeof params["paramempty"]!="undefined"){this.paramEmpty=params["paramempty"]}}if(this.asn1Params==null){this.asn1Params=new KJUR.asn1.DERNull}};YAHOO.lang.extend(KJUR.asn1.x509.AlgorithmIdentifier,KJUR.asn1.ASN1Object);KJUR.asn1.x509.GeneralName=function(params){KJUR.asn1.x509.GeneralName.superclass.constructor.call(this);var asn1Obj=null;var type=null;var pTag={rfc822:"81",dns:"82",uri:"86"};this.setByParam=function(params){var str=null;var v=null;if(typeof params["rfc822"]!="undefined"){this.type="rfc822";v=new KJUR.asn1.DERIA5String({str:params[this.type]})}if(typeof params["dns"]!="undefined"){this.type="dns";v=new KJUR.asn1.DERIA5String({str:params[this.type]})}if(typeof params["uri"]!="undefined"){this.type="uri";v=new KJUR.asn1.DERIA5String({str:params[this.type]})}if(this.type==null)throw"unsupported type in params="+params;this.asn1Obj=new KJUR.asn1.DERTaggedObject({explicit:false,tag:pTag[this.type],obj:v})};this.getEncodedHex=function(){return this.asn1Obj.getEncodedHex()};if(typeof params!="undefined"){this.setByParam(params)}};YAHOO.lang.extend(KJUR.asn1.x509.GeneralName,KJUR.asn1.ASN1Object);KJUR.asn1.x509.GeneralNames=function(paramsArray){KJUR.asn1.x509.GeneralNames.superclass.constructor.call(this);var asn1Array=null;this.setByParamArray=function(paramsArray){for(var i=0;i<paramsArray.length;i++){var o=new KJUR.asn1.x509.GeneralName(paramsArray[i]);this.asn1Array.push(o)}};this.getEncodedHex=function(){var o=new KJUR.asn1.DERSequence({array:this.asn1Array});return o.getEncodedHex()};this.asn1Array=new Array;if(typeof paramsArray!="undefined"){this.setByParamArray(paramsArray)}};YAHOO.lang.extend(KJUR.asn1.x509.GeneralNames,KJUR.asn1.ASN1Object);KJUR.asn1.x509.DistributionPointName=function(gnOrRdn){KJUR.asn1.x509.DistributionPointName.superclass.constructor.call(this);var asn1Obj=null;var type=null;var tag=null;var asn1V=null;this.getEncodedHex=function(){if(this.type!="full")throw"currently type shall be 'full': "+this.type;this.asn1Obj=new KJUR.asn1.DERTaggedObject({explicit:false,tag:this.tag,obj:this.asn1V});this.hTLV=this.asn1Obj.getEncodedHex();return this.hTLV};if(typeof gnOrRdn!="undefined"){if(KJUR.asn1.x509.GeneralNames.prototype.isPrototypeOf(gnOrRdn)){this.type="full";this.tag="a0";this.asn1V=gnOrRdn}else{throw"This class supports GeneralNames only as argument"}}};YAHOO.lang.extend(KJUR.asn1.x509.DistributionPointName,KJUR.asn1.ASN1Object);KJUR.asn1.x509.DistributionPoint=function(params){KJUR.asn1.x509.DistributionPoint.superclass.constructor.call(this);var asn1DP=null;this.getEncodedHex=function(){var seq=new KJUR.asn1.DERSequence;if(this.asn1DP!=null){var o1=new KJUR.asn1.DERTaggedObject({explicit:true,tag:"a0",obj:this.asn1DP});seq.appendASN1Object(o1)}this.hTLV=seq.getEncodedHex();return this.hTLV};if(typeof params!="undefined"){if(typeof params["dpobj"]!="undefined"){this.asn1DP=params["dpobj"]}}};YAHOO.lang.extend(KJUR.asn1.x509.DistributionPoint,KJUR.asn1.ASN1Object);KJUR.asn1.x509.OID=new function(params){this.atype2oidList={C:"2.5.4.6",O:"2.5.4.10",OU:"2.5.4.11",ST:"2.5.4.8",L:"2.5.4.7",CN:"2.5.4.3",DN:"2.5.4.49",DC:"0.9.2342.19200300.100.1.25"};this.name2oidList={sha1:"1.3.14.3.2.26",sha256:"2.16.840.1.101.3.4.2.1",sha384:"2.16.840.1.101.3.4.2.2",sha512:"2.16.840.1.101.3.4.2.3",sha224:"2.16.840.1.101.3.4.2.4",md5:"1.2.840.113549.2.5",md2:"1.3.14.7.2.2.1",ripemd160:"1.3.36.3.2.1",MD2withRSA:"1.2.840.113549.1.1.2",MD4withRSA:"1.2.840.113549.1.1.3",MD5withRSA:"1.2.840.113549.1.1.4",SHA1withRSA:"1.2.840.113549.1.1.5",SHA224withRSA:"1.2.840.113549.1.1.14",SHA256withRSA:"1.2.840.113549.1.1.11",SHA384withRSA:"1.2.840.113549.1.1.12",SHA512withRSA:"1.2.840.113549.1.1.13",SHA1withECDSA:"1.2.840.10045.4.1",SHA224withECDSA:"1.2.840.10045.4.3.1",SHA256withECDSA:"1.2.840.10045.4.3.2",SHA384withECDSA:"1.2.840.10045.4.3.3",SHA512withECDSA:"1.2.840.10045.4.3.4",dsa:"1.2.840.10040.4.1",SHA1withDSA:"1.2.840.10040.4.3",SHA224withDSA:"2.16.840.1.101.3.4.3.1",SHA256withDSA:"2.16.840.1.101.3.4.3.2",rsaEncryption:"1.2.840.113549.1.1.1",subjectKeyIdentifier:"2.5.29.14",countryName:"2.5.4.6",organization:"2.5.4.10",organizationalUnit:"2.5.4.11",stateOrProvinceName:"2.5.4.8",locality:"2.5.4.7",commonName:"2.5.4.3",keyUsage:"2.5.29.15",basicConstraints:"2.5.29.19",cRLDistributionPoints:"2.5.29.31",certificatePolicies:"2.5.29.32",authorityKeyIdentifier:"2.5.29.35",extKeyUsage:"2.5.29.37",anyExtendedKeyUsage:"2.5.29.37.0",serverAuth:"1.3.6.1.5.5.7.3.1",clientAuth:"1.3.6.1.5.5.7.3.2",codeSigning:"1.3.6.1.5.5.7.3.3",emailProtection:"1.3.6.1.5.5.7.3.4",timeStamping:"1.3.6.1.5.5.7.3.8",ocspSigning:"1.3.6.1.5.5.7.3.9",ecPublicKey:"1.2.840.10045.2.1",secp256r1:"1.2.840.10045.3.1.7",secp256k1:"1.3.132.0.10",secp384r1:"1.3.132.0.34",pkcs5PBES2:"1.2.840.113549.1.5.13",pkcs5PBKDF2:"1.2.840.113549.1.5.12","des-EDE3-CBC":"1.2.840.113549.3.7",data:"1.2.840.113549.1.7.1","signed-data":"1.2.840.113549.1.7.2","enveloped-data":"1.2.840.113549.1.7.3","digested-data":"1.2.840.113549.1.7.5","encrypted-data":"1.2.840.113549.1.7.6","authenticated-data":"1.2.840.113549.1.9.16.1.2",tstinfo:"1.2.840.113549.1.9.16.1.4"};this.objCache={};this.name2obj=function(name){if(typeof this.objCache[name]!="undefined")return this.objCache[name];if(typeof this.name2oidList[name]=="undefined")throw"Name of ObjectIdentifier not defined: "+name;var oid=this.name2oidList[name];var obj=new KJUR.asn1.DERObjectIdentifier({oid:oid});this.objCache[name]=obj;return obj};this.atype2obj=function(atype){if(typeof this.objCache[atype]!="undefined")return this.objCache[atype];if(typeof this.atype2oidList[atype]=="undefined")throw"AttributeType name undefined: "+atype;var oid=this.atype2oidList[atype];var obj=new KJUR.asn1.DERObjectIdentifier({oid:oid});this.objCache[atype]=obj;return obj}};KJUR.asn1.x509.OID.oid2name=function(oid){var list=KJUR.asn1.x509.OID.name2oidList;for(var name in list){if(list[name]==oid)return name}return""};KJUR.asn1.x509.X509Util=new function(){this.getPKCS8PubKeyPEMfromRSAKey=function(rsaKey){var pem=null;var hN=KJUR.asn1.ASN1Util.bigIntToMinTwosComplementsHex(rsaKey.n);var hE=KJUR.asn1.ASN1Util.integerToByteHex(rsaKey.e);var iN=new KJUR.asn1.DERInteger({hex:hN});var iE=new KJUR.asn1.DERInteger({hex:hE});var asn1PubKey=new KJUR.asn1.DERSequence({array:[iN,iE]});var hPubKey=asn1PubKey.getEncodedHex();var o1=new KJUR.asn1.x509.AlgorithmIdentifier({name:"rsaEncryption"});var o2=new KJUR.asn1.DERBitString({hex:"00"+hPubKey});var seq=new KJUR.asn1.DERSequence({array:[o1,o2]});var hP8=seq.getEncodedHex();var pem=KJUR.asn1.ASN1Util.getPEMStringFromHex(hP8,"PUBLIC KEY");return pem}};KJUR.asn1.x509.X509Util.newCertPEM=function(param){var ns1=KJUR.asn1.x509;var o=new ns1.TBSCertificate;if(param.serial!==undefined)o.setSerialNumberByParam(param.serial);else throw"serial number undefined.";if(typeof param.sigalg.name=="string")o.setSignatureAlgByParam(param.sigalg);else throw"unproper signature algorithm name";if(param.issuer!==undefined)o.setIssuerByParam(param.issuer);else throw"issuer name undefined.";if(param.notbefore!==undefined)o.setNotBeforeByParam(param.notbefore);else throw"notbefore undefined.";if(param.notafter!==undefined)o.setNotAfterByParam(param.notafter);else throw"notafter undefined.";if(param.subject!==undefined)o.setSubjectByParam(param.subject);else throw"subject name undefined.";if(param.sbjpubkey!==undefined)o.setSubjectPublicKeyByGetKey(param.sbjpubkey);else throw"subject public key undefined.";if(param.ext!==undefined&&param.ext.length!==undefined){for(var i=0;i<param.ext.length;i++){for(key in param.ext[i]){o.appendExtensionByName(key,param.ext[i][key])}}}if(param.cakey===undefined&&param.sighex===undefined)throw"param cakey and sighex undefined.";var caKey=null;var cert=null;if(param.cakey){caKey=KEYUTIL.getKey.apply(null,param.cakey);cert=new ns1.Certificate({tbscertobj:o,prvkeyobj:caKey});cert.sign()}if(param.sighex){cert=new ns1.Certificate({tbscertobj:o});cert.setSignatureHex(param.sighex)}return cert.getPEMString()};var _RE_HEXDECONLY=new RegExp("");_RE_HEXDECONLY.compile("[^0-9a-f]","gi");function _rsasign_getHexPaddedDigestInfoForString(s,keySize,hashAlg){var hashFunc=function(s){return KJUR.crypto.Util.hashString(s,hashAlg)};var sHashHex=hashFunc(s);return KJUR.crypto.Util.getPaddedDigestInfoHex(sHashHex,hashAlg,keySize)}function _zeroPaddingOfSignature(hex,bitLength){var s="";var nZero=bitLength/4-hex.length;for(var i=0;i<nZero;i++){s=s+"0"}return s+hex}function _rsasign_signString(s,hashAlg){var hashFunc=function(s){return KJUR.crypto.Util.hashString(s,hashAlg)};var sHashHex=hashFunc(s);return this.signWithMessageHash(sHashHex,hashAlg)}function _rsasign_signWithMessageHash(sHashHex,hashAlg){var hPM=KJUR.crypto.Util.getPaddedDigestInfoHex(sHashHex,hashAlg,this.n.bitLength());var biPaddedMessage=parseBigInt(hPM,16);var biSign=this.doPrivate(biPaddedMessage);var hexSign=biSign.toString(16);return _zeroPaddingOfSignature(hexSign,this.n.bitLength())}function _rsasign_signStringWithSHA1(s){return _rsasign_signString.call(this,s,"sha1")}function _rsasign_signStringWithSHA256(s){return _rsasign_signString.call(this,s,"sha256")}function pss_mgf1_str(seed,len,hash){var mask="",i=0;while(mask.length<len){mask+=hextorstr(hash(rstrtohex(seed+String.fromCharCode.apply(String,[(i&4278190080)>>24,(i&16711680)>>16,(i&65280)>>8,i&255]))));i+=1}return mask}function _rsasign_signStringPSS(s,hashAlg,sLen){var hashFunc=function(sHex){return KJUR.crypto.Util.hashHex(sHex,hashAlg)};var hHash=hashFunc(rstrtohex(s));if(sLen===undefined)sLen=-1;return this.signWithMessageHashPSS(hHash,hashAlg,sLen)}function _rsasign_signWithMessageHashPSS(hHash,hashAlg,sLen){var mHash=hextorstr(hHash);var hLen=mHash.length;var emBits=this.n.bitLength()-1;var emLen=Math.ceil(emBits/8);var i;var hashFunc=function(sHex){return KJUR.crypto.Util.hashHex(sHex,hashAlg)};if(sLen===-1||sLen===undefined){sLen=hLen}else if(sLen===-2){sLen=emLen-hLen-2}else if(sLen<-2){throw"invalid salt length"}if(emLen<hLen+sLen+2){throw"data too long"}var salt="";if(sLen>0){salt=new Array(sLen);(new SecureRandom).nextBytes(salt);salt=String.fromCharCode.apply(String,salt)}var H=hextorstr(hashFunc(rstrtohex("\x00\x00\x00\x00\x00\x00\x00\x00"+mHash+salt)));var PS=[];for(i=0;i<emLen-sLen-hLen-2;i+=1){PS[i]=0}var DB=String.fromCharCode.apply(String,PS)+""+salt;var dbMask=pss_mgf1_str(H,DB.length,hashFunc);var maskedDB=[];
for(i=0;i<DB.length;i+=1){maskedDB[i]=DB.charCodeAt(i)^dbMask.charCodeAt(i)}var mask=65280>>8*emLen-emBits&255;maskedDB[0]&=~mask;for(i=0;i<hLen;i++){maskedDB.push(H.charCodeAt(i))}maskedDB.push(188);return _zeroPaddingOfSignature(this.doPrivate(new BigInteger(maskedDB)).toString(16),this.n.bitLength())}function _rsasign_getDecryptSignatureBI(biSig,hN,hE){var rsa=new RSAKey;rsa.setPublic(hN,hE);var biDecryptedSig=rsa.doPublic(biSig);return biDecryptedSig}function _rsasign_getHexDigestInfoFromSig(biSig,hN,hE){var biDecryptedSig=_rsasign_getDecryptSignatureBI(biSig,hN,hE);var hDigestInfo=biDecryptedSig.toString(16).replace(/^1f+00/,"");return hDigestInfo}function _rsasign_getAlgNameAndHashFromHexDisgestInfo(hDigestInfo){for(var algName in KJUR.crypto.Util.DIGESTINFOHEAD){var head=KJUR.crypto.Util.DIGESTINFOHEAD[algName];var len=head.length;if(hDigestInfo.substring(0,len)==head){var a=[algName,hDigestInfo.substring(len)];return a}}return[]}function _rsasign_verifySignatureWithArgs(sMsg,biSig,hN,hE){var hDigestInfo=_rsasign_getHexDigestInfoFromSig(biSig,hN,hE);var digestInfoAry=_rsasign_getAlgNameAndHashFromHexDisgestInfo(hDigestInfo);if(digestInfoAry.length==0)return false;var algName=digestInfoAry[0];var diHashValue=digestInfoAry[1];var ff=function(s){return KJUR.crypto.Util.hashString(s,algName)};var msgHashValue=ff(sMsg);return diHashValue==msgHashValue}function _rsasign_verifyHexSignatureForMessage(hSig,sMsg){var biSig=parseBigInt(hSig,16);var result=_rsasign_verifySignatureWithArgs(sMsg,biSig,this.n.toString(16),this.e.toString(16));return result}function _rsasign_verifyString(sMsg,hSig){hSig=hSig.replace(_RE_HEXDECONLY,"");hSig=hSig.replace(/[ \n]+/g,"");var biSig=parseBigInt(hSig,16);if(biSig.bitLength()>this.n.bitLength())return 0;var biDecryptedSig=this.doPublic(biSig);var hDigestInfo=biDecryptedSig.toString(16).replace(/^1f+00/,"");var digestInfoAry=_rsasign_getAlgNameAndHashFromHexDisgestInfo(hDigestInfo);if(digestInfoAry.length==0)return false;var algName=digestInfoAry[0];var diHashValue=digestInfoAry[1];var ff=function(s){return KJUR.crypto.Util.hashString(s,algName)};var msgHashValue=ff(sMsg);return diHashValue==msgHashValue}function _rsasign_verifyWithMessageHash(sHashHex,hSig){hSig=hSig.replace(_RE_HEXDECONLY,"");hSig=hSig.replace(/[ \n]+/g,"");var biSig=parseBigInt(hSig,16);if(biSig.bitLength()>this.n.bitLength())return 0;var biDecryptedSig=this.doPublic(biSig);var hDigestInfo=biDecryptedSig.toString(16).replace(/^1f+00/,"");var digestInfoAry=_rsasign_getAlgNameAndHashFromHexDisgestInfo(hDigestInfo);if(digestInfoAry.length==0)return false;var algName=digestInfoAry[0];var diHashValue=digestInfoAry[1];return diHashValue==sHashHex}function _rsasign_verifyStringPSS(sMsg,hSig,hashAlg,sLen){var hashFunc=function(sHex){return KJUR.crypto.Util.hashHex(sHex,hashAlg)};var hHash=hashFunc(rstrtohex(sMsg));if(sLen===undefined)sLen=-1;return this.verifyWithMessageHashPSS(hHash,hSig,hashAlg,sLen)}function _rsasign_verifyWithMessageHashPSS(hHash,hSig,hashAlg,sLen){var biSig=new BigInteger(hSig,16);if(biSig.bitLength()>this.n.bitLength()){return false}var hashFunc=function(sHex){return KJUR.crypto.Util.hashHex(sHex,hashAlg)};var mHash=hextorstr(hHash);var hLen=mHash.length;var emBits=this.n.bitLength()-1;var emLen=Math.ceil(emBits/8);var i;if(sLen===-1||sLen===undefined){sLen=hLen}else if(sLen===-2){sLen=emLen-hLen-2}else if(sLen<-2){throw"invalid salt length"}if(emLen<hLen+sLen+2){throw"data too long"}var em=this.doPublic(biSig).toByteArray();for(i=0;i<em.length;i+=1){em[i]&=255}while(em.length<emLen){em.unshift(0)}if(em[emLen-1]!==188){throw"encoded message does not end in 0xbc"}em=String.fromCharCode.apply(String,em);var maskedDB=em.substr(0,emLen-hLen-1);var H=em.substr(maskedDB.length,hLen);var mask=65280>>8*emLen-emBits&255;if((maskedDB.charCodeAt(0)&mask)!==0){throw"bits beyond keysize not zero"}var dbMask=pss_mgf1_str(H,maskedDB.length,hashFunc);var DB=[];for(i=0;i<maskedDB.length;i+=1){DB[i]=maskedDB.charCodeAt(i)^dbMask.charCodeAt(i)}DB[0]&=~mask;var checkLen=emLen-hLen-sLen-2;for(i=0;i<checkLen;i+=1){if(DB[i]!==0){throw"leftmost octets not zero"}}if(DB[checkLen]!==1){throw"0x01 marker not found"}return H===hextorstr(hashFunc(rstrtohex("\x00\x00\x00\x00\x00\x00\x00\x00"+mHash+String.fromCharCode.apply(String,DB.slice(-sLen)))))}RSAKey.prototype.signWithMessageHash=_rsasign_signWithMessageHash;RSAKey.prototype.signString=_rsasign_signString;RSAKey.prototype.signStringWithSHA1=_rsasign_signStringWithSHA1;RSAKey.prototype.signStringWithSHA256=_rsasign_signStringWithSHA256;RSAKey.prototype.sign=_rsasign_signString;RSAKey.prototype.signWithSHA1=_rsasign_signStringWithSHA1;RSAKey.prototype.signWithSHA256=_rsasign_signStringWithSHA256;RSAKey.prototype.signWithMessageHashPSS=_rsasign_signWithMessageHashPSS;RSAKey.prototype.signStringPSS=_rsasign_signStringPSS;RSAKey.prototype.signPSS=_rsasign_signStringPSS;RSAKey.SALT_LEN_HLEN=-1;RSAKey.SALT_LEN_MAX=-2;RSAKey.prototype.verifyWithMessageHash=_rsasign_verifyWithMessageHash;RSAKey.prototype.verifyString=_rsasign_verifyString;RSAKey.prototype.verifyHexSignatureForMessage=_rsasign_verifyHexSignatureForMessage;RSAKey.prototype.verify=_rsasign_verifyString;RSAKey.prototype.verifyHexSignatureForByteArrayMessage=_rsasign_verifyHexSignatureForMessage;RSAKey.prototype.verifyWithMessageHashPSS=_rsasign_verifyWithMessageHashPSS;RSAKey.prototype.verifyStringPSS=_rsasign_verifyStringPSS;RSAKey.prototype.verifyPSS=_rsasign_verifyStringPSS;RSAKey.SALT_LEN_RECOVER=-2;function _rsapem_pemToBase64(sPEMPrivateKey){var s=sPEMPrivateKey;s=s.replace("-----BEGIN RSA PRIVATE KEY-----","");s=s.replace("-----END RSA PRIVATE KEY-----","");s=s.replace(/[ \n]+/g,"");return s}function _rsapem_getPosArrayOfChildrenFromHex(hPrivateKey){var a=new Array;var v1=ASN1HEX.getStartPosOfV_AtObj(hPrivateKey,0);var n1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,v1);var e1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,n1);var d1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,e1);var p1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,d1);var q1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,p1);var dp1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,q1);var dq1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,dp1);var co1=ASN1HEX.getPosOfNextSibling_AtObj(hPrivateKey,dq1);a.push(v1,n1,e1,d1,p1,q1,dp1,dq1,co1);return a}function _rsapem_getHexValueArrayOfChildrenFromHex(hPrivateKey){var posArray=_rsapem_getPosArrayOfChildrenFromHex(hPrivateKey);var v=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[0]);var n=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[1]);var e=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[2]);var d=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[3]);var p=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[4]);var q=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[5]);var dp=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[6]);var dq=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[7]);var co=ASN1HEX.getHexOfV_AtObj(hPrivateKey,posArray[8]);var a=new Array;a.push(v,n,e,d,p,q,dp,dq,co);return a}function _rsapem_readPrivateKeyFromASN1HexString(keyHex){var a=_rsapem_getHexValueArrayOfChildrenFromHex(keyHex);this.setPrivateEx(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])}function _rsapem_readPrivateKeyFromPEMString(keyPEM){var keyB64=_rsapem_pemToBase64(keyPEM);var keyHex=b64tohex(keyB64);var a=_rsapem_getHexValueArrayOfChildrenFromHex(keyHex);this.setPrivateEx(a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8])}RSAKey.prototype.readPrivateKeyFromPEMString=_rsapem_readPrivateKeyFromPEMString;RSAKey.prototype.readPrivateKeyFromASN1HexString=_rsapem_readPrivateKeyFromASN1HexString;var KEYUTIL=function(){var decryptAES=function(dataHex,keyHex,ivHex){return decryptGeneral(CryptoJS.AES,dataHex,keyHex,ivHex)};var decrypt3DES=function(dataHex,keyHex,ivHex){return decryptGeneral(CryptoJS.TripleDES,dataHex,keyHex,ivHex)};var decryptDES=function(dataHex,keyHex,ivHex){return decryptGeneral(CryptoJS.DES,dataHex,keyHex,ivHex)};var decryptGeneral=function(f,dataHex,keyHex,ivHex){var data=CryptoJS.enc.Hex.parse(dataHex);var key=CryptoJS.enc.Hex.parse(keyHex);var iv=CryptoJS.enc.Hex.parse(ivHex);var encrypted={};encrypted.key=key;encrypted.iv=iv;encrypted.ciphertext=data;var decrypted=f.decrypt(encrypted,key,{iv:iv});return CryptoJS.enc.Hex.stringify(decrypted)};var encryptAES=function(dataHex,keyHex,ivHex){return encryptGeneral(CryptoJS.AES,dataHex,keyHex,ivHex)};var encrypt3DES=function(dataHex,keyHex,ivHex){return encryptGeneral(CryptoJS.TripleDES,dataHex,keyHex,ivHex)};var encryptDES=function(dataHex,keyHex,ivHex){return encryptGeneral(CryptoJS.DES,dataHex,keyHex,ivHex)};var encryptGeneral=function(f,dataHex,keyHex,ivHex){var data=CryptoJS.enc.Hex.parse(dataHex);var key=CryptoJS.enc.Hex.parse(keyHex);var iv=CryptoJS.enc.Hex.parse(ivHex);var encryptedHex=f.encrypt(data,key,{iv:iv});var encryptedWA=CryptoJS.enc.Hex.parse(encryptedHex.toString());var encryptedB64=CryptoJS.enc.Base64.stringify(encryptedWA);return encryptedB64};var ALGLIST={"AES-256-CBC":{proc:decryptAES,eproc:encryptAES,keylen:32,ivlen:16},"AES-192-CBC":{proc:decryptAES,eproc:encryptAES,keylen:24,ivlen:16},"AES-128-CBC":{proc:decryptAES,eproc:encryptAES,keylen:16,ivlen:16},"DES-EDE3-CBC":{proc:decrypt3DES,eproc:encrypt3DES,keylen:24,ivlen:8},"DES-CBC":{proc:decryptDES,eproc:encryptDES,keylen:8,ivlen:8}};var getFuncByName=function(algName){return ALGLIST[algName]["proc"]};var _generateIvSaltHex=function(numBytes){var wa=CryptoJS.lib.WordArray.random(numBytes);var hex=CryptoJS.enc.Hex.stringify(wa);return hex};var _parsePKCS5PEM=function(sPKCS5PEM){var info={};if(sPKCS5PEM.match(new RegExp("DEK-Info: ([^,]+),([0-9A-Fa-f]+)","m"))){info.cipher=RegExp.$1;info.ivsalt=RegExp.$2}if(sPKCS5PEM.match(new RegExp("-----BEGIN ([A-Z]+) PRIVATE KEY-----"))){info.type=RegExp.$1}var i1=-1;var lenNEWLINE=0;if(sPKCS5PEM.indexOf("\r\n\r\n")!=-1){i1=sPKCS5PEM.indexOf("\r\n\r\n");lenNEWLINE=2}if(sPKCS5PEM.indexOf("\n\n")!=-1){i1=sPKCS5PEM.indexOf("\n\n");lenNEWLINE=1}var i2=sPKCS5PEM.indexOf("-----END");if(i1!=-1&&i2!=-1){var s=sPKCS5PEM.substring(i1+lenNEWLINE*2,i2-lenNEWLINE);s=s.replace(/\s+/g,"");info.data=s}return info};var _getKeyAndUnusedIvByPasscodeAndIvsalt=function(algName,passcode,ivsaltHex){var saltHex=ivsaltHex.substring(0,16);var salt=CryptoJS.enc.Hex.parse(saltHex);var data=CryptoJS.enc.Utf8.parse(passcode);var nRequiredBytes=ALGLIST[algName]["keylen"]+ALGLIST[algName]["ivlen"];var hHexValueJoined="";var hLastValue=null;for(;;){var h=CryptoJS.algo.MD5.create();if(hLastValue!=null){h.update(hLastValue)}h.update(data);h.update(salt);hLastValue=h.finalize();hHexValueJoined=hHexValueJoined+CryptoJS.enc.Hex.stringify(hLastValue);if(hHexValueJoined.length>=nRequiredBytes*2){break}}var result={};result.keyhex=hHexValueJoined.substr(0,ALGLIST[algName]["keylen"]*2);result.ivhex=hHexValueJoined.substr(ALGLIST[algName]["keylen"]*2,ALGLIST[algName]["ivlen"]*2);return result};var _decryptKeyB64=function(privateKeyB64,sharedKeyAlgName,sharedKeyHex,ivsaltHex){var privateKeyWA=CryptoJS.enc.Base64.parse(privateKeyB64);var privateKeyHex=CryptoJS.enc.Hex.stringify(privateKeyWA);var f=ALGLIST[sharedKeyAlgName]["proc"];var decryptedKeyHex=f(privateKeyHex,sharedKeyHex,ivsaltHex);return decryptedKeyHex};var _encryptKeyHex=function(privateKeyHex,sharedKeyAlgName,sharedKeyHex,ivsaltHex){var f=ALGLIST[sharedKeyAlgName]["eproc"];var encryptedKeyB64=f(privateKeyHex,sharedKeyHex,ivsaltHex);return encryptedKeyB64};return{version:"1.0.0",getHexFromPEM:function(sPEM,sHead){var s=sPEM;if(s.indexOf("-----BEGIN ")==-1){throw"can't find PEM header: "+sHead}if(typeof sHead=="string"&&sHead!=""){s=s.replace("-----BEGIN "+sHead+"-----","");s=s.replace("-----END "+sHead+"-----","")}else{s=s.replace(/-----BEGIN [^-]+-----/,"");s=s.replace(/-----END [^-]+-----/,"")}var sB64=s.replace(/\s+/g,"");var dataHex=b64tohex(sB64);return dataHex},getDecryptedKeyHexByKeyIV:function(encryptedKeyHex,algName,sharedKeyHex,ivHex){var f1=getFuncByName(algName);return f1(encryptedKeyHex,sharedKeyHex,ivHex)},parsePKCS5PEM:function(sPKCS5PEM){return _parsePKCS5PEM(sPKCS5PEM)},getKeyAndUnusedIvByPasscodeAndIvsalt:function(algName,passcode,ivsaltHex){return _getKeyAndUnusedIvByPasscodeAndIvsalt(algName,passcode,ivsaltHex)},decryptKeyB64:function(privateKeyB64,sharedKeyAlgName,sharedKeyHex,ivsaltHex){return _decryptKeyB64(privateKeyB64,sharedKeyAlgName,sharedKeyHex,ivsaltHex)},getDecryptedKeyHex:function(sEncryptedPEM,passcode){var info=_parsePKCS5PEM(sEncryptedPEM);var publicKeyAlgName=info.type;var sharedKeyAlgName=info.cipher;var ivsaltHex=info.ivsalt;var privateKeyB64=info.data;var sharedKeyInfo=_getKeyAndUnusedIvByPasscodeAndIvsalt(sharedKeyAlgName,passcode,ivsaltHex);var sharedKeyHex=sharedKeyInfo.keyhex;var decryptedKey=_decryptKeyB64(privateKeyB64,sharedKeyAlgName,sharedKeyHex,ivsaltHex);return decryptedKey},getRSAKeyFromEncryptedPKCS5PEM:function(sEncryptedP5PEM,passcode){var hPKey=this.getDecryptedKeyHex(sEncryptedP5PEM,passcode);var rsaKey=new RSAKey;rsaKey.readPrivateKeyFromASN1HexString(hPKey);return rsaKey},getEncryptedPKCS5PEMFromPrvKeyHex:function(pemHeadAlg,hPrvKey,passcode,sharedKeyAlgName,ivsaltHex){var sPEM="";if(typeof sharedKeyAlgName=="undefined"||sharedKeyAlgName==null){sharedKeyAlgName="AES-256-CBC"}if(typeof ALGLIST[sharedKeyAlgName]=="undefined")throw"KEYUTIL unsupported algorithm: "+sharedKeyAlgName;if(typeof ivsaltHex=="undefined"||ivsaltHex==null){var ivlen=ALGLIST[sharedKeyAlgName]["ivlen"];var randIV=_generateIvSaltHex(ivlen);ivsaltHex=randIV.toUpperCase()}var sharedKeyInfo=_getKeyAndUnusedIvByPasscodeAndIvsalt(sharedKeyAlgName,passcode,ivsaltHex);var sharedKeyHex=sharedKeyInfo.keyhex;var encryptedKeyB64=_encryptKeyHex(hPrvKey,sharedKeyAlgName,sharedKeyHex,ivsaltHex);var pemBody=encryptedKeyB64.replace(/(.{64})/g,"$1\r\n");var sPEM="-----BEGIN "+pemHeadAlg+" PRIVATE KEY-----\r\n";sPEM+="Proc-Type: 4,ENCRYPTED\r\n";sPEM+="DEK-Info: "+sharedKeyAlgName+","+ivsaltHex+"\r\n";sPEM+="\r\n";sPEM+=pemBody;sPEM+="\r\n-----END "+pemHeadAlg+" PRIVATE KEY-----\r\n";return sPEM},getEncryptedPKCS5PEMFromRSAKey:function(pKey,passcode,alg,ivsaltHex){var version=new KJUR.asn1.DERInteger({"int":0});var n=new KJUR.asn1.DERInteger({bigint:pKey.n});var e=new KJUR.asn1.DERInteger({"int":pKey.e});var d=new KJUR.asn1.DERInteger({bigint:pKey.d});var p=new KJUR.asn1.DERInteger({bigint:pKey.p});var q=new KJUR.asn1.DERInteger({bigint:pKey.q});var dmp1=new KJUR.asn1.DERInteger({bigint:pKey.dmp1});var dmq1=new KJUR.asn1.DERInteger({bigint:pKey.dmq1});var coeff=new KJUR.asn1.DERInteger({bigint:pKey.coeff});var seq=new KJUR.asn1.DERSequence({array:[version,n,e,d,p,q,dmp1,dmq1,coeff]});var hex=seq.getEncodedHex();return this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",hex,passcode,alg,ivsaltHex)},newEncryptedPKCS5PEM:function(passcode,keyLen,hPublicExponent,alg){if(typeof keyLen=="undefined"||keyLen==null){keyLen=1024}if(typeof hPublicExponent=="undefined"||hPublicExponent==null){hPublicExponent="10001"}var pKey=new RSAKey;pKey.generate(keyLen,hPublicExponent);var pem=null;if(typeof alg=="undefined"||alg==null){pem=this.getEncryptedPKCS5PEMFromRSAKey(pKey,passcode)}else{pem=this.getEncryptedPKCS5PEMFromRSAKey(pKey,passcode,alg)}return pem},getRSAKeyFromPlainPKCS8PEM:function(pkcs8PEM){if(pkcs8PEM.match(/ENCRYPTED/))throw"pem shall be not ENCRYPTED";var prvKeyHex=this.getHexFromPEM(pkcs8PEM,"PRIVATE KEY");var rsaKey=this.getRSAKeyFromPlainPKCS8Hex(prvKeyHex);return rsaKey},getRSAKeyFromPlainPKCS8Hex:function(prvKeyHex){var a1=ASN1HEX.getPosArrayOfChildren_AtObj(prvKeyHex,0);if(a1.length!=3)throw"outer DERSequence shall have 3 elements: "+a1.length;var algIdTLV=ASN1HEX.getHexOfTLV_AtObj(prvKeyHex,a1[1]);if(algIdTLV!="300d06092a864886f70d0101010500")throw"PKCS8 AlgorithmIdentifier is not rsaEnc: "+algIdTLV;var algIdTLV=ASN1HEX.getHexOfTLV_AtObj(prvKeyHex,a1[1]);var octetStr=ASN1HEX.getHexOfTLV_AtObj(prvKeyHex,a1[2]);var p5KeyHex=ASN1HEX.getHexOfV_AtObj(octetStr,0);var rsaKey=new RSAKey;rsaKey.readPrivateKeyFromASN1HexString(p5KeyHex);return rsaKey},parseHexOfEncryptedPKCS8:function(sHEX){var info={};var a0=ASN1HEX.getPosArrayOfChildren_AtObj(sHEX,0);if(a0.length!=2)throw"malformed format: SEQUENCE(0).items != 2: "+a0.length;info.ciphertext=ASN1HEX.getHexOfV_AtObj(sHEX,a0[1]);var a0_0=ASN1HEX.getPosArrayOfChildren_AtObj(sHEX,a0[0]);if(a0_0.length!=2)throw"malformed format: SEQUENCE(0.0).items != 2: "+a0_0.length;if(ASN1HEX.getHexOfV_AtObj(sHEX,a0_0[0])!="2a864886f70d01050d")throw"this only supports pkcs5PBES2";var a0_0_1=ASN1HEX.getPosArrayOfChildren_AtObj(sHEX,a0_0[1]);if(a0_0.length!=2)throw"malformed format: SEQUENCE(0.0.1).items != 2: "+a0_0_1.length;var a0_0_1_1=ASN1HEX.getPosArrayOfChildren_AtObj(sHEX,a0_0_1[1]);if(a0_0_1_1.length!=2)throw"malformed format: SEQUENCE(0.0.1.1).items != 2: "+a0_0_1_1.length;if(ASN1HEX.getHexOfV_AtObj(sHEX,a0_0_1_1[0])!="2a864886f70d0307")throw"this only supports TripleDES";info.encryptionSchemeAlg="TripleDES";info.encryptionSchemeIV=ASN1HEX.getHexOfV_AtObj(sHEX,a0_0_1_1[1]);var a0_0_1_0=ASN1HEX.getPosArrayOfChildren_AtObj(sHEX,a0_0_1[0]);if(a0_0_1_0.length!=2)throw"malformed format: SEQUENCE(0.0.1.0).items != 2: "+a0_0_1_0.length;if(ASN1HEX.getHexOfV_AtObj(sHEX,a0_0_1_0[0])!="2a864886f70d01050c")throw"this only supports pkcs5PBKDF2";var a0_0_1_0_1=ASN1HEX.getPosArrayOfChildren_AtObj(sHEX,a0_0_1_0[1]);if(a0_0_1_0_1.length<2)throw"malformed format: SEQUENCE(0.0.1.0.1).items < 2: "+a0_0_1_0_1.length;info.pbkdf2Salt=ASN1HEX.getHexOfV_AtObj(sHEX,a0_0_1_0_1[0]);var iterNumHex=ASN1HEX.getHexOfV_AtObj(sHEX,a0_0_1_0_1[1]);try{info.pbkdf2Iter=parseInt(iterNumHex,16)}catch(ex){throw"malformed format pbkdf2Iter: "+iterNumHex}return info},getPBKDF2KeyHexFromParam:function(info,passcode){var pbkdf2SaltWS=CryptoJS.enc.Hex.parse(info.pbkdf2Salt);var pbkdf2Iter=info.pbkdf2Iter;var pbkdf2KeyWS=CryptoJS.PBKDF2(passcode,pbkdf2SaltWS,{keySize:192/32,iterations:pbkdf2Iter});var pbkdf2KeyHex=CryptoJS.enc.Hex.stringify(pbkdf2KeyWS);return pbkdf2KeyHex},getPlainPKCS8HexFromEncryptedPKCS8PEM:function(pkcs8PEM,passcode){var derHex=this.getHexFromPEM(pkcs8PEM,"ENCRYPTED PRIVATE KEY");var info=this.parseHexOfEncryptedPKCS8(derHex);var pbkdf2KeyHex=KEYUTIL.getPBKDF2KeyHexFromParam(info,passcode);var encrypted={};encrypted.ciphertext=CryptoJS.enc.Hex.parse(info.ciphertext);var pbkdf2KeyWS=CryptoJS.enc.Hex.parse(pbkdf2KeyHex);var des3IVWS=CryptoJS.enc.Hex.parse(info.encryptionSchemeIV);var decWS=CryptoJS.TripleDES.decrypt(encrypted,pbkdf2KeyWS,{iv:des3IVWS});var decHex=CryptoJS.enc.Hex.stringify(decWS);return decHex},getRSAKeyFromEncryptedPKCS8PEM:function(pkcs8PEM,passcode){var prvKeyHex=this.getPlainPKCS8HexFromEncryptedPKCS8PEM(pkcs8PEM,passcode);var rsaKey=this.getRSAKeyFromPlainPKCS8Hex(prvKeyHex);return rsaKey},getKeyFromEncryptedPKCS8PEM:function(pkcs8PEM,passcode){var prvKeyHex=this.getPlainPKCS8HexFromEncryptedPKCS8PEM(pkcs8PEM,passcode);var key=this.getKeyFromPlainPrivatePKCS8Hex(prvKeyHex);return key},parsePlainPrivatePKCS8Hex:function(pkcs8PrvHex){var result={};result.algparam=null;if(pkcs8PrvHex.substr(0,2)!="30")throw"malformed plain PKCS8 private key(code:001)";var a1=ASN1HEX.getPosArrayOfChildren_AtObj(pkcs8PrvHex,0);if(a1.length!=3)throw"malformed plain PKCS8 private key(code:002)";if(pkcs8PrvHex.substr(a1[1],2)!="30")throw"malformed PKCS8 private key(code:003)";var a2=ASN1HEX.getPosArrayOfChildren_AtObj(pkcs8PrvHex,a1[1]);if(a2.length!=2)throw"malformed PKCS8 private key(code:004)";if(pkcs8PrvHex.substr(a2[0],2)!="06")throw"malformed PKCS8 private key(code:005)";result.algoid=ASN1HEX.getHexOfV_AtObj(pkcs8PrvHex,a2[0]);if(pkcs8PrvHex.substr(a2[1],2)=="06"){result.algparam=ASN1HEX.getHexOfV_AtObj(pkcs8PrvHex,a2[1])}if(pkcs8PrvHex.substr(a1[2],2)!="04")throw"malformed PKCS8 private key(code:006)";result.keyidx=ASN1HEX.getStartPosOfV_AtObj(pkcs8PrvHex,a1[2]);return result},getKeyFromPlainPrivatePKCS8PEM:function(prvKeyPEM){var prvKeyHex=this.getHexFromPEM(prvKeyPEM,"PRIVATE KEY");var key=this.getKeyFromPlainPrivatePKCS8Hex(prvKeyHex);return key},getKeyFromPlainPrivatePKCS8Hex:function(prvKeyHex){var p8=this.parsePlainPrivatePKCS8Hex(prvKeyHex);if(p8.algoid=="2a864886f70d010101"){this.parsePrivateRawRSAKeyHexAtObj(prvKeyHex,p8);var k=p8.key;var key=new RSAKey;key.setPrivateEx(k.n,k.e,k.d,k.p,k.q,k.dp,k.dq,k.co);return key}else if(p8.algoid=="2a8648ce3d0201"){this.parsePrivateRawECKeyHexAtObj(prvKeyHex,p8);if(KJUR.crypto.OID.oidhex2name[p8.algparam]===undefined)throw"KJUR.crypto.OID.oidhex2name undefined: "+p8.algparam;var curveName=KJUR.crypto.OID.oidhex2name[p8.algparam];var key=new KJUR.crypto.ECDSA({curve:curveName});key.setPublicKeyHex(p8.pubkey);key.setPrivateKeyHex(p8.key);key.isPublic=false;return key}else if(p8.algoid=="2a8648ce380401"){var hP=ASN1HEX.getVbyList(prvKeyHex,0,[1,1,0],"02");var hQ=ASN1HEX.getVbyList(prvKeyHex,0,[1,1,1],"02");var hG=ASN1HEX.getVbyList(prvKeyHex,0,[1,1,2],"02");var hX=ASN1HEX.getVbyList(prvKeyHex,0,[2,0],"02");var biP=new BigInteger(hP,16);var biQ=new BigInteger(hQ,16);var biG=new BigInteger(hG,16);var biX=new BigInteger(hX,16);var key=new KJUR.crypto.DSA;key.setPrivate(biP,biQ,biG,null,biX);return key}else{throw"unsupported private key algorithm"}},getRSAKeyFromPublicPKCS8PEM:function(pkcs8PubPEM){var pubKeyHex=this.getHexFromPEM(pkcs8PubPEM,"PUBLIC KEY");var rsaKey=this.getRSAKeyFromPublicPKCS8Hex(pubKeyHex);return rsaKey},getKeyFromPublicPKCS8PEM:function(pkcs8PubPEM){var pubKeyHex=this.getHexFromPEM(pkcs8PubPEM,"PUBLIC KEY");var key=this.getKeyFromPublicPKCS8Hex(pubKeyHex);return key},getKeyFromPublicPKCS8Hex:function(pkcs8PubHex){var p8=this.parsePublicPKCS8Hex(pkcs8PubHex);if(p8.algoid=="2a864886f70d010101"){var aRSA=this.parsePublicRawRSAKeyHex(p8.key);var key=new RSAKey;key.setPublic(aRSA.n,aRSA.e);return key}else if(p8.algoid=="2a8648ce3d0201"){if(KJUR.crypto.OID.oidhex2name[p8.algparam]===undefined)throw"KJUR.crypto.OID.oidhex2name undefined: "+p8.algparam;var curveName=KJUR.crypto.OID.oidhex2name[p8.algparam];var key=new KJUR.crypto.ECDSA({curve:curveName,pub:p8.key});return key}else if(p8.algoid=="2a8648ce380401"){var param=p8.algparam;var y=ASN1HEX.getHexOfV_AtObj(p8.key,0);var key=new KJUR.crypto.DSA;key.setPublic(new BigInteger(param.p,16),new BigInteger(param.q,16),new BigInteger(param.g,16),new BigInteger(y,16));return key}else{throw"unsupported public key algorithm"}},parsePublicRawRSAKeyHex:function(pubRawRSAHex){var result={};if(pubRawRSAHex.substr(0,2)!="30")throw"malformed RSA key(code:001)";var a1=ASN1HEX.getPosArrayOfChildren_AtObj(pubRawRSAHex,0);if(a1.length!=2)throw"malformed RSA key(code:002)";if(pubRawRSAHex.substr(a1[0],2)!="02")throw"malformed RSA key(code:003)";result.n=ASN1HEX.getHexOfV_AtObj(pubRawRSAHex,a1[0]);if(pubRawRSAHex.substr(a1[1],2)!="02")throw"malformed RSA key(code:004)";result.e=ASN1HEX.getHexOfV_AtObj(pubRawRSAHex,a1[1]);return result},parsePrivateRawRSAKeyHexAtObj:function(pkcs8PrvHex,info){var keyIdx=info.keyidx;if(pkcs8PrvHex.substr(keyIdx,2)!="30")throw"malformed RSA private key(code:001)";var a1=ASN1HEX.getPosArrayOfChildren_AtObj(pkcs8PrvHex,keyIdx);if(a1.length!=9)throw"malformed RSA private key(code:002)";info.key={};info.key.n=ASN1HEX.getHexOfV_AtObj(pkcs8PrvHex,a1[1]);info.key.e=ASN1HEX.getHexOfV_AtObj(pkcs8PrvHex,a1[2]);info.key.d=ASN1HEX.getHexOfV_AtObj(pkcs8PrvHex,a1[3]);info.key.p=ASN1HEX.getHexOfV_AtObj(pkcs8PrvHex,a1[4]);info.key.q=ASN1HEX.getHexOfV_AtObj(pkcs8PrvHex,a1[5]);info.key.dp=ASN1HEX.getHexOfV_AtObj(pkcs8PrvHex,a1[6]);info.key.dq=ASN1HEX.getHexOfV_AtObj(pkcs8PrvHex,a1[7]);info.key.co=ASN1HEX.getHexOfV_AtObj(pkcs8PrvHex,a1[8])},parsePrivateRawECKeyHexAtObj:function(pkcs8PrvHex,info){var keyIdx=info.keyidx;var key=ASN1HEX.getVbyList(pkcs8PrvHex,keyIdx,[1],"04");var pubkey=ASN1HEX.getVbyList(pkcs8PrvHex,keyIdx,[2,0],"03").substr(2);info.key=key;info.pubkey=pubkey},parsePublicPKCS8Hex:function(pkcs8PubHex){var result={};result.algparam=null;var a1=ASN1HEX.getPosArrayOfChildren_AtObj(pkcs8PubHex,0);if(a1.length!=2)throw"outer DERSequence shall have 2 elements: "+a1.length;var idxAlgIdTLV=a1[0];if(pkcs8PubHex.substr(idxAlgIdTLV,2)!="30")throw"malformed PKCS8 public key(code:001)";var a2=ASN1HEX.getPosArrayOfChildren_AtObj(pkcs8PubHex,idxAlgIdTLV);if(a2.length!=2)throw"malformed PKCS8 public key(code:002)";if(pkcs8PubHex.substr(a2[0],2)!="06")throw"malformed PKCS8 public key(code:003)";result.algoid=ASN1HEX.getHexOfV_AtObj(pkcs8PubHex,a2[0]);if(pkcs8PubHex.substr(a2[1],2)=="06"){result.algparam=ASN1HEX.getHexOfV_AtObj(pkcs8PubHex,a2[1])}else if(pkcs8PubHex.substr(a2[1],2)=="30"){result.algparam={};result.algparam.p=ASN1HEX.getVbyList(pkcs8PubHex,a2[1],[0],"02");result.algparam.q=ASN1HEX.getVbyList(pkcs8PubHex,a2[1],[1],"02");result.algparam.g=ASN1HEX.getVbyList(pkcs8PubHex,a2[1],[2],"02")}if(pkcs8PubHex.substr(a1[1],2)!="03")throw"malformed PKCS8 public key(code:004)";result.key=ASN1HEX.getHexOfV_AtObj(pkcs8PubHex,a1[1]).substr(2);return result},getRSAKeyFromPublicPKCS8Hex:function(pkcs8PubHex){var a1=ASN1HEX.getPosArrayOfChildren_AtObj(pkcs8PubHex,0);if(a1.length!=2)throw"outer DERSequence shall have 2 elements: "+a1.length;var algIdTLV=ASN1HEX.getHexOfTLV_AtObj(pkcs8PubHex,a1[0]);if(algIdTLV!="300d06092a864886f70d0101010500")throw"PKCS8 AlgorithmId is not rsaEncryption";if(pkcs8PubHex.substr(a1[1],2)!="03")throw"PKCS8 Public Key is not BITSTRING encapslated.";var idxPub=ASN1HEX.getStartPosOfV_AtObj(pkcs8PubHex,a1[1])+2;if(pkcs8PubHex.substr(idxPub,2)!="30")throw"PKCS8 Public Key is not SEQUENCE.";var a2=ASN1HEX.getPosArrayOfChildren_AtObj(pkcs8PubHex,idxPub);if(a2.length!=2)throw"inner DERSequence shall have 2 elements: "+a2.length;if(pkcs8PubHex.substr(a2[0],2)!="02")throw"N is not ASN.1 INTEGER";if(pkcs8PubHex.substr(a2[1],2)!="02")throw"E is not ASN.1 INTEGER";var hN=ASN1HEX.getHexOfV_AtObj(pkcs8PubHex,a2[0]);var hE=ASN1HEX.getHexOfV_AtObj(pkcs8PubHex,a2[1]);var pubKey=new RSAKey;pubKey.setPublic(hN,hE);return pubKey}}}();KEYUTIL.getKey=function(param,passcode,hextype){if(typeof RSAKey!="undefined"&&param instanceof RSAKey)return param;if(typeof KJUR.crypto.ECDSA!="undefined"&&param instanceof KJUR.crypto.ECDSA)return param;if(typeof KJUR.crypto.DSA!="undefined"&&param instanceof KJUR.crypto.DSA)return param;if(param.xy!==undefined&&param.curve!==undefined){return new KJUR.crypto.ECDSA({prv:param.xy,curve:param.curve})}if(param.n!==undefined&&param.e!==undefined&&param.d!==undefined&&param.p!==undefined&&param.q!==undefined&&param.dp!==undefined&&param.dq!==undefined&&param.co!==undefined){var key=new RSAKey;key.setPrivateEx(param.n,param.e,param.d,param.p,param.q,param.dp,param.dq,param.co);return key}if(param.p!==undefined&&param.q!==undefined&&param.g!==undefined&&param.y!==undefined&&param.x!==undefined){var key=new KJUR.crypto.DSA;key.setPrivate(param.p,param.q,param.g,param.y,param.x);return key}if(param.d!==undefined&&param.curve!==undefined){return new KJUR.crypto.ECDSA({pub:param.d,curve:param.curve})}if(param.n!==undefined&&param.e){var key=new RSAKey;key.setPublic(param.n,param.e);return key}if(param.p!==undefined&&param.q!==undefined&&param.g!==undefined&&param.y!==undefined&&param.x===undefined){var key=new KJUR.crypto.DSA;key.setPublic(param.p,param.q,param.g,param.y);return key}if(param.indexOf("-END CERTIFICATE-",0)!=-1||param.indexOf("-END X509 CERTIFICATE-",0)!=-1||param.indexOf("-END TRUSTED CERTIFICATE-",0)!=-1){return X509.getPublicKeyFromCertPEM(param)}if(hextype==="pkcs8pub"){return KEYUTIL.getKeyFromPublicPKCS8Hex(param)}if(param.indexOf("-END PUBLIC KEY-")!=-1){return KEYUTIL.getKeyFromPublicPKCS8PEM(param)}if(hextype==="pkcs5prv"){var key=new RSAKey;key.readPrivateKeyFromASN1HexString(param);return key}if(hextype==="pkcs5prv"){var key=new RSAKey;key.readPrivateKeyFromASN1HexString(param);return key}if(param.indexOf("-END RSA PRIVATE KEY-")!=-1&&param.indexOf("4,ENCRYPTED")==-1){var key=new RSAKey;key.readPrivateKeyFromPEMString(param);return key}if(param.indexOf("-END DSA PRIVATE KEY-")!=-1&&param.indexOf("4,ENCRYPTED")==-1){var hKey=this.getHexFromPEM(param,"DSA PRIVATE KEY");var p=ASN1HEX.getVbyList(hKey,0,[1],"02");var q=ASN1HEX.getVbyList(hKey,0,[2],"02");var g=ASN1HEX.getVbyList(hKey,0,[3],"02");var y=ASN1HEX.getVbyList(hKey,0,[4],"02");var x=ASN1HEX.getVbyList(hKey,0,[5],"02");var key=new KJUR.crypto.DSA;key.setPrivate(new BigInteger(p,16),new BigInteger(q,16),new BigInteger(g,16),new BigInteger(y,16),new BigInteger(x,16));return key}if(param.indexOf("-END PRIVATE KEY-")!=-1){return KEYUTIL.getKeyFromPlainPrivatePKCS8PEM(param)}if(param.indexOf("-END RSA PRIVATE KEY-")!=-1&&param.indexOf("4,ENCRYPTED")!=-1){return KEYUTIL.getRSAKeyFromEncryptedPKCS5PEM(param,passcode)}if(param.indexOf("-END EC PRIVATE KEY-")!=-1&&param.indexOf("4,ENCRYPTED")!=-1){var hKey=KEYUTIL.getDecryptedKeyHex(param,passcode);var key=ASN1HEX.getVbyList(hKey,0,[1],"04");var curveNameOidHex=ASN1HEX.getVbyList(hKey,0,[2,0],"06");var pubkey=ASN1HEX.getVbyList(hKey,0,[3,0],"03").substr(2);var curveName="";if(KJUR.crypto.OID.oidhex2name[curveNameOidHex]!==undefined){curveName=KJUR.crypto.OID.oidhex2name[curveNameOidHex]}else{throw"undefined OID(hex) in KJUR.crypto.OID: "+curveNameOidHex}var ec=new KJUR.crypto.ECDSA({name:curveName});ec.setPublicKeyHex(pubkey);ec.setPrivateKeyHex(key);ec.isPublic=false;return ec}if(param.indexOf("-END DSA PRIVATE KEY-")!=-1&&param.indexOf("4,ENCRYPTED")!=-1){var hKey=KEYUTIL.getDecryptedKeyHex(param,passcode);var p=ASN1HEX.getVbyList(hKey,0,[1],"02");var q=ASN1HEX.getVbyList(hKey,0,[2],"02");var g=ASN1HEX.getVbyList(hKey,0,[3],"02");var y=ASN1HEX.getVbyList(hKey,0,[4],"02");var x=ASN1HEX.getVbyList(hKey,0,[5],"02");var key=new KJUR.crypto.DSA;key.setPrivate(new BigInteger(p,16),new BigInteger(q,16),new BigInteger(g,16),new BigInteger(y,16),new BigInteger(x,16));return key}if(param.indexOf("-END ENCRYPTED PRIVATE KEY-")!=-1){return KEYUTIL.getKeyFromEncryptedPKCS8PEM(param,passcode)}throw"not supported argument"};KEYUTIL.generateKeypair=function(alg,keylenOrCurve){if(alg=="RSA"){var keylen=keylenOrCurve;var prvKey=new RSAKey;prvKey.generate(keylen,"10001");prvKey.isPrivate=true;prvKey.isPublic=true;var pubKey=new RSAKey;var hN=prvKey.n.toString(16);var hE=prvKey.e.toString(16);pubKey.setPublic(hN,hE);pubKey.isPrivate=false;pubKey.isPublic=true;var result={};result.prvKeyObj=prvKey;result.pubKeyObj=pubKey;return result}else if(alg=="EC"){var curve=keylenOrCurve;var ec=new KJUR.crypto.ECDSA({curve:curve});var keypairHex=ec.generateKeyPairHex();var prvKey=new KJUR.crypto.ECDSA({curve:curve});prvKey.setPrivateKeyHex(keypairHex.ecprvhex);prvKey.isPrivate=true;prvKey.isPublic=false;var pubKey=new KJUR.crypto.ECDSA({curve:curve});pubKey.setPublicKeyHex(keypairHex.ecpubhex);pubKey.isPrivate=false;pubKey.isPublic=true;var result={};result.prvKeyObj=prvKey;result.pubKeyObj=pubKey;return result}else{throw"unknown algorithm: "+alg}};KEYUTIL.getPEM=function(keyObjOrHex,formatType,passwd,encAlg,hexType){var ns1=KJUR.asn1;var ns2=KJUR.crypto;function _rsaprv2asn1obj(keyObjOrHex){var asn1Obj=KJUR.asn1.ASN1Util.newObject({seq:[{"int":0},{"int":{bigint:keyObjOrHex.n}},{"int":keyObjOrHex.e},{"int":{bigint:keyObjOrHex.d}},{"int":{bigint:keyObjOrHex.p}},{"int":{bigint:keyObjOrHex.q}},{"int":{bigint:keyObjOrHex.dmp1}},{"int":{bigint:keyObjOrHex.dmq1}},{"int":{bigint:keyObjOrHex.coeff}}]});return asn1Obj}function _ecdsaprv2asn1obj(keyObjOrHex){var asn1Obj2=KJUR.asn1.ASN1Util.newObject({seq:[{"int":1},{octstr:{hex:keyObjOrHex.prvKeyHex}},{tag:["a0",true,{oid:{name:keyObjOrHex.curveName}}]},{tag:["a1",true,{bitstr:{hex:"00"+keyObjOrHex.pubKeyHex}}]}]});return asn1Obj2}function _dsaprv2asn1obj(keyObjOrHex){var asn1Obj=KJUR.asn1.ASN1Util.newObject({seq:[{"int":0},{"int":{bigint:keyObjOrHex.p}},{"int":{bigint:keyObjOrHex.q}},{"int":{bigint:keyObjOrHex.g}},{"int":{bigint:keyObjOrHex.y}},{"int":{bigint:keyObjOrHex.x}}]});return asn1Obj}if((typeof RSAKey!="undefined"&&keyObjOrHex instanceof RSAKey||typeof ns2.DSA!="undefined"&&keyObjOrHex instanceof ns2.DSA||typeof ns2.ECDSA!="undefined"&&keyObjOrHex instanceof ns2.ECDSA)&&keyObjOrHex.isPublic==true&&(formatType===undefined||formatType=="PKCS8PUB")){var asn1Obj=new KJUR.asn1.x509.SubjectPublicKeyInfo(keyObjOrHex);
var asn1Hex=asn1Obj.getEncodedHex();return ns1.ASN1Util.getPEMStringFromHex(asn1Hex,"PUBLIC KEY")}if(formatType=="PKCS1PRV"&&typeof RSAKey!="undefined"&&keyObjOrHex instanceof RSAKey&&(passwd===undefined||passwd==null)&&keyObjOrHex.isPrivate==true){var asn1Obj=_rsaprv2asn1obj(keyObjOrHex);var asn1Hex=asn1Obj.getEncodedHex();return ns1.ASN1Util.getPEMStringFromHex(asn1Hex,"RSA PRIVATE KEY")}if(formatType=="PKCS1PRV"&&typeof RSAKey!="undefined"&&keyObjOrHex instanceof KJUR.crypto.ECDSA&&(passwd===undefined||passwd==null)&&keyObjOrHex.isPrivate==true){var asn1Obj1=new KJUR.asn1.DERObjectIdentifier({name:keyObjOrHex.curveName});var asn1Hex1=asn1Obj1.getEncodedHex();var asn1Obj2=_ecdsaprv2asn1obj(keyObjOrHex);var asn1Hex2=asn1Obj2.getEncodedHex();var s="";s+=ns1.ASN1Util.getPEMStringFromHex(asn1Hex1,"EC PARAMETERS");s+=ns1.ASN1Util.getPEMStringFromHex(asn1Hex2,"EC PRIVATE KEY");return s}if(formatType=="PKCS1PRV"&&typeof KJUR.crypto.DSA!="undefined"&&keyObjOrHex instanceof KJUR.crypto.DSA&&(passwd===undefined||passwd==null)&&keyObjOrHex.isPrivate==true){var asn1Obj=_dsaprv2asn1obj(keyObjOrHex);var asn1Hex=asn1Obj.getEncodedHex();return ns1.ASN1Util.getPEMStringFromHex(asn1Hex,"DSA PRIVATE KEY")}if(formatType=="PKCS5PRV"&&typeof RSAKey!="undefined"&&keyObjOrHex instanceof RSAKey&&(passwd!==undefined&&passwd!=null)&&keyObjOrHex.isPrivate==true){var asn1Obj=_rsaprv2asn1obj(keyObjOrHex);var asn1Hex=asn1Obj.getEncodedHex();if(encAlg===undefined)encAlg="DES-EDE3-CBC";return this.getEncryptedPKCS5PEMFromPrvKeyHex("RSA",asn1Hex,passwd,encAlg)}if(formatType=="PKCS5PRV"&&typeof KJUR.crypto.ECDSA!="undefined"&&keyObjOrHex instanceof KJUR.crypto.ECDSA&&(passwd!==undefined&&passwd!=null)&&keyObjOrHex.isPrivate==true){var asn1Obj=_ecdsaprv2asn1obj(keyObjOrHex);var asn1Hex=asn1Obj.getEncodedHex();if(encAlg===undefined)encAlg="DES-EDE3-CBC";return this.getEncryptedPKCS5PEMFromPrvKeyHex("EC",asn1Hex,passwd,encAlg)}if(formatType=="PKCS5PRV"&&typeof KJUR.crypto.DSA!="undefined"&&keyObjOrHex instanceof KJUR.crypto.DSA&&(passwd!==undefined&&passwd!=null)&&keyObjOrHex.isPrivate==true){var asn1Obj=_dsaprv2asn1obj(keyObjOrHex);var asn1Hex=asn1Obj.getEncodedHex();if(encAlg===undefined)encAlg="DES-EDE3-CBC";return this.getEncryptedPKCS5PEMFromPrvKeyHex("DSA",asn1Hex,passwd,encAlg)}var _getEncryptedPKCS8=function(plainKeyHex,passcode){var info=_getEencryptedPKCS8Info(plainKeyHex,passcode);var asn1Obj=new KJUR.asn1.ASN1Util.newObject({seq:[{seq:[{oid:{name:"pkcs5PBES2"}},{seq:[{seq:[{oid:{name:"pkcs5PBKDF2"}},{seq:[{octstr:{hex:info.pbkdf2Salt}},{"int":info.pbkdf2Iter}]}]},{seq:[{oid:{name:"des-EDE3-CBC"}},{octstr:{hex:info.encryptionSchemeIV}}]}]}]},{octstr:{hex:info.ciphertext}}]});return asn1Obj.getEncodedHex()};var _getEencryptedPKCS8Info=function(plainKeyHex,passcode){var pbkdf2Iter=100;var pbkdf2SaltWS=CryptoJS.lib.WordArray.random(8);var encryptionSchemeAlg="DES-EDE3-CBC";var encryptionSchemeIVWS=CryptoJS.lib.WordArray.random(8);var pbkdf2KeyWS=CryptoJS.PBKDF2(passcode,pbkdf2SaltWS,{keySize:192/32,iterations:pbkdf2Iter});var plainKeyWS=CryptoJS.enc.Hex.parse(plainKeyHex);var encryptedKeyHex=CryptoJS.TripleDES.encrypt(plainKeyWS,pbkdf2KeyWS,{iv:encryptionSchemeIVWS})+"";var info={};info.ciphertext=encryptedKeyHex;info.pbkdf2Salt=CryptoJS.enc.Hex.stringify(pbkdf2SaltWS);info.pbkdf2Iter=pbkdf2Iter;info.encryptionSchemeAlg=encryptionSchemeAlg;info.encryptionSchemeIV=CryptoJS.enc.Hex.stringify(encryptionSchemeIVWS);return info};if(formatType=="PKCS8PRV"&&typeof RSAKey!="undefined"&&keyObjOrHex instanceof RSAKey&&keyObjOrHex.isPrivate==true){var keyObj=_rsaprv2asn1obj(keyObjOrHex);var keyHex=keyObj.getEncodedHex();var asn1Obj=KJUR.asn1.ASN1Util.newObject({seq:[{"int":0},{seq:[{oid:{name:"rsaEncryption"}},{"null":true}]},{octstr:{hex:keyHex}}]});var asn1Hex=asn1Obj.getEncodedHex();if(passwd===undefined||passwd==null){return ns1.ASN1Util.getPEMStringFromHex(asn1Hex,"PRIVATE KEY")}else{var asn1Hex2=_getEncryptedPKCS8(asn1Hex,passwd);return ns1.ASN1Util.getPEMStringFromHex(asn1Hex2,"ENCRYPTED PRIVATE KEY")}}if(formatType=="PKCS8PRV"&&typeof KJUR.crypto.ECDSA!="undefined"&&keyObjOrHex instanceof KJUR.crypto.ECDSA&&keyObjOrHex.isPrivate==true){var keyObj=new KJUR.asn1.ASN1Util.newObject({seq:[{"int":1},{octstr:{hex:keyObjOrHex.prvKeyHex}},{tag:["a1",true,{bitstr:{hex:"00"+keyObjOrHex.pubKeyHex}}]}]});var keyHex=keyObj.getEncodedHex();var asn1Obj=KJUR.asn1.ASN1Util.newObject({seq:[{"int":0},{seq:[{oid:{name:"ecPublicKey"}},{oid:{name:keyObjOrHex.curveName}}]},{octstr:{hex:keyHex}}]});var asn1Hex=asn1Obj.getEncodedHex();if(passwd===undefined||passwd==null){return ns1.ASN1Util.getPEMStringFromHex(asn1Hex,"PRIVATE KEY")}else{var asn1Hex2=_getEncryptedPKCS8(asn1Hex,passwd);return ns1.ASN1Util.getPEMStringFromHex(asn1Hex2,"ENCRYPTED PRIVATE KEY")}}if(formatType=="PKCS8PRV"&&typeof KJUR.crypto.DSA!="undefined"&&keyObjOrHex instanceof KJUR.crypto.DSA&&keyObjOrHex.isPrivate==true){var keyObj=new KJUR.asn1.DERInteger({bigint:keyObjOrHex.x});var keyHex=keyObj.getEncodedHex();var asn1Obj=KJUR.asn1.ASN1Util.newObject({seq:[{"int":0},{seq:[{oid:{name:"dsa"}},{seq:[{"int":{bigint:keyObjOrHex.p}},{"int":{bigint:keyObjOrHex.q}},{"int":{bigint:keyObjOrHex.g}}]}]},{octstr:{hex:keyHex}}]});var asn1Hex=asn1Obj.getEncodedHex();if(passwd===undefined||passwd==null){return ns1.ASN1Util.getPEMStringFromHex(asn1Hex,"PRIVATE KEY")}else{var asn1Hex2=_getEncryptedPKCS8(asn1Hex,passwd);return ns1.ASN1Util.getPEMStringFromHex(asn1Hex2,"ENCRYPTED PRIVATE KEY")}}throw"unsupported object nor format"};KEYUTIL.getKeyFromCSRPEM=function(csrPEM){var csrHex=KEYUTIL.getHexFromPEM(csrPEM,"CERTIFICATE REQUEST");var key=KEYUTIL.getKeyFromCSRHex(csrHex);return key};KEYUTIL.getKeyFromCSRHex=function(csrHex){var info=KEYUTIL.parseCSRHex(csrHex);var key=KEYUTIL.getKey(info.p8pubkeyhex,null,"pkcs8pub");return key};KEYUTIL.parseCSRHex=function(csrHex){var result={};var h=csrHex;if(h.substr(0,2)!="30")throw"malformed CSR(code:001)";var a1=ASN1HEX.getPosArrayOfChildren_AtObj(h,0);if(a1.length<1)throw"malformed CSR(code:002)";if(h.substr(a1[0],2)!="30")throw"malformed CSR(code:003)";var a2=ASN1HEX.getPosArrayOfChildren_AtObj(h,a1[0]);if(a2.length<3)throw"malformed CSR(code:004)";result.p8pubkeyhex=ASN1HEX.getHexOfTLV_AtObj(h,a2[2]);return result};if(typeof KJUR=="undefined"||!KJUR)KJUR={};if(typeof KJUR.crypto=="undefined"||!KJUR.crypto)KJUR.crypto={};KJUR.crypto.ECDSA=function(params){var curveName="secp256r1";var ecparams=null;var prvKeyHex=null;var pubKeyHex=null;var rng=new SecureRandom;var P_OVER_FOUR=null;this.type="EC";function implShamirsTrick(P,k,Q,l){var m=Math.max(k.bitLength(),l.bitLength());var Z=P.add2D(Q);var R=P.curve.getInfinity();for(var i=m-1;i>=0;--i){R=R.twice2D();R.z=BigInteger.ONE;if(k.testBit(i)){if(l.testBit(i)){R=R.add2D(Z)}else{R=R.add2D(P)}}else{if(l.testBit(i)){R=R.add2D(Q)}}}return R}this.getBigRandom=function(limit){return new BigInteger(limit.bitLength(),rng).mod(limit.subtract(BigInteger.ONE)).add(BigInteger.ONE)};this.setNamedCurve=function(curveName){this.ecparams=KJUR.crypto.ECParameterDB.getByName(curveName);this.prvKeyHex=null;this.pubKeyHex=null;this.curveName=curveName};this.setPrivateKeyHex=function(prvKeyHex){this.isPrivate=true;this.prvKeyHex=prvKeyHex};this.setPublicKeyHex=function(pubKeyHex){this.isPublic=true;this.pubKeyHex=pubKeyHex};this.generateKeyPairHex=function(){var biN=this.ecparams["n"];var biPrv=this.getBigRandom(biN);var epPub=this.ecparams["G"].multiply(biPrv);var biX=epPub.getX().toBigInteger();var biY=epPub.getY().toBigInteger();var charlen=this.ecparams["keylen"]/4;var hPrv=("0000000000"+biPrv.toString(16)).slice(-charlen);var hX=("0000000000"+biX.toString(16)).slice(-charlen);var hY=("0000000000"+biY.toString(16)).slice(-charlen);var hPub="04"+hX+hY;this.setPrivateKeyHex(hPrv);this.setPublicKeyHex(hPub);return{ecprvhex:hPrv,ecpubhex:hPub}};this.signWithMessageHash=function(hashHex){return this.signHex(hashHex,this.prvKeyHex)};this.signHex=function(hashHex,privHex){var d=new BigInteger(privHex,16);var n=this.ecparams["n"];var e=new BigInteger(hashHex,16);do{var k=this.getBigRandom(n);var G=this.ecparams["G"];var Q=G.multiply(k);var r=Q.getX().toBigInteger().mod(n)}while(r.compareTo(BigInteger.ZERO)<=0);var s=k.modInverse(n).multiply(e.add(d.multiply(r))).mod(n);return KJUR.crypto.ECDSA.biRSSigToASN1Sig(r,s)};this.sign=function(hash,priv){var d=priv;var n=this.ecparams["n"];var e=BigInteger.fromByteArrayUnsigned(hash);do{var k=this.getBigRandom(n);var G=this.ecparams["G"];var Q=G.multiply(k);var r=Q.getX().toBigInteger().mod(n)}while(r.compareTo(BigInteger.ZERO)<=0);var s=k.modInverse(n).multiply(e.add(d.multiply(r))).mod(n);return this.serializeSig(r,s)};this.verifyWithMessageHash=function(hashHex,sigHex){return this.verifyHex(hashHex,sigHex,this.pubKeyHex)};this.verifyHex=function(hashHex,sigHex,pubkeyHex){var r,s;var obj=KJUR.crypto.ECDSA.parseSigHex(sigHex);r=obj.r;s=obj.s;var Q;Q=ECPointFp.decodeFromHex(this.ecparams["curve"],pubkeyHex);var e=new BigInteger(hashHex,16);return this.verifyRaw(e,r,s,Q)};this.verify=function(hash,sig,pubkey){var r,s;if(Bitcoin.Util.isArray(sig)){var obj=this.parseSig(sig);r=obj.r;s=obj.s}else if("object"===typeof sig&&sig.r&&sig.s){r=sig.r;s=sig.s}else{throw"Invalid value for signature"}var Q;if(pubkey instanceof ECPointFp){Q=pubkey}else if(Bitcoin.Util.isArray(pubkey)){Q=ECPointFp.decodeFrom(this.ecparams["curve"],pubkey)}else{throw"Invalid format for pubkey value, must be byte array or ECPointFp"}var e=BigInteger.fromByteArrayUnsigned(hash);return this.verifyRaw(e,r,s,Q)};this.verifyRaw=function(e,r,s,Q){var n=this.ecparams["n"];var G=this.ecparams["G"];if(r.compareTo(BigInteger.ONE)<0||r.compareTo(n)>=0)return false;if(s.compareTo(BigInteger.ONE)<0||s.compareTo(n)>=0)return false;var c=s.modInverse(n);var u1=e.multiply(c).mod(n);var u2=r.multiply(c).mod(n);var point=G.multiply(u1).add(Q.multiply(u2));var v=point.getX().toBigInteger().mod(n);return v.equals(r)};this.serializeSig=function(r,s){var rBa=r.toByteArraySigned();var sBa=s.toByteArraySigned();var sequence=[];sequence.push(2);sequence.push(rBa.length);sequence=sequence.concat(rBa);sequence.push(2);sequence.push(sBa.length);sequence=sequence.concat(sBa);sequence.unshift(sequence.length);sequence.unshift(48);return sequence};this.parseSig=function(sig){var cursor;if(sig[0]!=48)throw new Error("Signature not a valid DERSequence");cursor=2;if(sig[cursor]!=2)throw new Error("First element in signature must be a DERInteger");var rBa=sig.slice(cursor+2,cursor+2+sig[cursor+1]);cursor+=2+sig[cursor+1];if(sig[cursor]!=2)throw new Error("Second element in signature must be a DERInteger");var sBa=sig.slice(cursor+2,cursor+2+sig[cursor+1]);cursor+=2+sig[cursor+1];var r=BigInteger.fromByteArrayUnsigned(rBa);var s=BigInteger.fromByteArrayUnsigned(sBa);return{r:r,s:s}};this.parseSigCompact=function(sig){if(sig.length!==65){throw"Signature has the wrong length"}var i=sig[0]-27;if(i<0||i>7){throw"Invalid signature type"}var n=this.ecparams["n"];var r=BigInteger.fromByteArrayUnsigned(sig.slice(1,33)).mod(n);var s=BigInteger.fromByteArrayUnsigned(sig.slice(33,65)).mod(n);return{r:r,s:s,i:i}};if(params!==undefined){if(params["curve"]!==undefined){this.curveName=params["curve"]}}if(this.curveName===undefined)this.curveName=curveName;this.setNamedCurve(this.curveName);if(params!==undefined){if(params["prv"]!==undefined)this.setPrivateKeyHex(params["prv"]);if(params["pub"]!==undefined)this.setPublicKeyHex(params["pub"])}};KJUR.crypto.ECDSA.parseSigHex=function(sigHex){var p=KJUR.crypto.ECDSA.parseSigHexInHexRS(sigHex);var biR=new BigInteger(p.r,16);var biS=new BigInteger(p.s,16);return{r:biR,s:biS}};KJUR.crypto.ECDSA.parseSigHexInHexRS=function(sigHex){if(sigHex.substr(0,2)!="30")throw"signature is not a ASN.1 sequence";var a=ASN1HEX.getPosArrayOfChildren_AtObj(sigHex,0);if(a.length!=2)throw"number of signature ASN.1 sequence elements seem wrong";var iTLV1=a[0];var iTLV2=a[1];if(sigHex.substr(iTLV1,2)!="02")throw"1st item of sequene of signature is not ASN.1 integer";if(sigHex.substr(iTLV2,2)!="02")throw"2nd item of sequene of signature is not ASN.1 integer";var hR=ASN1HEX.getHexOfV_AtObj(sigHex,iTLV1);var hS=ASN1HEX.getHexOfV_AtObj(sigHex,iTLV2);return{r:hR,s:hS}};KJUR.crypto.ECDSA.asn1SigToConcatSig=function(asn1Sig){var pSig=KJUR.crypto.ECDSA.parseSigHexInHexRS(asn1Sig);var hR=pSig.r;var hS=pSig.s;if(hR.substr(0,2)=="00"&&hR.length/2*8%(16*8)==8)hR=hR.substr(2);if(hS.substr(0,2)=="00"&&hS.length/2*8%(16*8)==8)hS=hS.substr(2);if(hR.length/2*8%(16*8)!=0)throw"unknown ECDSA sig r length error";if(hS.length/2*8%(16*8)!=0)throw"unknown ECDSA sig s length error";return hR+hS};KJUR.crypto.ECDSA.concatSigToASN1Sig=function(concatSig){if(concatSig.length/2*8%(16*8)!=0)throw"unknown ECDSA concatinated r-s sig  length error";var hR=concatSig.substr(0,concatSig.length/2);var hS=concatSig.substr(concatSig.length/2);return KJUR.crypto.ECDSA.hexRSSigToASN1Sig(hR,hS)};KJUR.crypto.ECDSA.hexRSSigToASN1Sig=function(hR,hS){var biR=new BigInteger(hR,16);var biS=new BigInteger(hS,16);return KJUR.crypto.ECDSA.biRSSigToASN1Sig(biR,biS)};KJUR.crypto.ECDSA.biRSSigToASN1Sig=function(biR,biS){var derR=new KJUR.asn1.DERInteger({bigint:biR});var derS=new KJUR.asn1.DERInteger({bigint:biS});var derSeq=new KJUR.asn1.DERSequence({array:[derR,derS]});return derSeq.getEncodedHex()};if(typeof KJUR=="undefined"||!KJUR)KJUR={};if(typeof KJUR.crypto=="undefined"||!KJUR.crypto)KJUR.crypto={};KJUR.crypto.ECParameterDB=new function(){var db={};var aliasDB={};function hex2bi(hex){return new BigInteger(hex,16)}this.getByName=function(nameOrAlias){var name=nameOrAlias;if(typeof aliasDB[name]!="undefined"){name=aliasDB[nameOrAlias]}if(typeof db[name]!="undefined"){return db[name]}throw"unregistered EC curve name: "+name};this.regist=function(name,keylen,pHex,aHex,bHex,nHex,hHex,gxHex,gyHex,aliasList,oid,info){db[name]={};var p=hex2bi(pHex);var a=hex2bi(aHex);var b=hex2bi(bHex);var n=hex2bi(nHex);var h=hex2bi(hHex);var curve=new ECCurveFp(p,a,b);var G=curve.decodePointHex("04"+gxHex+gyHex);db[name]["name"]=name;db[name]["keylen"]=keylen;db[name]["curve"]=curve;db[name]["G"]=G;db[name]["n"]=n;db[name]["h"]=h;db[name]["oid"]=oid;db[name]["info"]=info;for(var i=0;i<aliasList.length;i++){aliasDB[aliasList[i]]=name}}};KJUR.crypto.ECParameterDB.regist("secp128r1",128,"FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFDFFFFFFFFFFFFFFFFFFFFFFFC","E87579C11079F43DD824993C2CEE5ED3","FFFFFFFE0000000075A30D1B9038A115","1","161FF7528B899B2D0C28607CA52C5B86","CF5AC8395BAFEB13C02DA292DDED7A83",[],"","secp128r1 : SECG curve over a 128 bit prime field");KJUR.crypto.ECParameterDB.regist("secp160k1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFAC73","0","7","0100000000000000000001B8FA16DFAB9ACA16B6B3","1","3B4C382CE37AA192A4019E763036F4F5DD4D7EBB","938CF935318FDCED6BC28286531733C3F03C4FEE",[],"","secp160k1 : SECG curve over a 160 bit prime field");KJUR.crypto.ECParameterDB.regist("secp160r1",160,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF7FFFFFFC","1C97BEFC54BD7A8B65ACF89F81D4D4ADC565FA45","0100000000000000000001F4C8F927AED3CA752257","1","4A96B5688EF573284664698968C38BB913CBFC82","23A628553168947D59DCC912042351377AC5FB32",[],"","secp160r1 : SECG curve over a 160 bit prime field");KJUR.crypto.ECParameterDB.regist("secp192k1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFEE37","0","3","FFFFFFFFFFFFFFFFFFFFFFFE26F2FC170F69466A74DEFD8D","1","DB4FF10EC057E9AE26B07D0280B7F4341DA5D1B1EAE06C7D","9B2F2F6D9C5628A7844163D015BE86344082AA88D95E2F9D",[]);KJUR.crypto.ECParameterDB.regist("secp192r1",192,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFC","64210519E59C80E70FA7E9AB72243049FEB8DEECC146B9B1","FFFFFFFFFFFFFFFFFFFFFFFF99DEF836146BC9B1B4D22831","1","188DA80EB03090F67CBF20EB43A18800F4FF0AFD82FF1012","07192B95FFC8DA78631011ED6B24CDD573F977A11E794811",[]);KJUR.crypto.ECParameterDB.regist("secp224r1",224,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF000000000000000000000001","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFFFFFFFFFFFFFFFFFE","B4050A850C04B3ABF54132565044B0B7D7BFD8BA270B39432355FFB4","FFFFFFFFFFFFFFFFFFFFFFFFFFFF16A2E0B8F03E13DD29455C5C2A3D","1","B70E0CBD6BB4BF7F321390B94A03C1D356C21122343280D6115C1D21","BD376388B5F723FB4C22DFE6CD4375A05A07476444D5819985007E34",[]);KJUR.crypto.ECParameterDB.regist("secp256k1",256,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2F","0","7","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141","1","79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798","483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8",[]);KJUR.crypto.ECParameterDB.regist("secp256r1",256,"FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF","FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC","5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B","FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551","1","6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296","4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5",["NIST P-256","P-256","prime256v1"]);KJUR.crypto.ECParameterDB.regist("secp384r1",384,"FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFFFF0000000000000000FFFFFFFC","B3312FA7E23EE7E4988E056BE3F82D19181D9C6EFE8141120314088F5013875AC656398D8A2ED19D2A85C8EDD3EC2AEF","FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC7634D81F4372DDF581A0DB248B0A77AECEC196ACCC52973","1","AA87CA22BE8B05378EB1C71EF320AD746E1D3B628BA79B9859F741E082542A385502F25DBF55296C3A545E3872760AB7","3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f",["NIST P-384","P-384"]);KJUR.crypto.ECParameterDB.regist("secp521r1",521,"1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFC","051953EB9618E1C9A1F929A21A0B68540EEA2DA725B99B315F3B8B489918EF109E156193951EC7E937B1652C0BD3BB1BF073573DF883D2C34F1EF451FD46B503F00","1FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFA51868783BF2F966B7FCC0148F709A5D03BB5C9B8899C47AEBB6FB71E91386409","1","C6858E06B70404E9CD9E3ECB662395B4429C648139053FB521F828AF606B4D3DBAA14B5E77EFE75928FE1DC127A2FFA8DE3348B3C1856A429BF97E7E31C2E5BD66","011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650",["NIST P-521","P-521"]);exports.X509=X509;exports.KJUR=KJUR;exports.ASN1HEX=ASN1HEX;exports.RSAKey=RSAKey;exports._rsasign_verifyString=_rsasign_verifyString;if(!_rsasign_verifyString)throw new Error("rzrezr");exports.KEYUTIL=KEYUTIL;