version: "2.3"
secrets:
  age_idm_auth:
    file: age_idm_auth.txt

services:
  iotage:
    hostname: iotage
    image: iotagent4fiware/iotagent-opcua:latest
    networks:
      - hostnet
      - iotnet
    ports:
      - "4001:4001"
      - "4081:8080"
    depends_on:
      - iotmongo
    volumes:
      - ./AGECONF:/opt/iotagent-opcua/conf

  iotmongo:
    hostname: iotmongo
    image: mongo:3.4
    networks:
      - iotnet
    volumes:
      - iotmongo_data:/data/db
      - iotmongo_conf:/data/configdb

volumes:
  iotmongo_data:
  iotmongo_conf:

networks:
  hostnet:
  iotnet:
